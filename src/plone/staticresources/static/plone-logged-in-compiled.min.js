define("mockup-patterns-inlinevalidation",["jquery","pat-base"],function(s,e){"use strict";return e.extend({name:"inlinevalidation",trigger:".pat-inlinevalidation",parser:"mockup",render_error:function(e,t){var n=s("div.fieldErrorBox",e);""!==t?(e.addClass("error"),n.html(t)):(e.removeClass("error"),n.html(""))},render_error_bootstrap:function(e,t){var n=s("input",e),e=s(".invalid-feedback",e);""!==t?(n.addClass("is-invalid"),e.length?e.html(t):s('<div class="invalid-feedback">'+t+"</div>").insertAfter(n)):(n.removeClass("is-invalid"),e.length&&e.remove())},append_url_path:function(e,t){var n,i=e.split(/\?/),a=i[0];for("/"!==a[a.length-1]&&(a+="/"),a+=t,n=1;n<i.length;n+=1)a+="?"+i[n];return a},queue:function(e,t){void 0===t&&(t=e,e="fx"),s(window).queue(e,t)},validate_archetypes_field:function(e){var e=s(e),n=e.closest(".field"),t=n.attr("data-uid"),i=n.attr("data-fieldname"),a=e.val(),o=(e.prop("multiple")&&null===a&&(a=s([]).serialize()),s.param({uid:t,fname:i,value:a},!0));n&&t&&i&&this.queue(s.proxy(function(t){s.ajax({type:"POST",url:s("base").attr("href")+"/at_validate_field?"+o,iframe:!1,success:s.proxy(function(e){this.render_error(n,e.errmsg),t()},this),error:function(){t()},dataType:"json"})},this))},validate_formlib_field:function(e){var n=s(e).closest(".field"),i=n.closest("form").clone(),a=n.attr("data-fieldname");i.find("input[type=file]").remove(),this.queue(s.proxy(function(t){i.ajaxSubmit({url:this.append_url_path(i.attr("action"),"@@formlib_validate_field"),data:{fname:a},iframe:!1,success:s.proxy(function(e){this.render_error(n,e.errmsg),t()},this),error:function(){t()},dataType:"json"})},this))},validate_z3cform_field:function(e){var e=s(e),n=e.closest(".field"),t=n.closest("form"),i=t.clone(),a=e.closest("fieldset").attr("data-fieldset"),o=n.attr("data-fieldname");s.each(s("select",t),function(e,t){s('select[name="'+t.name+'"]',i).val(s(t).val())}),i.find("input[type=file]").remove(),o&&-1==t.formSerialize().indexOf("form.buttons.")&&this.queue(s.proxy(function(t){i.ajaxSubmit({url:this.append_url_path(i.attr("action"),"@@z3cform_validate_field"),data:{fname:o,fset:a},iframe:!1,success:s.proxy(function(e){n.hasClass("form-group")?this.render_error_bootstrap(n,e.errmsg):this.render_error(n,e.errmsg),t()},this),error:function(){t()},dataType:"json"})},this))},init:function(){var t=this,n=s.proxy(function(e){"archetypes"===t.options.type?t.validate_archetypes_field(e.target):"z3c.form"===t.options.type?t.validate_z3cform_field(e.target):"formlib"===t.options.type&&t.validate_formlib_field(e.target)});this.$el.find('input[type="text"]:not(.pattern-pickadate-date, .pattern-pickadate-time), input[type="password"], input[type="checkbox"], select, textarea').on("blur",n),this.$el.find("input.pat-relateditems.text-widget").on("change",n),this.$el.find("input.pattern-pickadate-date, input.pattern-pickadate-time").on("change",function(e){setTimeout(function(){n(e)},200)})}})}),function(e){define("resource-plone-app-jquerytools-js",["jquery"],function(){return function(){function n(e,s){var t,r,l=this,c=e.add(l),d=f(window),u=f.tools.expose&&(s.mask||s.expose),h=Math.random().toString().slice(10),n=(u&&((u="string"==typeof u?{color:u}:u).closeOnClick=u.closeOnEsc=!1),s.target||e.attr("rel")),p=n?f(n):e;if(!p.length)throw"Could not find Overlay: "+n;e&&-1==e.index(p)&&e.click(function(e){return l.load(e),e.preventDefault()}),f.extend(l,{load:function(e){if(!l.isOpened()){var t,n,i,a,o=g[s.effect];if(!o)throw'Overlay: cannot find effect : "'+s.effect+'"';s.oneInstance&&f.each(m,function(){this.close(e)}),(e=e||f.Event()).type="onBeforeLoad",c.trigger(e),e.isDefaultPrevented()||(r=!0,u&&f(p).expose(u),t=s.top,n=s.left,i=p.outerWidth(!0),a=p.outerHeight(!0),"string"==typeof t&&(t="center"==t?Math.max((d.height()-a)/2,0):parseInt(t,10)/100*d.height()),"center"==n&&(n=Math.max((d.width()-i)/2,0)),o[0].call(l,{top:t,left:n},function(){r&&(e.type="onLoad",c.trigger(e))}),u&&s.closeOnClick&&f.mask.getMask().one("click",l.close),s.closeOnClick&&f(document).on("click."+h,function(e){f(e.target).parents(p).length||l.close(e)}),s.closeOnEsc&&f(document).on("keydown."+h,function(e){27==e.keyCode&&l.close(e)}))}return l},close:function(e){return l.isOpened()?((e=e||f.Event()).type="onBeforeClose",c.trigger(e),e.isDefaultPrevented()?void 0:(r=!1,g[s.effect][1].call(l,function(){e.type="onClose",c.trigger(e)}),f(document).off("click."+h+" keydown."+h),u&&f.mask.close(),l)):l},getOverlay:function(){return p},getTrigger:function(){return e},getClosers:function(){return t},isOpened:function(){return r},getConf:function(){return s}}),f.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(e,t){f.isFunction(s[t])&&f(l).on(t,s[t]),l[t]=function(e){return e&&f(l).on(t,e),l}}),(t=p.find(s.close||".close")).length||s.close||(t=f('<a class="close"></a>'),p.prepend(t)),t.click(function(e){l.close(e)}),s.load&&l.load()}var f,m,g,p,y,u,i,a,h,o,s,r,l,t,c,d,v,b,w,k,x,T,S;function C(e,t){var n=p(t);return n.length<2?n:e.parent().find(t)}function E(e,o){var i,a,t,s,r=this,l=e.add(r),c=e.children(),d=0,u=o.vertical,n=(y=y||r,1<c.length&&(c=p(o.items,e)),1<o.size&&(o.circular=!1),p.extend(r,{getConf:function(){return o},getIndex:function(){return d},getSize:function(){return r.getItems().size()},getNaviButtons:function(){return n.add(h)},getRoot:function(){return e},getItemWrap:function(){return c},getItems:function(){return c.find(o.item).not("."+o.clonedClass)},move:function(e,t){return r.seekTo(d+e,t)},next:function(e){return r.move(o.size,e)},prev:function(e){return r.move(-o.size,e)},begin:function(e){return r.seekTo(0,e)},end:function(e){return r.seekTo(r.getSize()-1,e)},focus:function(){return y=r},addItem:function(e){return e=p(e),o.circular?(c.children().last().before(e),c.children().first().replaceWith(e.clone().addClass(o.clonedClass))):(c.append(e),h.removeClass("disabled")),l.trigger("onAddItem",[e]),r},seekTo:function(e,t,n){var i,a;return e.jquery||(e*=1),o.circular&&0===e&&-1==d&&0!==t||!o.circular&&e<0||e>r.getSize()||e<-1||((i=e).jquery?e=r.getItems().index(e):i=r.getItems().eq(e),a=p.Event("onBeforeSeek"),!n&&(l.trigger(a,[e,t]),a.isDefaultPrevented()||!i.length))||(a=u?{top:-i.position().top}:{left:-i.position().left},d=e,y=r,void 0===t&&(t=o.speed),c.animate(a,t,o.easing,n||function(){l.trigger("onSeek",[e])})),r}}),p.each(["onBeforeSeek","onSeek","onAddItem"],function(e,t){p.isFunction(o[t])&&p(r).on(t,o[t]),r[t]=function(e){return e&&p(r).on(t,e),r}}),o.circular&&(i=r.getItems().slice(-1).clone().prependTo(c),a=r.getItems().eq(1).clone().appendTo(c),i.add(a).addClass(o.clonedClass),r.onBeforeSeek(function(e,t,n){if(!e.isDefaultPrevented())return-1==t?(r.seekTo(i,n,function(){r.end(0)}),e.preventDefault()):void(t==r.getSize()&&r.seekTo(a,n,function(){r.begin(0)}))}),(t=e.parents().add(e).filter(function(){if("none"===p(this).css("display"))return!0})).length?(t.show(),r.seekTo(0,0,function(){}),t.hide()):r.seekTo(0,0,function(){})),C(e,o.prev).click(function(e){e.stopPropagation(),r.prev()})),h=C(e,o.next).click(function(e){e.stopPropagation(),r.next()});o.circular||(r.onBeforeSeek(function(e,t){setTimeout(function(){e.isDefaultPrevented()||(n.toggleClass(o.disabledClass,t<=0),h.toggleClass(o.disabledClass,t>=r.getSize()-1))},1)}),o.initialIndex)||n.addClass(o.disabledClass),r.getSize()<2&&n.add(h).addClass(o.disabledClass),o.mousewheel&&p.fn.mousewheel&&e.mousewheel(function(e,t){if(o.mousewheel)return r.move(t<0?1:-1,o.wheelSpeed||50),!1}),o.touch&&(s={},c[0].ontouchstart=function(e){e=e.touches[0];s.x=e.clientX,s.y=e.clientY},c[0].ontouchmove=function(e){var t,n;1!=e.touches.length||c.is(":animated")||(n=e.touches[0],t=s.x-n.clientX,n=s.y-n.clientY,r[u&&0<n||!u&&0<t?"next":"prev"](),e.preventDefault())}),o.keyboard&&p(document).on("keydown.scrollable",function(e){var t;if(!(!o.keyboard||e.altKey||e.ctrlKey||e.metaKey||p(e.target).is(":input"))&&("static"==o.keyboard||y==r))return t=e.keyCode,!u||38!=t&&40!=t?u||37!=t&&39!=t?void 0:(r.move(37==t?-1:1),e.preventDefault()):(r.move(38==t?-1:1),e.preventDefault())}),o.initialIndex&&r.seekTo(o.initialIndex,0,function(){})}function D(o,e,s){var r,l=this,c=o.add(this),d=o.find(s.tabs),t=e.jquery?e:o.children(e);d.length||(d=o.children()),(t=t.length?t:o.parent().find(e)).length||(t=u(e)),u.extend(this,{click:function(e,t){var n=d.eq(e),i=!o.data("tabs");if("string"==typeof e&&e.replace("#","")&&(n=d.filter('[href*="'+e.replace("#","")+'"]'),e=Math.max(d.index(n),0)),s.rotate){var a=d.length-1;if(e<0)return l.click(a,t);if(a<e)return l.click(0,t)}if(!n.length){if(0<=r)return l;e=s.initialIndex,n=d.eq(e)}return e===r?l:((t=t||u.Event()).type="onBeforeClick",c.trigger(t,[e]),t.isDefaultPrevented()?void 0:(a=i?s.initialEffect&&s.effect||"default":s.effect,h[a].call(l,e,function(){r=e,t.type="onClick",c.trigger(t,[e])}),d.removeClass(s.current),n.addClass(s.current),l))},getConf:function(){return s},getTabs:function(){return d},getPanes:function(){return t},getCurrentPane:function(){return t.eq(r)},getCurrentTab:function(){return d.eq(r)},getIndex:function(){return r},next:function(){return l.click(r+1)},prev:function(){return l.click(r-1)},destroy:function(){return d.off(s.event).removeClass(s.current),t.find('a[href^="#"]').off("click.T"),l}}),u.each("onBeforeClick,onClick".split(","),function(e,t){u.isFunction(s[t])&&u(l).on(t,s[t]),l[t]=function(e){return e&&u(l).on(t,e),l}}),s.history&&u.fn.history&&(u.tools.history.init(d),s.event="history"),d.each(function(t){u(this).on(s.event,function(e){return l.click(t,e),e.preventDefault()})}),t.find('a[href^="#"]').on("click.T",function(e){l.click(u(this).attr("href"),e)}),location.hash&&"a"==s.tabs&&o.find('[href="'+location.hash+'"]').length?l.click(location.hash):(0===s.initialIndex||0<s.initialIndex)&&l.click(s.initialIndex)}function O(e){var t;e&&((t=r.contentWindow.document).open().close(),t.location.hash=e)}function $(){var e,t;return/msie/.test(navigator.userAgent.toLowerCase())?(e=c(document).height(),t=c(window).height(),[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,e-t<20?t:e]):[c(document).width(),c(document).height()]}function A(e){if(e)return e.call(c.mask)}function I(e,t,n){var i=(n.relative?e.position():e.offset()).top,a=(n.relative?e.position():e.offset()).left,o=n.position[0],s=(i-=t.outerHeight()-n.offset[0],a+=e.outerWidth()+n.offset[1],/iPad/i.test(navigator.userAgent)&&(i-=T(window).scrollTop()),t.outerHeight()+e.outerHeight()),s=("center"==o&&(i+=s/2),"bottom"==o&&(i+=s),o=n.position[1],t.outerWidth()+e.outerWidth());return"center"==o&&(a-=s/2),"left"==o&&(a-=s),{top:i,left:a}}function M(n,i){var a,o,s=this,r=n.add(s),l=0,c=0,d=n.attr("title"),u=n.attr("data-tooltip"),h=S[i.effect],e=n.is(":input"),t=e&&n.is(":checkbox, :radio, select, :button, :submit"),p=n.attr("type"),f=i.events[p]||i.events[e?t?"widget":"input":"def"];if(!h)throw'Nonexistent effect "'+i.effect+'"';if(2!=(f=f.split(/,\s*/)).length)throw"Tooltip: bad events configuration for "+p;n.on(f[0],function(e){clearTimeout(l),i.predelay?c=setTimeout(function(){s.show(e)},i.predelay):s.show(e)}).on(f[1],function(e){clearTimeout(c),i.delay?l=setTimeout(function(){s.hide(e)},i.delay):s.hide(e)}),d&&i.cancelDefault&&(n.removeAttr("title"),n.data("title",d)),T.extend(s,{show:function(e){var t;if(a||(u?a=T(u):i.tip?a=T(i.tip).eq(0):d?a=T(i.layout).addClass(i.tipClass).appendTo(document.body).hide().append(d):(a=(a=n.find("."+i.tipClass)).length?a:n.next()).length||(a=n.parent().next()),a.length))return s.isShown()||(a.stop(!0,!0),t=I(n,a,i),i.tip&&a.html(n.data("title")),(e=T.Event()).type="onBeforeShow",r.trigger(e,[t]),e.isDefaultPrevented())||(t=I(n,a,i),a.css({position:"absolute",top:t.top,left:t.left}),o=!0,h[0].call(s,function(){e.type="onShow",o="full",r.trigger(e)}),t=i.events.tooltip.split(/,\s*/),a.data("__set"))||(a.off(t[0]).on(t[0],function(){clearTimeout(l),clearTimeout(c)}),t[1]&&!n.is("input:not(:checkbox, :radio), textarea")&&a.off(t[1]).on(t[1],function(e){e.relatedTarget!=n[0]&&n.trigger(f[1].split(" ")[0])}),i.tip)||a.data("__set",!0),s;throw"Cannot find tooltip for "+n},hide:function(e){return a&&s.isShown()?((e=T.Event()).type="onBeforeHide",r.trigger(e),e.isDefaultPrevented()?void 0:(o=!1,S[i.effect][1].call(s,function(){e.type="onHide",r.trigger(e)}),s)):s},isShown:function(e){return e?"full"==o:o},getConf:function(){return i},getTip:function(){return a},getTrigger:function(){return n}}),T.each("onHide,onBeforeShow,onShow,onBeforeHide".split(","),function(e,t){T.isFunction(i[t])&&T(s).on(t,i[t]),s[t]=function(e){return e&&T(s).on(t,e),s}})}(f=jQuery).tools=f.tools||{version:"@VERSION"},f.tools.overlay={addEffect:function(e,t,n){g[e]=[t,n]},conf:{close:null,closeOnClick:!0,closeOnEsc:!0,closeSpeed:"fast",effect:"default",fixed:!/msie/.test(navigator.userAgent.toLowerCase())||6<navigator.appVersion,left:"center",load:!1,mask:null,oneInstance:!0,speed:"normal",target:null,top:"10%"}},m=[],g={},f.tools.overlay.addEffect("default",function(e,t){var n=this.getConf(),i=f(window);n.fixed||(e.top+=i.scrollTop(),e.left+=i.scrollLeft()),e.position=n.fixed?"fixed":"absolute",this.getOverlay().css(e).fadeIn(n.speed,t)},function(e){this.getOverlay().fadeOut(this.getConf().closeSpeed,e)}),f.fn.overlay=function(e){var t=this.data("overlay");return t||(f.isFunction(e)&&(e={onBeforeLoad:e}),e=f.extend(!0,{},f.tools.overlay.conf,e),this.each(function(){t=new n(f(this),e),m.push(t),f(this).data("overlay",t)}),e.api?t:this)},(p=jQuery).tools=p.tools||{version:"@VERSION"},p.tools.scrollable={conf:{activeClass:"active",circular:!1,clonedClass:"cloned",disabledClass:"disabled",easing:"swing",initialIndex:0,item:"> *",items:".items",keyboard:!0,mousewheel:!1,next:".next",prev:".prev",size:1,speed:400,vertical:!1,touch:!0,wheelSpeed:0}},p.fn.scrollable=function(e){var t=this.data("scrollable");return t||(e=p.extend({},p.tools.scrollable.conf,e),this.each(function(){t=new E(p(this),e),p(this).data("scrollable",t)}),e.api?t:this)},(u=jQuery).tools=u.tools||{version:"@VERSION"},u.tools.tabs={conf:{tabs:"a",current:"current",onBeforeClick:null,onClick:null,effect:"default",initialEffect:!1,initialIndex:0,event:"click",rotate:!1,slideUpSpeed:400,slideDownSpeed:400,history:!1},addEffect:function(e,t){h[e]=t}},h={default:function(e,t){this.getPanes().hide().eq(e).show(),t.call()},fade:function(e,t){var n=this.getConf(),i=n.fadeOutSpeed,a=this.getPanes();i?a.fadeOut(i):a.hide(),a.eq(e).fadeIn(n.fadeInSpeed,t)},slide:function(e,t){var n=this.getConf();this.getPanes().slideUp(n.slideUpSpeed),this.getPanes().eq(e).slideDown(n.slideDownSpeed,t)},ajax:function(e,t){this.getPanes().eq(0).load(this.getTabs().eq(e).attr("href"),t)}},u.tools.tabs.addEffect("horizontal",function(e,t){var n;i||(n=this.getPanes().eq(e),e=this.getCurrentPane(),a=a||this.getPanes().eq(0).width(),i=!0,n.show(),e.animate({width:0},{step:function(e){n.css("width",a-e)},complete:function(){u(this).hide(),t.call(),i=!1}}),e.length)||(t.call(),i=!1)}),u.fn.tabs=function(e,t){var n=this.data("tabs");return n&&(n.destroy(),this.removeData("tabs")),u.isFunction(t)&&(t={onBeforeClick:t}),t=u.extend({},u.tools.tabs.conf,t),this.each(function(){n=new D(u(this),e,t),u(this).data("tabs",n)}),t.api?n:this},(o=jQuery).tools=o.tools||{version:"@VERSION"},o.tools.history={init:function(e){t||(o.browser.msie&&o.browser.version<"8"?r||(r=o("<iframe/>").attr("src","javascript:false;").hide().get(0),o("body").append(r),setInterval(function(){var e=r.contentWindow.document.location.hash;s!==e&&o(window).trigger("hash",e)},100),O(location.hash||"#")):setInterval(function(){var e=location.hash;e!==s&&o(window).trigger("hash",e)},100),l=l?l.add(e):e,e.click(function(e){var t=o(this).attr("href");if(r&&O(t),"#"!=t.slice(0,1))return location.href="#"+t,e.preventDefault()}),t=!0)}},o(window).on("hash",function(e,t){(t?l.filter(function(){var e=o(this).attr("href");return e==t||e==t.replace("#","")}):l.eq(0)).trigger("history",[t]),s=t}),o.fn.history=function(e){return o.tools.history.init(this),this.on("history",e)},(c=jQuery).tools=c.tools||{version:"@VERSION"},d=c.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",closeOnClick:!0,closeOnEsc:!0,zIndex:9998,opacity:.8,startOpacity:0,color:"#fff",onLoad:null,onClose:null}},c.mask={load:function(e,t){var n;return w||(e=(e="string"==typeof e?{color:e}:e)||k,k=e=c.extend(c.extend({},d.conf),e),(v=c("#"+e.maskId)).length||(v=c("<div/>").attr("id",e.maskId),c("body").append(v)),n=$(),v.css({position:"absolute",top:0,left:0,width:n[0],height:n[1],display:"none",opacity:e.startOpacity,zIndex:e.zIndex}),e.color&&v.css("backgroundColor",e.color),!1!==A(e.onBeforeLoad)&&(e.closeOnEsc&&c(document).on("keydown.mask",function(e){27==e.keyCode&&c.mask.close(e)}),e.closeOnClick&&v.on("click.mask",function(e){c.mask.close(e)}),c(window).on("resize.mask",function(){c.mask.fit()}),t&&t.length&&(x=t.eq(0).css("zIndex"),c.each(t,function(){var e=c(this);/relative|absolute|fixed/i.test(e.css("position"))||e.css("position","relative")}),b=t.css({zIndex:Math.max(e.zIndex+1,"auto"==x?0:x)})),v.css({display:"block"}).fadeTo(e.loadSpeed,e.opacity,function(){c.mask.fit(),A(e.onLoad),w="full"}),w=!0)),this},close:function(){if(w){if(!1===A(k.onBeforeClose))return this;v.fadeOut(k.closeSpeed,function(){b&&b.css({zIndex:x}),w=!1,A(k.onClose)}),c(document).off("keydown.mask"),v.off("click.mask"),c(window).off("resize.mask")}return this},fit:function(){var e;w&&(e=$(),v.css({width:e[0],height:e[1]}))},getMask:function(){return v},isLoaded:function(e){return e?"full"==w:w},getConf:function(){return k},getExposed:function(){return b}},c.fn.mask=function(e){return c.mask.load(e),this},c.fn.expose=function(e){return c.mask.load(e,this),this},(T=jQuery).tools=T.tools||{version:"@VERSION"},T.tools.tooltip={conf:{effect:"toggle",fadeOutSpeed:"fast",predelay:0,delay:30,opacity:1,tip:0,fadeIE:!1,position:["top","center"],offset:[0,0],relative:!1,cancelDefault:!0,events:{def:"mouseenter,mouseleave",input:"focus,blur",widget:"focus mouseenter,blur mouseleave",tooltip:"mouseenter,mouseleave"},layout:"<div/>",tipClass:"tooltip"},addEffect:function(e,t,n){S[e]=[t,n]}},S={toggle:[function(e){var t=this.getConf(),n=this.getTip(),t=t.opacity;t<1&&n.css({opacity:t}),n.show(),e.call()},function(e){this.getTip().hide(),e.call()}],fade:[function(e){var t=this.getConf();!/msie/.test(navigator.userAgent.toLowerCase())||t.fadeIE?this.getTip().fadeTo(t.fadeInSpeed,t.opacity,e):(this.getTip().show(),e())},function(e){var t=this.getConf();!/msie/.test(navigator.userAgent.toLowerCase())||t.fadeIE?this.getTip().fadeOut(t.fadeOutSpeed,e):(this.getTip().hide(),e())}]},T.fn.tooltip=function(e){var t=this.data("tooltip");return t||("string"==typeof(e=T.extend(!0,{},T.tools.tooltip.conf,e)).position&&(e.position=e.position.split(/,?\s/)),this.each(function(){t=new M(T(this),e),T(this).data("tooltip",t)}),e.api?t:this)}}.apply(e,arguments)})}(this),function(e){define("resource-plone-app-jquerytools-dateinput-js",["jquery"],function(){return function(){function M(e,t){return new Date(e,t+1,0).getDate()}function l(e,t){for(e=""+e,t=t||2;e.length<t;)e="0"+e;return e}function c(e,t,n,i){var a=t.getDate(),o=t.getDay(),s=t.getMonth(),r=t.getFullYear(),a={d:a,dd:l(a),ddd:F[i].shortDays[o],dddd:F[i].days[o],m:s+1,mm:l(s+1),mmm:F[i].shortMonths[s],mmmm:F[i].months[s],yy:String(r).slice(2),yyyy:r},o=u[e](n,t,a,i);return p.html(o).html()}function R(e){return parseInt(e,10)}function P(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()==t.getMonth()&&e.getDate()==t.getDate()}function _(e){if(e!==N){if(e.constructor==Date)return e;if("string"==typeof e){var t=e.split("-");if(3==t.length)return new Date(R(t[0]),R(t[1])-1,R(t[2]));if(!/^-?\d+$/.test(e))return;e=R(e)}t=new Date;return t.setDate(t.getDate()+e),t}}function i(o,p){function f(e,t,n){o.attr("readonly")?k.hide(n):(y=(E=e).getFullYear(),v=e.getMonth(),b=e.getDate(),"click"!=(n=n||j.Event("api")).type||/msie/.test(navigator.userAgent.toLowerCase())||o.focus(),n.type="beforeChange",s.trigger(n,[e]),n.isDefaultPrevented()||(o.val(c(t.formatter,e,t.format,t.lang)),n.type="change",n.target=o[0],s.trigger(n),o.data("date",e),k.hide(n)))}function n(e){e.type="onShow",s.trigger(e),j(document).on("keydown.d",function(e){var t,n,i,a;return!!e.ctrlKey||(8==(t=e.keyCode)||46==t?(o.val(""),k.hide(e)):27==t||9==t?k.hide(e):0<=j(h).index(t)?(w?(n=j("#"+T.weeks+" a"),i=j("."+T.focus),a=n.index(i),i.removeClass(T.focus),74==t||40==t?a+=7:75==t||38==t?a-=7:76==t||39==t?a+=1:72!=t&&37!=t||--a,(i=41<a?(k.addMonth(),j("#"+T.weeks+" a:eq("+(a-42)+")")):a<0?(k.addMonth(-1),j("#"+T.weeks+" a:eq("+(a+42)+")")):n.eq(a)).addClass(T.focus)):k.show(e),e.preventDefault()):34==t?k.addMonth():33==t?k.addMonth(-1):36==t?k.today():(13!=t||j(e.target).is("select")||j("."+T.focus).click(),0<=j([16,17,18,9]).index(t)))}),j(document).on("click.d",function(e){var t=e.target;t.id==T.root||j(t).parents("#"+T.root).length||t==o[0]||i&&t==i[0]||k.hide(e)})}var i,m,g,y,v,b,w,e,k=this,x=new Date,t=x.getFullYear(),T=p.css,S=F[p.lang],a=j("#"+T.root),C=a.find("#"+T.title),E=o.attr("data-value")||p.value||o.val(),D=o.attr("min")||p.min,O=o.attr("max")||p.max;if(0===D&&(D="0"),E=_(E)||x,D=_(D||new Date(t+p.yearRange[0],1,1)),O=_(O||new Date(t+p.yearRange[1]+1,1,-1)),!S)throw"Dateinput: invalid language: "+p.lang;"date"==o.attr("type")&&(t=(e=o.clone()).wrap("<div/>").parent().html(),t=j(t.replace(/type/i,"type=text data-orig-type")),p.value&&t.val(p.value),o.replaceWith(t),o=t),o.addClass(T.input);var s=o.add(k);if(!a.length){(a=j("<div><div><a/><div/><a/></div><div><div/><div/></div></div>").hide().css({position:"absolute"}).attr("id",T.root)).children().eq(0).attr("id",T.head).end().eq(1).attr("id",T.body).children().eq(0).attr("id",T.days).end().eq(1).attr("id",T.weeks).end().end().end().find("a").eq(0).attr("id",T.prev).end().eq(1).attr("id",T.next),C=a.find("#"+T.head).find("div").attr("id",T.title),p.selectors&&(I=j("<select/>").attr("id",T.month),A=j("<select/>").attr("id",T.year),C.html(I.add(A)));for(var r=a.find("#"+T.days),l=0;l<7;l++)r.append(j("<span/>").text(S.shortDays[(l+p.firstDay)%7]));j("body").append(a)}p.trigger&&(i=j("<a/>").attr("href","#").addClass(T.trigger).click(function(e){return p.toggle?k.toggle():k.show(),e.preventDefault()}).insertAfter(o));var $=a.find("#"+T.weeks),A=a.find("#"+T.year),I=a.find("#"+T.month);j.extend(k,{show:function(e){var t;if(!o.attr("disabled")&&!w&&((e=e||j.Event()).type="onBeforeShow",s.trigger(e),!e.isDefaultPrevented()))return j.each(d,function(){this.hide()}),w=!0,I.off("change").change(function(){k.setValue(R(A.val()),R(j(this).val()))}),A.off("change").change(function(){k.setValue(R(j(this).val()),R(I.val()))}),m=a.find("#"+T.prev).off("click").click(function(){return m.hasClass(T.disabled)||k.addMonth(-1),!1}),g=a.find("#"+T.next).off("click").click(function(){return g.hasClass(T.disabled)||k.addMonth(),!1}),k.setValue(E),t=o.offset(),/iPad/i.test(navigator.userAgent)&&(t.top-=j(window).scrollTop()),a.css({top:t.top+o.outerHeight(!0)+p.offset[0],left:t.left+p.offset[1]}),p.speed?a.show(p.speed,function(){n(e)}):(a.show(),n(e)),k},setValue:function(n,e,t){var i=-1<=R(e)?new Date(R(n),R(e),R(t==N||isNaN(t)?1:t)):n||E;if(i<D?i=D:O<i&&(i=O),"string"==typeof n&&(i=_(n)),n=i.getFullYear(),e=i.getMonth(),t=i.getDate(),-1==e?(e=11,n--):12==e&&(e=0,n++),w){v=e,y=n,b=t;var a,o=new Date(n,e,1-p.firstDay).getDay(),s=M(n,e),r=M(n,e-1);if(p.selectors){I.empty(),j.each(S.months,function(e,t){D<new Date(n,e+1,1)&&O>new Date(n,e,0)&&I.append(j("<option/>").html(t).attr("value",e))}),A.empty();for(var l=x.getFullYear(),c=l+p.yearRange[0];c<l+p.yearRange[1];c++)D<new Date(c+1,0,1)&&O>new Date(c,0,0)&&A.append(j("<option/>").text(c));I.val(e),A.val(n)}else C.html(S.months[e]+" "+n);$.empty(),m.add(g).removeClass(T.disabled);for(var d,u,h=o?0:-7;h<(o?42:35);h++)d=j("<a/>"),h%7==0&&(a=j("<div/>").addClass(T.week),$.append(a)),h<o?(d.addClass(T.off),u=r-o+h+1,i=new Date(n,e-1,u)):o+s<=h?(d.addClass(T.off),u=h-s-o+1,i=new Date(n,e+1,u)):(u=h-o+1,i=new Date(n,e,u),P(E,i)?d.attr("id",T.current).addClass(T.focus):P(x,i)&&d.attr("id",T.today)),D&&i<D&&d.add(m).addClass(T.disabled),O&&O<i&&d.add(g).addClass(T.disabled),d.attr("href","#"+u).text(u).data("date",i),a.append(d);$.find("a").click(function(e){var t=j(this);return t.hasClass(T.disabled)||(j("#"+T.current).removeAttr("id"),t.attr("id",T.current),f(t.data("date"),p,e)),!1}),T.sunday&&$.find("."+T.week).each(function(){var e=p.firstDay?7-p.firstDay:0;j(this).children().slice(e,1+e).addClass(T.sunday)})}else f(i,p);return k},setMin:function(e,t){return D=_(e),t&&E<D&&k.setValue(D),k},setMax:function(e,t){return O=_(e),t&&O<E&&k.setValue(O),k},today:function(){return k.setValue(x)},addDay:function(e){return this.setValue(y,v,b+(e||1))},addMonth:function(e){var e=v+(e||1),t=M(y,e),t=b<=t?b:t;return this.setValue(y,e,t)},addYear:function(e){return this.setValue(y+(e||1),v,b)},destroy:function(){o.add(document).off("click.d keydown.d"),a.add(i).remove(),o.removeData("dateinput").removeClass(T.input),e&&o.replaceWith(e)},hide:function(e){if(w){if((e=j.Event()).type="onHide",s.trigger(e),e.isDefaultPrevented())return;j(document).off("click.d keydown.d"),a.hide(),w=!1}return k},toggle:function(){return k.isOpen()?k.hide():k.show()},getConf:function(){return p},getInput:function(){return o},getCalendar:function(){return a},getValue:function(e){return e?c(p.formatter,E,e,p.lang):E},isOpen:function(){return w}}),j.each(["onBeforeShow","onShow","change","onHide"],function(e,t){j.isFunction(p[t])&&j(k).on(t,p[t]),k[t]=function(e){return e&&j(k).on(t,e),k}}),p.editable||o.on("focus.d click.d",k.show).keydown(function(e){var t=e.keyCode;return!w&&0<=j(h).index(t)?(k.show(e),e.preventDefault()):(8!=t&&46!=t||o.val(""),!!(e.shiftKey||e.ctrlKey||e.altKey||9==t)||e.preventDefault())}),_(o.val())&&f(E,p)}var j,N,d,u,h,F,e,p;(j=jQuery).tools=j.tools||{version:"@VERSION"},d=[],u={},h=[75,76,38,39,74,72,40,37],F={},(e=j.tools.dateinput={conf:{format:"mm/dd/yy",formatter:"default",selectors:!1,yearRange:[-5,5],lang:"en",offset:[0,0],speed:0,firstDay:0,min:N,max:N,trigger:0,toggle:0,editable:0,css:{prefix:"cal",input:"date",root:0,head:0,title:0,prev:0,next:0,month:0,year:0,days:0,body:0,weeks:0,today:0,current:0,week:0,off:0,sunday:0,focus:0,disabled:0,trigger:0}},addFormatter:function(e,t){u[e]=t},localize:function(e,n){j.each(n,function(e,t){n[e]=t.split(",")}),F[e]=n}}).localize("en",{months:"January,February,March,April,May,June,July,August,September,October,November,December",shortMonths:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday",shortDays:"Sun,Mon,Tue,Wed,Thu,Fri,Sat"}),p=j("<a/>"),e.addFormatter("default",function(e,t,n){return e.replace(/d{1,4}|m{1,4}|yy(?:yy)?|"[^"]*"|'[^']*'/g,function(e){return e in n?n[e]:e})}),e.addFormatter("prefixed",function(e,t,n){return e.replace(/%(d{1,4}|m{1,4}|yy(?:yy)?|"[^"]*"|'[^']*')/g,function(e,t){return t in n?n[t]:e})}),j.expr[":"].date=function(e){var t=e.getAttribute("type");return t&&"date"==t||!!j(e).data("dateinput")},j.fn.dateinput=function(n){var t;return!this.data("dateinput")&&(n=j.extend(!0,{},e.conf,n),j.each(n.css,function(e,t){t||"prefix"==e||(n.css[e]=(n.css.prefix||"")+(t||e))}),this.each(function(){var e=new i(j(this),n),e=(d.push(e),e.getInput().data("dateinput",e));t=t?t.add(e):e}),t)||this}}.apply(e,arguments)})}(this),function(e){define("jquery.tmpl",["jquery"],function(){return function(){function c(e,t,n,i){i={data:i||(t?t.data:{}),_wrap:t?t._wrap:null,tmpl:null,parent:t||null,nodes:[],calls:a,nest:u,wrap:h,html:p,update:f};return e&&m.extend(i,e,{nodes:[],parent:t}),n&&(i.tmpl=n,i._ctnt=i._ctnt||i.tmpl(m,i),i.key=++x,(S.length?w:b)[x]=i),i}function o(t,e,n){var a,n=n?m.map(n,function(e){return"string"==typeof e?t.key?e.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+v+'="'+t.key+'" $2'):e:o(e,t,e._ctnt)}):t;return e?n:((n=n.join("")).replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(e,t,n,i){l(a=m(n).get()),t&&(a=s(t).concat(a)),i&&(a=a.concat(s(i)))}),a||s(n))}function s(e){var t=document.createElement("div");return t.innerHTML=e,m.makeArray(t.childNodes)}function n(e){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+m.trim(e).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(e,t,n,i,a,o,s){var r,l,c=m.tmpl.tag[n];if(c)return r=c._default||[],o&&!/\w$/.test(a)&&(a+=o,o=""),s=a?(a=d(a),s=s?","+d(s)+")":o?")":"",l=o?-1<a.indexOf(".")?a+o:"("+a+").call($item"+s:a,o?l:"(typeof("+a+")==='function'?("+a+").call($item):("+a+"))"):l=r.$1||"null",i=d(i),"');"+c[t?"close":"open"].split("$notnull_1").join(a?"typeof("+a+")!=='undefined' && ("+a+")!=null":"true").split("$1a").join(s).split("$1").join(l).split("$2").join(i?i.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,function(e,t,n,i){return(i=i?","+i+")":n?")":"")?"("+t+").call($item"+i:e}):r.$2||"")+"_.push('";throw"Template command not found: "+n})+"');}return _;")}function r(e,t){e._wrap=o(e,!0,m.isArray(t)?t:[i.test(t)?t:m(t).html()]).join("")}function d(e){return e?e.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function l(e){for(var t,n,i,r="_"+T,l={},a=0,o=e.length;a<o;a++)if(1===(t=e[a]).nodeType){for(i=(n=t.getElementsByTagName("*")).length-1;0<=i;i--)s(n[i]);s(t)}function s(e){var t,n,i,a,o=e;if(a=e.getAttribute(v)){for(;o.parentNode&&1===(o=o.parentNode).nodeType&&!(t=o.getAttribute(v)););t!==a&&(o=o.parentNode&&11!==o.nodeType&&o.getAttribute(v)||0,(i=b[a])||((i=c(i=w[a],b[o]||w[o],null,!0)).key=++x,b[x]=i),T)&&s(a),e.removeAttribute(v)}else T&&(i=m.data(e,"tmplItem"))&&(s(i.key),b[i.key]=i,o=(o=m.data(e.parentNode,"tmplItem"))?o.key:0);if(i){for(n=i;n&&n.key!=o;)n.nodes.push(e),n=n.parent;delete i._ctnt,delete i._wrap,m.data(e,"tmplItem",i)}function s(e){i=l[e+=r]=l[e]||c(i,b[i.parent.key+r]||i.parent,null,!0)}}}function a(e,t,n,i){if(!e)return S.pop();S.push({_:e,tmpl:t,item:this,data:n,options:i})}function u(e,t,n){return m.tmpl(m.template(e),t,n,this)}function h(e,t){var n=e.options||{};return n.wrapped=t,m.tmpl(m.template(e.tmpl),e.data,n,e.item)}function p(e,n){var t=this._wrap;return m.map(m(m.isArray(t)?t.join(""):t).filter(e||"*"),function(e){return n?e.innerText||e.textContent:e.outerHTML||(e=e,(t=document.createElement("div")).appendChild(e.cloneNode(!0)),t.innerHTML);var t})}function f(){var e=this.nodes;m.tmpl(null,null,null,this).insertBefore(e[0]),m(e).remove()}var m,g,y,v,i,b,w,k,x,T,S;m=jQuery,y=m.fn.domManip,v="_tmplitem",i=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,b={},w={},k={key:0,data:{}},T=x=0,S=[],m.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(s,r){m.fn[s]=function(e){var t,n,i,a=[],o=m(e),e=1===this.length&&this[0].parentNode;if(g=b||{},e&&11===e.nodeType&&1===e.childNodes.length&&1===o.length)o[r](this[0]),a=this;else{for(n=0,i=o.length;n<i;n++)t=(0<(T=n)?this.clone(!0):this).get(),m.fn[r].apply(m(o[n]),t),a=a.concat(t);T=0,a=this.pushStack(a,s,o.selector)}return e=g,g=null,m.tmpl.complete(e),a}}),m.fn.extend({tmpl:function(e,t,n){return m.tmpl(this[0],e,t,n)},tmplItem:function(){return m.tmplItem(this[0])},template:function(e){return m.template(e,this[0])},domManip:function(e,t,n,i){if(e[0]&&e[0].nodeType){for(var a,o=m.makeArray(arguments),s=e.length,r=0;r<s&&!(a=m.data(e[r++],"tmplItem")););1<s&&(o[0]=[m.makeArray(e)]),a&&T&&(o[2]=function(e){m.tmpl.afterManip(this,e,n)}),y.apply(this,o)}else y.apply(this,arguments);return T=0,g||m.tmpl.complete(b),this}}),m.extend({tmpl:function(t,e,n,i){var a=!i;if(a)i=k,t=m.template[t]||m.template(null,t),w={};else if(!t)return t=i.tmpl,(b[i.key]=i).nodes=[],i.wrapped&&r(i,i.wrapped),m(o(i,null,i.tmpl(m,i)));return t?("function"==typeof e&&(e=e.call(i||{})),n&&n.wrapped&&r(n,n.wrapped),e=m.isArray(e)?m.map(e,function(e){return e?c(n,i,t,e):null}):[c(n,i,t,e)],a?m(o(i,null,e)):e):[]},tmplItem:function(e){var t;for(e instanceof m&&(e=e[0]);e&&1===e.nodeType&&!(t=m.data(e,"tmplItem"))&&(e=e.parentNode););return t||k},template:function(e,t){return t?("string"==typeof t?t=n(t):t instanceof m&&(t=t[0]||{}),t.nodeType&&(t=m.data(t,"tmpl")||m.data(t,"tmpl",n(t.innerHTML))),"string"==typeof e?m.template[e]=t:t):e?"string"!=typeof e?m.template(null,e):m.template[e]||m.template(null,i.test(e)?e:m(e)):null},encode:function(e){return(""+e).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}}),m.extend(m.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},if:{open:"if(($notnull_1) && $1a){",close:"}"},else:{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(e){b={}},afterManip:function(e,t,n){var i=11===t.nodeType?m.makeArray(t.childNodes):1===t.nodeType?[t]:[];n.call(e,t),l(i),T++}})}.apply(e,arguments)})}(this),function(e){define("jquery.recurrenceinput",["jquery","resource-plone-app-jquerytools-js","resource-plone-app-jquerytools-dateinput-js","jquery.tmpl"],function(){return function(){function r(e,t){for(e=e.toString(),t=t||2;e.length<t;)e="0"+e;return e}function k(e,t,n){var i=e.getDate(),a=e.getDay(),o=e.getMonth(),e=e.getFullYear(),s={d:i,dd:r(i),ddd:n.i18n.shortWeekdays[a],dddd:n.i18n.weekdays[a],m:o+1,mm:r(o+1),mmm:n.i18n.shortMonths[o],mmmm:n.i18n.months[o],yy:String(e).slice(2),yyyy:e};return t.replace(l,function(e){return s.hasOwnProperty(e)?s[e]:e.slice(1,e.length-1)})}function p(e,t,n){for(var i,a,o,s,r,l,c,d,u,h,p,f=e.find("select[name=rirtemplate]").val(),m=t.rtemplate[f],g=m.rrule,y=t.i18n.rtemplate[f],v=0;v<m.fields.length;v++)switch((i=e.find("#"+m.fields[v])).attr("id")){case"ridailyinterval":"1"!==(h=i.find("input[name=ridailyinterval]").val())&&(g+=";INTERVAL="+h),y=h+" "+t.i18n.dailyInterval2;break;case"riweeklyinterval":"1"!==(h=i.find("input[name=riweeklyinterval]").val())&&(g+=";INTERVAL="+h),y=h+" "+t.i18n.weeklyInterval2;break;case"riweeklyweekdays":for(o=a="",s=0;s<t.weekdays.length;s++)i.find("input[name=riweeklyweekdays"+t.weekdays[s]+"]").is(":checked")&&(a&&(a+=",",o+=", "),a+=t.weekdays[s],o+=t.i18n.weekdays[s]);a&&(g+=";BYDAY="+a,y+=" "+t.i18n.weeklyWeekdaysHuman+" "+o);break;case"rimonthlyinterval":"1"!==(h=i.find("input[name=rimonthlyinterval]").val())&&(g+=";INTERVAL="+h),y=h+" "+t.i18n.monthlyInterval2;break;case"rimonthlyoptions":switch($("input[name=rimonthlytype]:checked",e).val()){case"DAYOFMONTH":g+=";BYMONTHDAY="+(c=$("select[name=rimonthlydayofmonthday]",e).val()),y+=", "+t.i18n.monthlyDayOfMonth1Human+" "+c+" "+t.i18n.monthlyDayOfMonth2;break;case"WEEKDAYOFMONTH":r=$("select[name=rimonthlyweekdayofmonthindex]",e).val(),c=$("select[name=rimonthlyweekdayofmonth]",e).val(),-1<$.inArray(c,["MO","TU","WE","TH","FR","SA","SU"])&&(g+=";BYDAY="+r+c,y=(y=(y=(y=(y+=", "+t.i18n.monthlyWeekdayOfMonth1Human+" ")+" "+t.i18n.orderIndexes[$.inArray(r,t.orderIndexes)])+" "+t.i18n.monthlyWeekdayOfMonth2)+" "+t.i18n.weekdays[$.inArray(c,t.weekdays)])+" "+t.i18n.monthlyDayOfMonth2)}break;case"riyearlyinterval":"1"!==(h=i.find("input[name=riyearlyinterval]").val())&&(g+=";INTERVAL="+h),y=h+" "+t.i18n.yearlyInterval2;break;case"riyearlyoptions":switch($("input[name=riyearlyType]:checked",e).val()){case"DAYOFMONTH":g=g+(";BYMONTH="+(d=$("select[name=riyearlydayofmonthmonth]",e).val()))+(";BYMONTHDAY="+(c=$("select[name=riyearlydayofmonthday]",e).val())),y+=", "+t.i18n.yearlyDayOfMonth1Human+" "+t.i18n.months[d-1]+" "+c;break;case"WEEKDAYOFMONTH":r=$("select[name=riyearlyweekdayofmonthindex]",e).val(),c=$("select[name=riyearlyweekdayofmonthday]",e).val(),g+=";BYMONTH="+(d=$("select[name=riyearlyweekdayofmonthmonth]",e).val()),-1<$.inArray(c,["MO","TU","WE","TH","FR","SA","SU"])&&(g+=";BYDAY="+r+c,y=(y=(y=(y=(y=(y=(y+=", "+t.i18n.yearlyWeekdayOfMonth1Human)+" "+t.i18n.orderIndexes[$.inArray(r,t.orderIndexes)])+" "+t.i18n.yearlyWeekdayOfMonth2)+" "+t.i18n.weekdays[$.inArray(c,t.weekdays)])+" "+t.i18n.yearlyWeekdayOfMonth3)+" "+t.i18n.months[d-1])+" "+t.i18n.yearlyWeekdayOfMonth4)}break;case"rirangeoptions":switch(e.find("input[name=rirangetype]:checked").val()){case"BYOCCURRENCES":g+=";COUNT="+(p=e.find("input[name=rirangebyoccurrencesvalue]").val()),y=(y=y+(", "+t.i18n.rangeByOccurrences1Human)+(" "+p))+(" "+t.i18n.rangeByOccurrences2);break;case"BYENDDATE":g+=";UNTIL="+(i=e.find("input[name=rirangebyenddatecalendar]")).data("dateinput").getValue("yyyymmdd")+"T000000",!0===n&&(g+="Z"),y=(y+=", "+t.i18n.rangeByEndDateHuman)+(" "+i.data("dateinput").getValue(t.i18n.longDateFormat))}}if(void 0!==e.ical.RDATE&&0<e.ical.RDATE.length){for(e.ical.RDATE.sort(),l=[],v=0;v<e.ical.RDATE.length;v++)""!==e.ical.RDATE[v]&&(u=parseInt(e.ical.RDATE[v].substring(0,4),10),d=parseInt(e.ical.RDATE[v].substring(4,6),10)-1,c=parseInt(e.ical.RDATE[v].substring(6,8),10),l.push(k(new Date(u,d,c),t.i18n.longDateFormat,t)));0!==l.length&&(y=y+t.i18n.including+" "+l.join("; "))}if(void 0!==e.ical.EXDATE&&0<e.ical.EXDATE.length){for(e.ical.EXDATE.sort(),l=[],v=0;v<e.ical.EXDATE.length;v++)""!==e.ical.EXDATE[v]&&(u=parseInt(e.ical.EXDATE[v].substring(0,4),10),d=parseInt(e.ical.EXDATE[v].substring(4,6),10)-1,c=parseInt(e.ical.EXDATE[v].substring(6,8),10),l.push(k(new Date(u,d,c),t.i18n.longDateFormat,t)));0!==l.length&&(y=y+t.i18n.except+" "+l.join("; "))}return g="RRULE:"+g,void 0!==e.ical.EXDATE&&""!==e.ical.EXDATE.join()&&(g=g+"\nEXDATE:"+(l=$.map(e.ical.EXDATE,function(e){return 8===e.length&&(e+="T000000"),!0===n&&(e+="Z"),e}))),{result:g=void 0!==e.ical.RDATE&&""!==e.ical.RDATE.join()?g+"\nRDATE:"+(l=$.map(e.ical.RDATE,function(e){return 8===e.length&&(e+="T000000"),!0===n&&(e+="Z"),e})):g,description:y}}function O(e){var t,n,i,a,o,s=[],r={},l=null;for((s=e.split("\n")).reverse();;){if(0<s.length){if(" "===(t=s.pop()).charAt(0)||"\t"===t.charAt(0)){l+=t;continue}}else t="";if(null!==l&&(o=a=i=void 0,i={},a=(n=l).indexOf(":"),o=n.substring(0,a),i.value=n.substring(a+1),-1!==o.indexOf(";")?(a=o.indexOf(";"),i.parameters=o.substring(a+1),i.property=o.substring(0,a)):(i.parameters=null,i.property=o),"RDATE"===(l=i).property||"EXDATE"===l.property?r[l.property]=function(e){var t,n=[],i=e.split(",");for(t in i)i.hasOwnProperty(t)&&(-1!==i[t].indexOf("Z")?n.push(i[t].substring(0,15)):n.push(i[t]));return n}(l.value):r[l.property]=l.value),""===(l=t))break}return r}function x(e,t,n,i){var a,o,s,r,l,c,d,u,h,p,f,m,g,y,v,b,w,k,x,T,S=[];if(e.ical=O(n),void 0===e.ical.RRULE){if(S.push(t.i18n.noRule),!i)return-1}else{for(a in f=(n=/INTERVAL=([0-9]+);?/.exec(e.ical.RRULE))?n[1]:"1",m=(n=/BYDAY=([^;]+);?/.exec(e.ical.RRULE))?n[1]:"",y=(n=/BYMONTHDAY=([^;]+);?/.exec(e.ical.RRULE))?n[1].split(","):null,g=(n=/BYMONTH=([^;]+);?/.exec(e.ical.RRULE))?n[1].split(","):null,v=(n=/COUNT=([0-9]+);?/.exec(e.ical.RRULE))?n[1]:null,b=(n=/UNTIL=([0-9T]+);?/.exec(e.ical.RRULE))?n[1]:null,(n=/BYSETPOS=([^;]+);?/.exec(e.ical.RRULE))&&S.push(t.i18n.bysetpos),o="",s=null,t.rtemplate)t.rtemplate.hasOwnProperty(a)&&(r=t.rtemplate[a],0===e.ical.RRULE.indexOf(r.rrule))&&e.ical.RRULE.length>o.length&&(o=e.ical.RRULE,s=a);if(o)r=t.rtemplate[s],e.find("select[name=rirtemplate]").val(s);else{for(r in t.rtemplate)if(t.rtemplate.hasOwnProperty(r)){r=t.rtemplate[r];break}S.push(t.i18n.noTemplateMatch)}for(a=0;a<r.fields.length;a++)switch((h=e.find("#"+r.fields[a])).attr("id")){case"ridailyinterval":h.find("input[name=ridailyinterval]").val(f);break;case"riweeklyinterval":h.find("input[name=riweeklyinterval]").val(f);break;case"riweeklyweekdays":for(m=m.split(","),l=0;l<t.weekdays.length;l++)w=t.weekdays[l],(c=h.find("input[name=riweeklyweekdays"+w+"]")).attr("checked",-1!==$.inArray(w,m));break;case"rimonthlyinterval":h.find("input[name=rimonthlyinterval]").val(f);break;case"rimonthlyoptions":var C="DAYOFMONTH";for(y&&(C="DAYOFMONTH",1<y.length&&(S.push(t.i18n.multipleDayOfMonth),y=y[0]),h.find("select[name=rimonthlydayofmonthday]").val(y)),m&&(C="WEEKDAYOFMONTH",-1!==m.indexOf(",")&&(S.push(t.i18n.multipleDayOfMonth),m=m.split(",")[0]),"+"!==(d=m.slice(0,-2)).charAt(0)&&"-"!==d.charAt(0)&&(d="+"+d),T=m.slice(-2),h.find("select[name=rimonthlyweekdayofmonthindex]").val(d),h.find("select[name=rimonthlyweekdayofmonth]").val(T)),u=h.find("input[name=rimonthlytype]"),d=0;d<u.length;d++)p=u[d],$(p).attr("checked",p.value===C);break;case"riyearlyinterval":h.find("input[name=riyearlyinterval]").val(f);break;case"riyearlyoptions":var E="DAYOFMONTH";for(y&&(E="DAYOFMONTH",1<y.length&&(S.push(t.i18n.multipleDayOfMonth),y=y[0]),h.find("select[name=riyearlydayofmonthmonth]").val(g),h.find("select[name=riyearlydayofmonthday]").val(y)),m&&(E="WEEKDAYOFMONTH",-1!==m.indexOf(",")&&(S.push(t.i18n.multipleDayOfMonth),m=m.split(",")[0]),"+"!==(d=m.slice(0,-2)).charAt(0)&&"-"!==d.charAt(0)&&(d="+"+d),T=m.slice(-2),h.find("select[name=riyearlyweekdayofmonthindex]").val(d),h.find("select[name=riyearlyweekdayofmonthday]").val(T),h.find("select[name=riyearlyweekdayofmonthmonth]").val(g)),u=h.find("input[name=riyearlyType]"),d=0;d<u.length;d++)p=u[d],$(p).attr("checked",p.value===E);break;case"rirangeoptions":var D="NOENDDATE";for(v&&(D="BYOCCURRENCES",h.find("input[name=rirangebyoccurrencesvalue]").val(v)),b&&(D="BYENDDATE",c=h.find("input[name=rirangebyenddatecalendar]"),x=b.slice(0,4),k=b.slice(4,6),k=parseInt(k,10)-1,w=b.slice(6,8),c.data("dateinput").setValue(new Date(x,k,w))),u=h.find("input[name=rirangetype]"),d=0;d<u.length;d++)p=u[d],$(p).attr("checked",p.value===D)}}i=e.find("#messagearea");return 0!==S.length?(i.text(t.i18n.unsupportedFeatures+" "+S.join("; ")),i.show(),1):(i.text(""),i.hide(),0)}function n(f,t){for(var m,g,e,n=[],i=0;i<7;i++)6<(e=i+f.firstDay)&&(e-=7),n.push(e);function a(e){m.find(".rifield").hide();e=e.val();if(e)for(var t=f.rtemplate[e],n=0;n<t.fields.length;n++)m.find("#"+t.fields[n]).show()}function y(e){e.preventDefault(),void 0===m.ical.EXDATE&&(m.ical.EXDATE=[]),m.ical.EXDATE.push(this.attributes.date.value);var t=$(this);t.attr("class","exdate"),t.parent().parent().addClass("exdate"),t.unbind(e),t.click(v)}function v(e){e.preventDefault(),m.ical.EXDATE.splice($.inArray(this.attributes.date.value,m.ical.EXDATE),1);var t=$(this);t.attr("class","rrule"),t.parent().parent().removeClass("exdate"),t.unbind(e),t.click(y)}function b(e){e.preventDefault(),m.ical.RDATE.splice($.inArray(this.attributes.date.value,m.ical.RDATE),1),$(this).parent().parent().hide("slow",function(){$(this).remove()})}function w(d,u,e,h){var t=h?g:m,p=t.find(".rioccurrences");p.hide();t={year:d.getFullYear(),month:d.getMonth()+1,day:d.getDate(),rrule:u,format:f.i18n.longDateFormat,start:e},e={url:f.ajaxURL,async:!1,type:"post",dataType:"json",contentType:f.ajaxContentType,cache:!1,data:t,success:function(e,t,n){var i,a,o,s,r,l,c=h?g:m;for(l in e.readOnly=h,e.i18n=f.i18n,e.occurrences)e.occurrences.hasOwnProperty(l)&&(r=(a=e.occurrences[l]).date,o=parseInt(r.substring(0,4),10),s=parseInt(r.substring(4,6),10)-1,r=parseInt(r.substring(6,8),10),a.formattedDate=k(new Date(o,s,r),f.i18n.longDateFormat,f));i=$.tmpl("occurrenceTmpl",e),(p=c.find(".rioccurrences")).replaceWith(i),c.find(".rioccurrences .batching a").click(function(e){e.preventDefault(),w(d,u,this.attributes.start.value,h)}),h||(c.find(".rioccurrences .action a.rrule").click(y),c.find(".rioccurrences .action a.exdate").click(v),c.find(".rioccurrences .action a.rdate").click(b)),c.find(".rioccurrences").show()},error:function(e,t,n){alert(t)}};$.ajax(e)}function o(e){var t=$(e);return t=(t=t.length?t:$("#"+e)).length?t:$("input[name='"+e+"']")}function s(){var e,t,n,i=null;if(f.startField){if(!(e=o(f.startField)).length)return null;(i=e.data("dateinput"))?i=i.getValue():""===(i=e.val())&&(i=e.text()),"string"==typeof i&&(i=i.replace(" ","T")),i=new Date(i)}else if(f.startFieldYear&&f.startFieldMonth&&f.startFieldDay){if(e=o(f.startFieldYear),t=o(f.startFieldMonth),n=o(f.startFieldDay),!e.length&&!t.length&&!n.length)return null;i=new Date(e.val(),t.val()-1,n.val())}return null===i||isNaN(i)?null:i}function r(e,t){t=t.find("input[name="+e+"]"),e=t.val();return isNaN(e)||-1!==e.toString().indexOf(".")||""===t.val()?null:e}function l(e){var t,n;e&&x(m,f,e,!0),null!==(e=s())?(m.find("select[name=rimonthlydayofmonthday]").val(e.getDate()),t=f.orderIndexes[Math.floor((e.getDate()-1)/7)],n=f.weekdays[e.getDay()],m.find("select[name=rimonthlyweekdayofmonthindex]").val(t),m.find("select[name=rimonthlyweekdayofmonth]").val(n),m.find("select[name=riyearlydayofmonthmonth]").val(e.getMonth()+1),m.find("select[name=riyearlydayofmonthday]").val(e.getDate()),m.find("select[name=riyearlyweekdayofmonthindex]").val(t),m.find("select[name=riyearlyweekdayofmonthday]").val(n),m.find("select[name=riyearlyweekdayofmonthmonth]").val(e.getMonth()+1),w(e,p(m,f,!1).result,0,!1),m.find("div.rioccurrencesactions").show()):m.find("div.rioccurrencesactions").hide(),a(m.find("select[name=rirtemplate]"))}function c(){var e=p(m,f,!1),e=(g.find("label[class=ridisplay]").text(f.i18n.displayActivate+" "+e.description),t.val(e.result).change(),s());null!==e&&w(e,p(m,f,!1).result,0,!0),g.find('button[name="riedit"]').text(f.i18n.edit_rules),g.find('button[name="ridelete"]').show()}function d(e){var t,n=s(),i=e.find("#messagearea");if(i.text(""),i.hide(),e.find(".riaddoccurrence div.errorarea").text("").hide(),"block"===e.find("#ridailyinterval").css("display")&&(!(t=r("ridailyinterval",e))||t<1||1e3<t))i.text(f.i18n.noRepeatEvery).show();else if("block"===e.find("#riweeklyinterval").css("display")&&(!(t=r("riweeklyinterval",e))||t<1||1e3<t))i.text(f.i18n.noRepeatEvery).show();else{if("block"===e.find("#rimonthlyinterval").css("display")){if(!(t=r("rimonthlyinterval",e))||t<1||1e3<t)return void i.text(f.i18n.noRepeatEvery).show();if(0===e.find("#rimonthlyoptions input:checked").length)return void i.text(f.i18n.noRepeatOn).show()}if("block"===e.find("#riyearlyinterval").css("display")){if(!(t=r("riyearlyinterval",e))||t<1||1e3<t)return void i.text(f.i18n.noRepeatEvery).show();if(0===e.find("#riyearlyoptions input:checked").length)return void i.text(f.i18n.noRepeatOn).show()}if(!(0<e.find('input[value="BYOCCURRENCES"]:visible:checked').length&&(!(t=r("rirangebyoccurrencesvalue",e))||t<1||1e3<t))){if(0<e.find('input[value="BYENDDATE"]:visible:checked').length){if(e=(e=(t=(t=e).find("input[name=rirangebyenddatecalendar]")).data("dateinput"))?e.getValue():t.val(),e=new Date(e),!(e=isNaN(e)||""===t.val()?null:e))return void i.text(f.i18n.noEndDate).show();if(e<n)return void i.text(f.i18n.pastEndDate).show()}return 1}i.text(f.i18n.noEndAfterNOccurrences).show()}}function u(e){e.preventDefault(),d(m)&&(m.overlay().close(),c())}function h(){var e=s();d(m)&&w(e,p(m,f,!1).result,0,!1)}$.extend(f,{orderIndexes:["+1","+2","+3","+4","-1"],weekdays:["SU","MO","TU","WE","TH","FR","SA"],orderedWeekdays:n}),g=$.tmpl("displayTmpl",f),(m=$.tmpl("formTmpl",f)).overlay(f.formOverlay).hide(),m.ical={RDATE:[],EXDATE:[]},$.tools.dateinput.localize(f.lang,{months:T[f.lang].months.join(),shortMonths:T[f.lang].shortMonths.join(),days:T[f.lang].weekdays.join(),shortDays:T[f.lang].shortWeekdays.join()}),m.find("input[name=rirangebyenddatecalendar]").dateinput({selectors:!0,lang:f.lang,format:f.i18n.shortDateFormat,firstDay:f.firstDay,yearRange:[-5,10]}).data("dateinput").setValue(new Date),t.val()&&(-1===x(m,f,t.val(),!1)?g.find("label[class=ridisplay]").text(f.i18n.noRule):c()),g.find("button[name=ridelete]").click(function(e){e.preventDefault(),g.find("label[class=ridisplay]").text(f.i18n.displayUnactivate),t.val("").change(),g.find(".rioccurrences").hide(),g.find('button[name="riedit"]').text(f.i18n.add_rules),g.find('button[name="ridelete"]').hide()}),g.find("button[name=riedit]").click(function(e){l(t.val()),e.preventDefault(),m.overlay().load()}),m.find("div.riaddoccurrence input#adddate").dateinput({selectors:!0,lang:f.lang,format:f.i18n.shortDateFormat,firstDay:f.firstDay,yearRange:[-5,10]}).data("dateinput").setValue(new Date),m.find("input#addaction").click(function(e){e.preventDefault();var t=(e=m.find(".riaddoccurrence input#adddate").data("dateinput")).getValue("yyyymmddT000000"),n=(void 0===m.ical.RDATE&&(m.ical.RDATE=[]),m.find(".riaddoccurrence div.errorarea"));n.text(""),n.hide(),-1===$.inArray(t,m.ical.RDATE)?(m.ical.RDATE.push(t),e=['<div class="occurrence rdate" style="display: none;">','<span class="rdate">',e.getValue(f.i18n.longDateFormat),'<span class="rlabel">'+f.i18n.additionalDate+"</span>","</span>",'<span class="action">','<a date="'+t+'" href="#" class="rdate" >',"Include","</a>","</span>","</div>"].join("\n"),m.find("div.rioccurrences").prepend(e),$(m.find("div.rioccurrences div")[0]).slideDown(),$(m.find("div.rioccurrences .action a.rdate")[0]).click(b)):n.text(f.i18n.alreadyAdded).show()}),m.find("a.rirefreshbutton").click(function(e){e.preventDefault(),h()}),m.find("select[name=rirtemplate]").change(function(e){a($(this))}),m.find("select").change(function(e){$(this).parent().find("> input").click().change()}),m.find("input[name=rirangebyoccurrencesvalue]").change(function(e){$(this).parent().find("input[name=rirangetype]").click().change()}),m.find("input[name=rirangebyenddatecalendar]").change(function(){$(this).parent().find("input[name=rirangetype]").click(),0!==m.find(".rioccurrencesactions:visible").length&&h()}),m.find("input:radio, .riweeklyweekday > input, input[name=ridailyinterval], input[name=riweeklyinterval], input[name=rimonthlyinterval], input[name=riyearlyinterval]").change(function(e){0!==m.find(".rioccurrencesactions:visible").length&&h()}),m.find(".ricancelbutton").click(function(e){e.preventDefault(),m.overlay().close()}),m.find(".risavebutton").click(u),$.extend(this,{display:g,form:m,loadData:l,save:u})}var $,T,a,e,l;($=jQuery).tools=$.tools||{version:"@VERSION"},T={},(a=$.tools.recurrenceinput={conf:{lang:"en",readOnly:!1,firstDay:0,startField:null,startFieldYear:null,startFieldMonth:null,startFieldDay:null,ajaxURL:null,ajaxContentType:"application/json; charset=utf8",ributtonExtraClass:"",hasRepeatForeverButton:!0,formOverlay:{speed:"fast",fixed:!1},template:{form:"#jquery-recurrenceinput-form-tmpl",display:"#jquery-recurrenceinput-display-tmpl"},rtemplate:{daily:{rrule:"FREQ=DAILY",fields:["ridailyinterval","rirangeoptions"]},mondayfriday:{rrule:"FREQ=WEEKLY;BYDAY=MO,FR",fields:["rirangeoptions"]},weekdays:{rrule:"FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR",fields:["rirangeoptions"]},weekly:{rrule:"FREQ=WEEKLY",fields:["riweeklyinterval","riweeklyweekdays","rirangeoptions"]},monthly:{rrule:"FREQ=MONTHLY",fields:["rimonthlyinterval","rimonthlyoptions","rirangeoptions"]},yearly:{rrule:"FREQ=YEARLY",fields:["riyearlyinterval","riyearlyoptions","rirangeoptions"]}}},localize:function(e,t){T[e]=t},setTemplates:function(e,t){var n,i;for(n in a.conf.rtemplate=e,t)if(t.hasOwnProperty(n))for(i in t[n])t[n].hasOwnProperty(i)&&(T[n].rtemplate[i]=t[n][i])}}).localize("en",{displayUnactivate:"Does not repeat",displayActivate:"Repeats every",add_rules:"Add",edit_rules:"Edit",delete_rules:"Delete",add:"Add",refresh:"Refresh",title:"Repeat",preview:"Selected dates",addDate:"Add date",recurrenceType:"Repeats:",dailyInterval1:"Repeat every:",dailyInterval2:"days",weeklyInterval1:"Repeat every:",weeklyInterval2:"week(s)",weeklyWeekdays:"Repeat on:",weeklyWeekdaysHuman:"on:",monthlyInterval1:"Repeat every:",monthlyInterval2:"month(s)",monthlyDayOfMonth1:"Day",monthlyDayOfMonth1Human:"on day",monthlyDayOfMonth2:"of the month",monthlyDayOfMonth3:"month(s)",monthlyWeekdayOfMonth1:"The",monthlyWeekdayOfMonth1Human:"on the",monthlyWeekdayOfMonth2:"",monthlyWeekdayOfMonth3:"of the month",monthlyRepeatOn:"Repeat on:",yearlyInterval1:"Repeat every:",yearlyInterval2:"year(s)",yearlyDayOfMonth1:"Every",yearlyDayOfMonth1Human:"on",yearlyDayOfMonth2:"",yearlyDayOfMonth3:"",yearlyWeekdayOfMonth1:"The",yearlyWeekdayOfMonth1Human:"on the",yearlyWeekdayOfMonth2:"",yearlyWeekdayOfMonth3:"of",yearlyWeekdayOfMonth4:"",yearlyRepeatOn:"Repeat on:",range:"End recurrence:",rangeNoEnd:"Never",rangeByOccurrences1:"After",rangeByOccurrences1Human:"ends after",rangeByOccurrences2:"occurrence(s)",rangeByEndDate:"On",rangeByEndDateHuman:"ends on",including:", and also",except:", except for",cancel:"Cancel",save:"Save",recurrenceStart:"Start of the recurrence",additionalDate:"Additional date",include:"Include",exclude:"Exclude",remove:"Remove",orderIndexes:["first","second","third","fourth","last"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortWeekdays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longDateFormat:"mmmm dd, yyyy",shortDateFormat:"mm/dd/yyyy",unsupportedFeatures:"Warning: This event uses recurrence features not supported by this widget. Saving the recurrence may change the recurrence in unintended ways:",noTemplateMatch:"No matching recurrence template",multipleDayOfMonth:"This widget does not support multiple days in monthly or yearly recurrence",bysetpos:"BYSETPOS is not supported",noRule:"No RRULE in RRULE data",noRepeatEvery:'Error: The "Repeat every"-field must be between 1 and 1000',noEndDate:"Error: End date is not set. Please set a correct value",noRepeatOn:'Error: "Repeat on"-value must be selected',pastEndDate:"Error: End date cannot be before start date",noEndAfterNOccurrences:'Error: The "After N occurrences"-field must be between 1 and 1000',alreadyAdded:"This date was already added",rtemplate:{daily:"Daily",mondayfriday:"Monday and Friday",weekdays:"Weekday",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly"}}),e=['<div class="rioccurrences">',"{{each occurrences}}",'<div class="occurrence ${occurrences[$index].type}">',"<span>","${occurrences[$index].formattedDate}",'{{if occurrences[$index].type === "start"}}','<span class="rlabel">${i18n.recurrenceStart}</span>',"{{/if}}",'{{if occurrences[$index].type === "rdate"}}','<span class="rlabel">${i18n.additionalDate}</span>',"{{/if}}","</span>","{{if !readOnly}}",'<span class="action">','{{if occurrences[$index].type === "rrule"}}','<a date="${occurrences[$index].date}" href="#"','class="${occurrences[$index].type}" title="${i18n.exclude}">',"${i18n.exclude}","</a>","{{/if}}",'{{if occurrences[$index].type === "rdate"}}','<a date="${occurrences[$index].date}" href="#"','class="${occurrences[$index].type}" title="${i18n.remove}" >',"${i18n.remove}","</a>","{{/if}}",'{{if occurrences[$index].type === "exdate"}}','<a date="${occurrences[$index].date}" href="#"','class="${occurrences[$index].type}" title="${i18n.include}">',"${i18n.include}","</a>","{{/if}}","</span>","{{/if}}","</div>","{{/each}}",'<div class="batching">',"{{each batch.batches}}",'{{if $index === batch.currentBatch}}<span class="current">{{/if}}','<a href="#" start="${batch.batches[$index][0]}">[${batch.batches[$index][0]} - ${batch.batches[$index][1]}]</a>',"{{if $index === batch.currentBatch}}</span>{{/if}}","{{/each}}","</div></div>"].join("\n"),$.template("occurrenceTmpl",e),e=['<div class="ridisplay">','<div class="rimain">',"{{if !readOnly}}",'<button name="riedit">${i18n.add_rules}</button>','<button name="ridelete" style="display:none">${i18n.delete_rules}</button>',"{{/if}}",'<label class="ridisplay">${i18n.displayUnactivate}</label>',"</div>",'<div class="rioccurrences" style="display:none" /></div>'].join("\n"),$.template("displayTmpl",e),e=['<div class="riform">',"<form>","<h1>${i18n.title}</h1>",'<div id="messagearea" style="display: none;">',"</div>",'<div id="rirtemplate">','<label for="${name}rtemplate" class="label">',"${i18n.recurrenceType}","</label>",'<select id="rirtemplate" name="rirtemplate" class="field">',"{{each rtemplate}}",'<option value="${$index}">${i18n.rtemplate[$index]}</value>',"{{/each}}","</select>","<div>",'<div id="riformfields">','<div id="ridailyinterval" class="rifield">','<label for="${name}dailyinterval" class="label">',"${i18n.dailyInterval1}","</label>",'<div class="field">','<input type="text" size="2"','value="1"','name="ridailyinterval"','id="${name}dailyinterval" />',"${i18n.dailyInterval2}","</div>","</div>",'<div id="riweeklyinterval" class="rifield">','<label for="${name}weeklyinterval" class="label">',"${i18n.weeklyInterval1}","</label>",'<div class="field">','<input type="text" size="2"','value="1"','name="riweeklyinterval"','id="${name}weeklyinterval"/>',"${i18n.weeklyInterval2}","</div>","</div>",'<div id="riweeklyweekdays" class="rifield">','<label for="${name}weeklyinterval" class="label">${i18n.weeklyWeekdays}</label>','<div class="field">',"{{each orderedWeekdays}}",'<div class="riweeklyweekday">','<input type="checkbox"','name="riweeklyweekdays${weekdays[$value]}"','id="${name}weeklyWeekdays${weekdays[$value]}"','value="${weekdays[$value]}" />','<label for="${name}weeklyWeekdays${weekdays[$value]}">${i18n.shortWeekdays[$value]}</label>',"</div>","{{/each}}","</div>","</div>",'<div id="rimonthlyinterval" class="rifield">','<label for="rimonthlyinterval" class="label">${i18n.monthlyInterval1}</label>','<div class="field">','<input type="text" size="2"','value="1" ','name="rimonthlyinterval"/>',"${i18n.monthlyInterval2}","</div>","</div>",'<div id="rimonthlyoptions" class="rifield">','<label for="rimonthlytype" class="label">${i18n.monthlyRepeatOn}</label>','<div class="field">',"<div>","<input",'type="radio"','value="DAYOFMONTH"','name="rimonthlytype"','id="${name}monthlytype:DAYOFMONTH" />','<label for="${name}monthlytype:DAYOFMONTH">',"${i18n.monthlyDayOfMonth1}","</label>",'<select name="rimonthlydayofmonthday"','id="${name}monthlydayofmonthday">',"{{each [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,","18,19,20,21,22,23,24,25,26,27,28,29,30,31]}}",'<option value="${$value}">${$value}</option>',"{{/each}}","</select>","${i18n.monthlyDayOfMonth2}","</div>","<div>","<input",'type="radio"','value="WEEKDAYOFMONTH"','name="rimonthlytype"','id="${name}monthlytype:WEEKDAYOFMONTH" />','<label for="${name}monthlytype:WEEKDAYOFMONTH">',"${i18n.monthlyWeekdayOfMonth1}","</label>",'<select name="rimonthlyweekdayofmonthindex">',"{{each i18n.orderIndexes}}",'<option value="${orderIndexes[$index]}">${$value}</option>',"{{/each}}","</select>","${i18n.monthlyWeekdayOfMonth2}",'<select name="rimonthlyweekdayofmonth">',"{{each orderedWeekdays}}",'<option value="${weekdays[$value]}">${i18n.weekdays[$value]}</option>',"{{/each}}","</select>","${i18n.monthlyWeekdayOfMonth3}","</div>","</div>","</div>",'<div id="riyearlyinterval" class="rifield">','<label for="riyearlyinterval" class="label">${i18n.yearlyInterval1}</label>','<div class="field">','<input type="text" size="2"','value="1" ','name="riyearlyinterval"/>',"${i18n.yearlyInterval2}","</div>","</div>",'<div id="riyearlyoptions" class="rifield">','<label for="riyearlyType" class="label">${i18n.yearlyRepeatOn}</label>','<div class="field">',"<div>","<input",'type="radio"','value="DAYOFMONTH"','name="riyearlyType"','id="${name}yearlytype:DAYOFMONTH" />','<label for="${name}yearlytype:DAYOFMONTH">',"${i18n.yearlyDayOfMonth1}","</label>",'<select name="riyearlydayofmonthmonth">',"{{each i18n.months}}",'<option value="${$index+1}">${$value}</option>',"{{/each}}","</select>","${i18n.yearlyDayOfMonth2}",'<select name="riyearlydayofmonthday">',"{{each [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,","18,19,20,21,22,23,24,25,26,27,28,29,30,31]}}",'<option value="${$value}">${$value}</option>',"{{/each}}","</select>","${i18n.yearlyDayOfMonth3}","</div>","<div>","<input",'type="radio"','value="WEEKDAYOFMONTH"','name="riyearlyType"','id="${name}yearlytype:WEEKDAYOFMONTH"/>','<label for="${name}yearlytype:WEEKDAYOFMONTH">',"${i18n.yearlyWeekdayOfMonth1}","</label>",'<select name="riyearlyweekdayofmonthindex">',"{{each i18n.orderIndexes}}",'<option value="${orderIndexes[$index]}">${$value}</option>',"{{/each}}","</select>",'<label for="${name}yearlytype:WEEKDAYOFMONTH">',"${i18n.yearlyWeekdayOfMonth2}","</label>",'<select name="riyearlyweekdayofmonthday">',"{{each orderedWeekdays}}",'<option value="${weekdays[$value]}">${i18n.weekdays[$value]}</option>',"{{/each}}","</select>","${i18n.yearlyWeekdayOfMonth3}",'<select name="riyearlyweekdayofmonthmonth">',"{{each i18n.months}}",'<option value="${$index+1}">${$value}</option>',"{{/each}}","</select>","${i18n.yearlyWeekdayOfMonth4}","</div>","</div>","</div>",'<div id="rirangeoptions" class="rifield">','<label class="label">${i18n.range}</label>','<div class="field">',"{{if hasRepeatForeverButton}}","<div>","<input",'type="radio"','value="NOENDDATE"','name="rirangetype"','id="${name}rangetype:NOENDDATE"/>','<label for="${name}rangetype:NOENDDATE">',"${i18n.rangeNoEnd}","</label>","</div>","{{/if}}","<div>","<input",'type="radio"','checked="checked"','value="BYOCCURRENCES"','name="rirangetype"','id="${name}rangetype:BYOCCURRENCES"/>','<label for="${name}rangetype:BYOCCURRENCES">',"${i18n.rangeByOccurrences1}","</label>","<input",'type="text" size="3"','value="7"','name="rirangebyoccurrencesvalue" />',"${i18n.rangeByOccurrences2}","</div>","<div>","<input",'type="radio"','value="BYENDDATE"','name="rirangetype"','id="${name}rangetype:BYENDDATE"/>','<label for="${name}rangetype:BYENDDATE">',"${i18n.rangeByEndDate}","</label>","<input",'type="date"','name="rirangebyenddatecalendar" />',"</div>","</div>","</div>","</div>",'<div class="rioccurrencesactions">','<div class="rioccurancesheader">',"<h2>${i18n.preview}</h2>",'<span class="refreshbutton action">','<a class="rirefreshbutton" href="#" title="${i18n.refresh}">',"${i18n.refresh}","</a>","</span>","</div>","</div>",'<div class="rioccurrences">',"</div>",'<div class="rioccurrencesactions">','<div class="rioccurancesheader">',"<h2>${i18n.addDate}</h2>","</div>",'<div class="riaddoccurrence">','<div class="errorarea"></div>','<input type="date" name="adddate" id="adddate" />','<input type="button" name="addaction" id="addaction" value="${i18n.add}">',"</div>","</div>",'<div class="ributtons">',"<input",'type="submit"','class="ricancelbutton ${ributtonExtraClass}"','value="${i18n.cancel}" />',"<input",'type="submit"','class="risavebutton ${ributtonExtraClass}"','value="${i18n.save}" />',"</div>","</form></div>"].join("\n"),$.template("formTmpl",e),l=/d{1,4}|m{1,4}|yy(?:yy)?|"[^"]*"|'[^']*'/g,$.fn.recurrenceinput=function(e){var t;return this.data("recurrenceinput")?this.data("recurrenceinput"):(t=$.extend({},a.conf),$.extend(t,e),$.extend(t,{i18n:T[t.lang],name:this.attr("name")}),(e=new n(t,this)).form.appendTo("body"),this.after(e.display),this.hide(),this.data("recurrenceinput",e),e)}}.apply(e,arguments)})}(this),define("mockup-patterns-recurrence",["jquery","pat-base","jquery.recurrenceinput"],function(e,t){"use strict";return t.extend({name:"recurrence",trigger:".pat-recurrence",parser:"mockup",defaults:{language:"en",localization:null,configuration:{}},init:function(){this.$el.addClass("recurrence-widget"),this.options.localization&&e.tools.recurrenceinput.localize(this.options.language,this.options.localization),this.$el.recurrenceinput(this.options.configuration)}})}),function(e){define("select2",[],function(){return function(){var a;void 0===(a=jQuery).fn.each2&&a.extend(a.fn,{each2:function(e){for(var t=a([0]),n=-1,i=this.length;++n<i&&(t.context=t[0]=this[n])&&!1!==e.call(t[0],n,t););return this}}),function(y,v){"use strict";var e,t,n,b,a,r,g,c,i,o,s;function l(e){var t=y(document.createTextNode(""));e.before(t),t.before(e),t.remove()}function d(e){return e.replace(/[^\u0000-\u007E]/g,function(e){return i[e]||e})}function u(e,t){for(var n=0,i=t.length;n<i;n+=1)if(h(e,t[n]))return n;return-1}function h(e,t){return e===t||e!==v&&t!==v&&null!==e&&null!==t&&(e.constructor===String?e+""==t+"":t.constructor===String&&t+""==e+"")}function p(e,t,n){var i,a,o;if(null===e||e.length<1)return[];for(a=0,o=(i=e.split(t)).length;a<o;a+=1)i[a]=n(i[a]);return i}function f(e){return e.outerWidth(!1)-e.width()}function m(t){var n="keyup-change-value";t.on("keydown",function(){y.data(t,n)===v&&y.data(t,n,t.val())}),t.on("keyup",function(){var e=y.data(t,n);e!==v&&t.val()!==e&&(y.removeData(t,n),t.trigger("keyup-change"))})}function w(t,n,i){var a;return i=i||v,function(){var e=arguments;window.clearTimeout(a),a=window.setTimeout(function(){n.apply(i,e)},t)}}function k(e){e.preventDefault(),e.stopPropagation()}function x(e,t,n){var i,a=[],o=y.trim(e.attr("class"));o&&y((o=""+o).split(/\s+/)).each2(function(){0===this.indexOf("select2-")&&a.push(this)}),(o=y.trim(t.attr("class")))&&y((o=""+o).split(/\s+/)).each2(function(){0!==this.indexOf("select2-")&&(i=n(this))&&a.push(i)}),e.attr("class",a.join(" "))}function T(e,t,n,i){var a=d(e.toUpperCase()).indexOf(d(t.toUpperCase())),t=t.length;a<0?n.push(i(e)):(n.push(i(e.substring(0,a))),n.push("<span class='select2-match'>"),n.push(i(e.substring(a,a+t))),n.push("</span>"),n.push(i(e.substring(a+t,e.length))))}function S(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return String(e).replace(/[&<>"'\/\\]/g,function(e){return t[e]})}function C(o){var e,s=null,t=o.quietMillis||100,r=o.url,l=this;return function(a){window.clearTimeout(e),e=window.setTimeout(function(){var e=o.data,t=r,n=o.transport||y.fn.select2.ajaxDefaults.transport,i={type:o.type||"GET",cache:o.cache||!1,jsonpCallback:o.jsonpCallback||v,dataType:o.dataType||"json"},i=y.extend({},y.fn.select2.ajaxDefaults.params,i),e=e?e.call(l,a.term,a.page,a.context):null,t="function"==typeof t?t.call(l,a.term,a.page,a.context):t;s&&"function"==typeof s.abort&&s.abort(),o.params&&(y.isFunction(o.params)?y.extend(i,o.params.call(l)):y.extend(i,o.params)),y.extend(i,{url:t,dataType:o.dataType,data:e,success:function(e){e=o.results(e,a.page,a);a.callback(e)},error:function(e,t,n){a.callback({hasError:!0,jqXHR:e,textStatus:t,errorThrown:n})}}),s=n.call(l,i)},t)}}function E(e){var t,n,i=e,r=function(e){return""+e.text},e=(y.isArray(i)&&(i={results:n=i}),!1===y.isFunction(i)&&(n=i,i=function(){return n}),i());return e.text&&(r=e.text,y.isFunction(r)||(t=e.text,r=function(e){return e[t]})),function(a){var o,s=a.term,n={results:[]};""===s?a.callback(i()):(o=function(e,t){var n,i;if((e=e[0]).children){for(i in n={},e)e.hasOwnProperty(i)&&(n[i]=e[i]);n.children=[],y(e.children).each2(function(e,t){o(t,n.children)}),(n.children.length||a.matcher(s,r(n),e))&&t.push(n)}else a.matcher(s,r(e),e)&&t.push(e)},y(i().results).each2(function(e,t){o(t,n.results)}),a.callback(n))}}function D(t){var o=y.isFunction(t);return function(n){var i=n.term,a={results:[]},e=o?t(n):t;y.isArray(e)&&(y(e).each(function(){var e=this.text!==v,t=e?this.text:this;""!==i&&!n.matcher(i,t)||a.results.push(e?this:{id:this,text:this})}),n.callback(a))}}function O(e,t){if(y.isFunction(e))return 1;if(e){if("string"==typeof e)return 1;throw new Error(t+" must be a string, function, or falsy value")}}function $(e,t){var n;return y.isFunction(e)?(n=Array.prototype.slice.call(arguments,2),e.apply(t,n)):e}function A(){var n=this;y.each(arguments,function(e,t){n[t].remove(),n[t]=null})}function I(e,t){function n(){}return((n.prototype=new e).constructor=n).prototype.parent=e.prototype,n.prototype=y.extend(n.prototype,t),n}window.Select2===v&&(r={x:0,y:0},c={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(e){switch(e=e.which||e){case c.LEFT:case c.RIGHT:case c.UP:case c.DOWN:return!0}return!1},isControl:function(e){switch(e.which){case c.SHIFT:case c.CTRL:case c.ALT:return!0}return!!e.metaKey},isFunctionKey:function(e){return 112<=(e=e.which||e)&&e<=123}},i={"":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"AA","":"AE","":"AE","":"AE","":"AO","":"AU","":"AV","":"AV","":"AY","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"DZ","":"DZ","":"Dz","":"Dz","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"F","":"F","":"F","":"F","":"F","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"J","":"J","":"J","":"J","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"LJ","":"Lj","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"NJ","":"Nj","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"OI","":"OO","":"OU","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"Q","":"Q","":"Q","":"Q","":"Q","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"TZ","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"VY","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"X","":"X","":"X","":"X","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"aa","":"ae","":"ae","":"ae","":"ao","":"au","":"av","":"av","":"ay","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"dz","":"dz","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"f","":"f","":"f","":"f","":"f","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"hv","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"j","":"j","":"j","":"j","":"j","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"lj","":"m","":"m","":"m","":"m","":"m","":"m","":"m","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"nj","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"oi","":"ou","":"oo","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"q","":"q","":"q","":"q","":"q","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"tz","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"vy","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"x","":"x","":"x","":"x","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},s=y(document),o=1,b=function(){return o++},e=I(Object,{bind:function(e){var t=this;return function(){e.apply(t,arguments)}},init:function(e){var o,t,n,i,a=".select2-results",s=(this.opts=e=this.prepareOpts(e),this.id=e.id,e.element.data("select2")!==v&&null!==e.element.data("select2")&&e.element.data("select2").destroy(),this.container=this.createContainer(),this.liveRegion=y(".select2-hidden-accessible"),0==this.liveRegion.length&&(this.liveRegion=y("<span>",{role:"status","aria-live":"polite"}).addClass("select2-hidden-accessible").appendTo(document.body)),this.containerId="s2id_"+(e.element.attr("id")||"autogen"+b()),this.containerEventName=this.containerId.replace(/([.])/g,"_").replace(/([;&,\-\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.container.attr("id",this.containerId),this.container.attr("title",e.element.attr("title")),this.body=y(document.body),x(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.attr("style",e.element.attr("style")),this.container.css($(e.containerCss,this.opts.element)),this.container.addClass($(e.containerCssClass,this.opts.element)),this.elementTabIndex=this.opts.element.attr("tabindex"),this.opts.element.data("select2",this).attr("tabindex","-1").before(this.container).on("click.select2",k),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),x(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass($(e.dropdownCssClass,this.opts.element)),this.dropdown.data("select2",this),this.dropdown.on("click",k),this.results=o=this.container.find(a),this.search=t=this.container.find("input.select2-input"),this.queryCount=0,this.resultsPage=0,this.context=null,this.initContainer(),this.container.on("click",k),this.results.on("mousemove",function(e){var t=r;t!==v&&t.x===e.pageX&&t.y===e.pageY||y(e.target).trigger("mousemove-filtered",e)}),this.dropdown.on("mousemove-filtered",a,this.bind(this.highlightUnderEvent)),this.dropdown.on("touchstart touchmove touchend",a,this.bind(function(e){this._touchEvent=!0,this.highlightUnderEvent(e)})),this.dropdown.on("touchmove",a,this.bind(this.touchMoved)),this.dropdown.on("touchstart touchend",a,this.bind(this.clearTouchMoved)),this.dropdown.on("click",this.bind(function(e){this._touchEvent&&(this._touchEvent=!1,this.selectHighlighted())})),s=80,n=this.results,i=w(s,function(e){n.trigger("scroll-debounced",e)}),n.on("scroll",function(e){0<=u(e.target,n.get())&&i(e)}),this.dropdown.on("scroll-debounced",a,this.bind(this.loadMoreIfNeeded)),y(this.container).on("change",".select2-input",function(e){e.stopPropagation()}),y(this.dropdown).on("change",".select2-input",function(e){e.stopPropagation()}),y.fn.mousewheel&&o.mousewheel(function(e,t,n,i){var a=o.scrollTop();0<i&&a-i<=0?(o.scrollTop(0),k(e)):i<0&&o.get(0).scrollHeight-o.scrollTop()+i<=o.height()&&(o.scrollTop(o.get(0).scrollHeight-o.height()),k(e))}),m(t),t.on("keyup-change input paste",this.bind(this.updateResults)),t.on("focus",function(){t.addClass("select2-focused")}),t.on("blur",function(){t.removeClass("select2-focused")}),this.dropdown.on("mouseup",a,this.bind(function(e){0<y(e.target).closest(".select2-result-selectable").length&&(this.highlightUnderEvent(e),this.selectHighlighted(e))})),this.dropdown.on("click mouseup mousedown touchstart touchend focusin",function(e){e.stopPropagation()}),this.lastSearchTerm=v,y.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),null!==e.maximumInputLength&&this.search.attr("maxlength",e.maximumInputLength),e.element.prop("disabled")),a=(this.enable(!(s=s===v?!1:s)),e.element.prop("readonly"));this.readonly(a=a===v?!1:a),g=g||((s=y("<div class='select2-measure-scrollbar'></div>")).appendTo(document.body),a={width:s.width()-s[0].clientWidth,height:s.height()-s[0].clientHeight},s.remove(),a),this.autofocus=e.element.prop("autofocus"),e.element.prop("autofocus",!1),this.autofocus&&this.focus(),this.search.attr("placeholder",e.searchInputPlaceholder)},destroy:function(){var e=this.opts.element,t=e.data("select2"),n=this;this.close(),e.length&&e[0].detachEvent&&n._sync&&e.each(function(){n._sync&&this.detachEvent("onpropertychange",n._sync)}),this.propertyObserver&&(this.propertyObserver.disconnect(),this.propertyObserver=null),this._sync=null,t!==v&&(t.container.remove(),t.liveRegion.remove(),t.dropdown.remove(),e.removeData("select2").off(".select2"),e.is("input[type='hidden']")?e.css("display",""):(e.show().prop("autofocus",this.autofocus||!1),this.elementTabIndex?e.attr({tabindex:this.elementTabIndex}):e.removeAttr("tabindex"),e.show())),A.call(this,"container","liveRegion","dropdown","results","search")},optionToData:function(e){return e.is("option")?{id:e.prop("value"),text:e.text(),element:e.get(),css:e.attr("class"),disabled:e.prop("disabled"),locked:h(e.attr("locked"),"locked")||h(e.data("locked"),!0)}:e.is("optgroup")?{text:e.attr("label"),children:[],element:e.get(),css:e.attr("class")}:void 0},prepareOpts:function(m){var e,t,n,g=this,s=m.element;if("select"===s.get(0).tagName.toLowerCase()&&(this.select=e=m.element),e&&y.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in m)throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}),m.debug=m.debug||y.fn.select2.defaults.debug,m.debug&&console&&console.warn&&(null!=m.id&&console.warn("Select2: The `id` option has been removed in Select2 4.0.0, consider renaming your `id` property or mapping the property before your data makes it to Select2. You can read more at https://select2.github.io/announcements-4.0.html#changed-id"),null!=m.text&&console.warn("Select2: The `text` option has been removed in Select2 4.0.0, consider renaming your `text` property or mapping the property before your data makes it to Select2. You can read more at https://select2.github.io/announcements-4.0.html#changed-id"),null!=m.sortResults&&console.warn("Select2: the `sortResults` option has been renamed to `sorter` in Select2 4.0.0. "),null!=m.selectOnBlur&&console.warn("Select2: The `selectOnBlur` option has been renamed to `selectOnClose` in Select2 4.0.0."),null!=m.ajax&&null!=m.ajax.results&&console.warn("Select2: The `ajax.results` option has been renamed to `ajax.processResults` in Select2 4.0.0."),null!=m.formatNoResults&&console.warn("Select2: The `formatNoResults` option has been renamed to `language.noResults` in Select2 4.0.0."),null!=m.formatSearching&&console.warn("Select2: The `formatSearching` option has been renamed to `language.searching` in Select2 4.0.0."),null!=m.formatInputTooShort&&console.warn("Select2: The `formatInputTooShort` option has been renamed to `language.inputTooShort` in Select2 4.0.0."),null!=m.formatInputTooLong&&console.warn("Select2: The `formatInputTooLong` option has been renamed to `language.inputTooLong` in Select2 4.0.0."),null!=m.formatLoading&&console.warn("Select2: The `formatLoading` option has been renamed to `language.loadingMore` in Select2 4.0.0."),null!=m.formatSelectionTooBig&&console.warn("Select2: The `formatSelectionTooBig` option has been renamed to `language.maximumSelected` in Select2 4.0.0."),m.element.data("select2Tags"))&&console.warn("Select2: The `data-select2-tags` attribute has been renamed to `data-tags` in Select2 4.0.0."),null!=m.element.data("tags")&&(n=m.element.data("tags"),y.isArray(n)||(n=[]),m.element.data("select2Tags",n)),null!=m.sorter&&(m.sortResults=m.sorter),null!=m.selectOnClose&&(m.selectOnBlur=m.selectOnClose),null!=m.ajax&&y.isFunction(m.ajax.processResults)&&(m.ajax.results=m.ajax.processResults),null!=m.language&&(n=m.language,y.isFunction(n.noMatches)&&(m.formatNoMatches=n.noMatches),y.isFunction(n.searching)&&(m.formatSearching=n.searching),y.isFunction(n.inputTooShort)&&(m.formatInputTooShort=n.inputTooShort),y.isFunction(n.inputTooLong)&&(m.formatInputTooLong=n.inputTooLong),y.isFunction(n.loadingMore)&&(m.formatLoading=n.loadingMore),y.isFunction(n.maximumSelected))&&(m.formatSelectionTooBig=n.maximumSelected),"function"!=typeof(m=y.extend({},{populateResults:function(e,t,u){var h=this.opts.id,p=this.liveRegion,f=function(e,t,n){for(var i,a,o,s,r,l=[],c=0,d=(e=m.sortResults(e,t,u)).length;c<d;c+=1)s=!(r=!0===(i=e[c]).disabled)&&h(i)!==v,a=i.children&&0<i.children.length,(o=y("<li></li>")).addClass("select2-results-dept-"+n),o.addClass("select2-result"),o.addClass(s?"select2-result-selectable":"select2-result-unselectable"),r&&o.addClass("select2-disabled"),a&&o.addClass("select2-result-with-children"),o.addClass(g.opts.formatResultCssClass(i)),o.attr("role","presentation"),(s=y(document.createElement("div"))).addClass("select2-result-label"),s.attr("id","select2-result-label-"+b()),s.attr("role","option"),(r=m.formatResult(i,s,u,g.opts.escapeMarkup))!==v&&(s.html(r),o.append(s)),a&&((r=y("<ul></ul>")).addClass("select2-result-sub"),f(i.children,r,n+1),o.append(r)),o.data("select2-data",i),l.push(o[0]);t.append(l),p.text(m.formatMatches(e.length))};f(t,e,0)}},y.fn.select2.defaults,m)).id&&(t=m.id,m.id=function(e){return e[t]}),y.isArray(m.element.data("select2Tags"))){if("tags"in m)throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+m.element.attr("id");m.tags=m.element.data("select2Tags")}if(e?(m.query=this.bind(function(i){var e,n={results:[],more:!1},a=i.term,o=function(e,t){var n;e.is("option")?i.matcher(a,e.text(),e)&&t.push(g.optionToData(e)):e.is("optgroup")&&(n=g.optionToData(e),e.children().each2(function(e,t){o(t,n.children)}),0<n.children.length)&&t.push(n)},t=s.children();(t=this.getPlaceholder()!==v&&0<t.length&&(e=this.getPlaceholderOption())?t.not(e):t).each2(function(e,t){o(t,n.results)}),i.callback(n)}),m.id=function(e){return e.id}):"query"in m||("ajax"in m?((n=m.element.data("ajax-url"))&&0<n.length&&(m.ajax.url=n),m.query=C.call(m.element,m.ajax)):"data"in m?m.query=E(m.data):"tags"in m&&(m.query=D(m.tags),m.createSearchChoice===v&&(m.createSearchChoice=function(e){return{id:y.trim(e),text:y.trim(e)}}),m.initSelection===v)&&(m.initSelection=function(e,t){var n=[];y(p(e.val(),m.separator,m.transformVal)).each(function(){var e={id:this,text:this},t=m.tags;y.isFunction(t)&&(t=t()),y(t).each(function(){if(h(this.id,e.id))return e=this,!1}),n.push(e)}),t(n)})),"function"!=typeof m.query)throw"query function not defined for Select2 "+m.element.attr("id");if("top"===m.createSearchChoicePosition)m.createSearchChoicePosition=function(e,t){e.unshift(t)};else if("bottom"===m.createSearchChoicePosition)m.createSearchChoicePosition=function(e,t){e.push(t)};else if("function"!=typeof m.createSearchChoicePosition)throw"invalid createSearchChoicePosition option must be 'top', 'bottom' or a custom function";return m},monitorSource:function(){var e,t=this.opts.element,n=this;t.on("change.select2",this.bind(function(e){!0!==this.opts.element.data("select2-change-triggered")&&this.initSelection()})),this._sync=this.bind(function(){var e=t.prop("disabled"),e=(this.enable(!(e=e===v?!1:e)),t.prop("readonly"));this.readonly(e=e===v?!1:e),this.container&&(x(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.addClass($(this.opts.containerCssClass,this.opts.element))),this.dropdown&&(x(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass($(this.opts.dropdownCssClass,this.opts.element)))}),t.length&&t[0].attachEvent&&t.each(function(){this.attachEvent("onpropertychange",n._sync)}),(e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)!==v&&(this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),this.propertyObserver=new e(function(e){y.each(e,n._sync)}),this.propertyObserver.observe(t.get(0),{attributes:!0,subtree:!1}))},triggerSelect:function(e){e=y.Event("select2-selecting",{val:this.id(e),object:e,choice:e});return this.opts.element.trigger(e),!e.isDefaultPrevented()},triggerChange:function(e){e=y.extend({},e=e||{},{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(e),this.opts.element.data("select2-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},isInterfaceEnabled:function(){return!0===this.enabledInterface},enableInterface:function(){var e=this._enabled&&!this._readonly;return e!==this.enabledInterface&&(this.container.toggleClass("select2-container-disabled",!e),this.close(),this.enabledInterface=e,!0)},enable:function(e){this._enabled!==(e=e===v||e)&&(this._enabled=e,this.opts.element.prop("disabled",!e),this.enableInterface())},disable:function(){this.enable(!1)},readonly:function(e){this._readonly!==(e=e!==v&&e)&&(this._readonly=e,this.opts.element.prop("readonly",e),this.enableInterface())},opened:function(){return!!this.container&&this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var e,t,n=this.dropdown,i=this.container,a=i.offset(),o=i.outerHeight(!1),s=i.outerWidth(!1),r=n.outerHeight(!1),l=y(window),c=l.width(),d=l.height(),u=l.scrollLeft()+c,d=l.scrollTop()+d,h=a.top+o,p=a.left,d=h+r<=d,f=a.top-r>=l.scrollTop(),m=n.outerWidth(!1);n.hasClass("select2-drop-above")?(e=!0,!f&&d&&(e=!(t=!0))):(e=!1,!d&&f&&(e=t=!0)),t&&(n.hide(),a=this.container.offset(),o=this.container.outerHeight(!1),s=this.container.outerWidth(!1),r=n.outerHeight(!1),u=l.scrollLeft()+c,l.scrollTop(),h=a.top+o,p=a.left,m=n.outerWidth(!1),n.show(),this.focusSearch()),this.opts.dropdownAutoWidth?(d=y(".select2-results",n)[0],n.addClass("select2-drop-auto-width"),n.css("width",""),s<(m=n.outerWidth(!1)+(d.scrollHeight===d.clientHeight?0:g.width))?s=m:m=s,r=n.outerHeight(!1)):this.container.removeClass("select2-drop-auto-width"),"static"!==this.body.css("position")&&(h-=(f=this.body.offset()).top,p-=f.left),t={left:p=!(p+m<=u)&&a.left+u+i.outerWidth(!1)>m?a.left+this.container.outerWidth(!1)-m:p,width:s},e?(this.container.addClass("select2-drop-above"),n.addClass("select2-drop-above"),r=n.outerHeight(!1),t.top=a.top-r,t.bottom="auto"):(t.top=h,t.bottom="auto",this.container.removeClass("select2-drop-above"),n.removeClass("select2-drop-above")),t=y.extend(t,$(this.opts.dropdownCss,this.opts.element)),n.css(t)},shouldOpen:function(){var e;return!this.opened()&&!1!==this._enabled&&!0!==this._readonly&&(e=y.Event("select2-opening"),this.opts.element.trigger(e),!e.isDefaultPrevented())},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return!!this.shouldOpen()&&(this.opening(),s.on("mousemove.select2Event",function(e){r.x=e.pageX,r.y=e.pageY}),!0)},opening:function(){var n,e=this.containerEventName,t="scroll."+e,i="resize."+e,a="orientationchange."+e,o=(this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.clearDropdownAlignmentPreference(),this.dropdown[0]!==this.body.children().last()[0]&&this.dropdown.detach().appendTo(this.body),0===(n=y("#select2-drop-mask")).length&&((n=y(document.createElement("div"))).attr("id","select2-drop-mask").attr("class","select2-drop-mask"),n.hide(),n.appendTo(this.body),n.on("mousedown touchstart click",function(e){l(n);var t=y("#select2-drop");0<t.length&&((t=t.data("select2")).opts.selectOnBlur&&t.selectHighlighted({noFocus:!0}),t.close(),e.preventDefault(),e.stopPropagation())})),this.dropdown.prev()[0]!==n[0]&&this.dropdown.before(n),y("#select2-drop").removeAttr("id"),this.dropdown.attr("id","select2-drop"),n.show(),this.positionDropdown(),this.dropdown.show(),this.positionDropdown(),this.dropdown.addClass("select2-drop-active"),this);this.container.parents().add(window).each(function(){y(this).on(i+" "+t+" "+a,function(e){o.opened()&&o.positionDropdown()})})},close:function(){var e,t,n,i;this.opened()&&(e=this.containerEventName,t="scroll."+e,n="resize."+e,i="orientationchange."+e,this.container.parents().add(window).each(function(){y(this).off(t).off(n).off(i)}),this.clearDropdownAlignmentPreference(),y("#select2-drop-mask").hide(),this.dropdown.removeAttr("id"),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active"),this.results.empty(),s.off("mousemove.select2Event"),this.clearSearch(),this.search.removeClass("select2-active"),this.search.removeAttr("aria-activedescendant"),this.opts.element.trigger(y.Event("select2-close")))},externalSearch:function(e){this.open(),this.search.val(e),this.updateResults(!1)},clearSearch:function(){},prefillNextSearchTerm:function(){var e;return""===this.search.val()&&(e=this.opts.nextSearchTerm(this.data(),this.lastSearchTerm))!==v&&(this.search.val(e),this.search.select(),!0)},getMaximumSelectionSize:function(){return $(this.opts.maximumSelectionSize,this.opts.element)},ensureHighlightVisible:function(){var e,t,n,i,a=this.results,o=this.highlight();o<0||(0==o?a.scrollTop(0):(n=this.findHighlightableChoices().find(".select2-result-label"),t=(i=((e=y(n[o])).offset()||{}).top||0)+e.outerHeight(!0),o===n.length-1&&0<(o=a.find("li.select2-more-results")).length&&(t=o.offset().top+o.outerHeight(!0)),(n=a.offset().top+a.outerHeight(!1))<t&&a.scrollTop(a.scrollTop()+(t-n)),(o=i-a.offset().top)<0&&"none"!=e.css("display")&&a.scrollTop(a.scrollTop()+o)))},findHighlightableChoices:function(){return this.results.find(".select2-result-selectable:not(.select2-disabled):not(.select2-selected)")},moveHighlight:function(e){for(var t=this.findHighlightableChoices(),n=this.highlight();-1<n&&n<t.length;){var i=y(t[n+=e]);if(i.hasClass("select2-result-selectable")&&!i.hasClass("select2-disabled")&&!i.hasClass("select2-selected")){this.highlight(n);break}}},highlight:function(e){var t=this.findHighlightableChoices();if(0===arguments.length)return u(t.filter(".select2-highlighted")[0],t.get());(e=e>=t.length?t.length-1:e)<0&&(e=0),this.removeHighlight(),(t=y(t[e])).addClass("select2-highlighted"),this.search.attr("aria-activedescendant",t.find(".select2-result-label").attr("id")),this.ensureHighlightVisible(),this.liveRegion.text(t.text()),(e=t.data("select2-data"))&&this.opts.element.trigger({type:"select2-highlight",val:this.id(e),choice:e})},removeHighlight:function(){this.results.find(".select2-highlighted").removeClass("select2-highlighted")},touchMoved:function(){this._touchMoved=!0},clearTouchMoved:function(){this._touchMoved=!1},countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(e){var t,e=y(e.target).closest(".select2-result-selectable");0<e.length&&!e.is(".select2-highlighted")?(t=this.findHighlightableChoices(),this.highlight(t.index(e))):0==e.length&&this.removeHighlight()},loadMoreIfNeeded:function(){var t=this.results,n=t.find("li.select2-more-results"),i=this.resultsPage+1,a=this,o=this.search.val(),s=this.context;0!==n.length&&n.offset().top-t.offset().top-t.height()<=this.opts.loadMorePadding&&(n.addClass("select2-active"),this.opts.query({element:this.opts.element,term:o,page:i,context:s,matcher:this.opts.matcher,callback:this.bind(function(e){a.opened()&&(a.opts.populateResults.call(this,t,e.results,{term:o,page:i,context:s}),a.postprocessResults(e,!1,!1),!0===e.more?(n.detach().appendTo(t).html(a.opts.escapeMarkup($(a.opts.formatLoadMore,a.opts.element,i+1))),window.setTimeout(function(){a.loadMoreIfNeeded()},10)):n.remove(),a.positionDropdown(),a.resultsPage=i,a.context=e.context,this.opts.element.trigger({type:"select2-loaded",items:e}))})}))},tokenize:function(){},updateResults:function(n){var i,a=this.search,o=this.results,s=this.opts,r=this,e=a.val(),t=y.data(this.container,"select2-last-term");function l(){a.removeClass("select2-active"),r.positionDropdown(),o.find(".select2-no-results,.select2-selection-limit,.select2-searching").length?r.liveRegion.text(o.text()):r.liveRegion.text(r.opts.formatMatches(o.find('.select2-result-selectable:not(".select2-selected")').length))}function c(e){o.html(e),l()}!0!==n&&t&&h(e,t)||(y.data(this.container,"select2-last-term",e),(!0===n||!1!==this.showSearchInput&&this.opened())&&(i=++this.queryCount,1<=(t=this.getMaximumSelectionSize())&&(e=this.data(),y.isArray(e))&&e.length>=t&&O(s.formatSelectionTooBig,"formatSelectionTooBig")?c("<li class='select2-selection-limit'>"+$(s.formatSelectionTooBig,s.element,t)+"</li>"):a.val().length<s.minimumInputLength?(O(s.formatInputTooShort,"formatInputTooShort")?c("<li class='select2-no-results'>"+$(s.formatInputTooShort,s.element,a.val(),s.minimumInputLength)+"</li>"):c(""),n&&this.showSearch&&this.showSearch(!0)):s.maximumInputLength&&a.val().length>s.maximumInputLength?O(s.formatInputTooLong,"formatInputTooLong")?c("<li class='select2-no-results'>"+$(s.formatInputTooLong,s.element,a.val(),s.maximumInputLength)+"</li>"):c(""):(s.formatSearching&&0===this.findHighlightableChoices().length&&c("<li class='select2-searching'>"+$(s.formatSearching,s.element)+"</li>"),a.addClass("select2-active"),this.removeHighlight(),(e=this.tokenize())!=v&&null!=e&&a.val(e),this.resultsPage=1,s.query({element:s.element,term:a.val(),page:this.resultsPage,context:null,matcher:s.matcher,callback:this.bind(function(e){var t;i==this.queryCount&&(this.opened()?e.hasError!==v&&O(s.formatAjaxError,"formatAjaxError")?c("<li class='select2-ajax-error'>"+$(s.formatAjaxError,s.element,e.jqXHR,e.textStatus,e.errorThrown)+"</li>"):(this.context=e.context===v?null:e.context,this.opts.createSearchChoice&&""!==a.val()&&(t=this.opts.createSearchChoice.call(r,a.val(),e.results))!==v&&null!==t&&r.id(t)!==v&&null!==r.id(t)&&0===y(e.results).filter(function(){return h(r.id(this),r.id(t))}).length&&this.opts.createSearchChoicePosition(e.results,t),0===e.results.length&&O(s.formatNoMatches,"formatNoMatches")?(c("<li class='select2-no-results'>"+$(s.formatNoMatches,s.element,a.val())+"</li>"),this.showSearch&&this.showSearch(a.val())):(o.empty(),r.opts.populateResults.call(this,o,e.results,{term:a.val(),page:this.resultsPage,context:null}),!0===e.more&&O(s.formatLoadMore,"formatLoadMore")&&(o.append("<li class='select2-more-results'>"+s.escapeMarkup($(s.formatLoadMore,s.element,this.resultsPage))+"</li>"),window.setTimeout(function(){r.loadMoreIfNeeded()},10)),this.postprocessResults(e,n),l(),this.opts.element.trigger({type:"select2-loaded",items:e}))):this.search.removeClass("select2-active"))})}))))},cancel:function(){this.close()},blur:function(){this.opts.selectOnBlur&&this.selectHighlighted({noFocus:!0}),this.close(),this.container.removeClass("select2-container-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){var n;(n=this.search)[0]!==document.activeElement&&window.setTimeout(function(){var e=n[0],t=n.val().length;n.focus(),(0<e.offsetWidth||0<e.offsetHeight)&&e===document.activeElement&&(e.setSelectionRange?e.setSelectionRange(t,t):e.createTextRange&&((t=e.createTextRange()).collapse(!1),t.select()))},0)},selectHighlighted:function(e){var t,n;this._touchMoved?this.clearTouchMoved():(t=this.highlight(),(n=this.results.find(".select2-highlighted").closest(".select2-result").data("select2-data"))?(this.highlight(t),this.onSelect(n,e)):e&&e.noFocus&&this.close())},getPlaceholder:function(){var e;return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder||((e=this.getPlaceholderOption())!==v?e.text():v)},getPlaceholderOption:function(){var e;if(this.select)return e=this.select.children("option").first(),this.opts.placeholderOption!==v?"first"===this.opts.placeholderOption&&e||"function"==typeof this.opts.placeholderOption&&this.opts.placeholderOption(this.select):""===y.trim(e.text())&&""===e.val()?e:void 0},initContainerWidth:function(){var e=function(){var e,t,n,i,a;if("off"===this.opts.width)return null;if("element"===this.opts.width)return 0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px";if("copy"!==this.opts.width&&"resolve"!==this.opts.width)return y.isFunction(this.opts.width)?this.opts.width():this.opts.width;if("string"==typeof(e=this.opts.element.attr("style")))for(i=0,a=(t=e.split(";")).length;i<a;i+=1)if(null!==(n=t[i].replace(/\s/g,"").match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i))&&1<=n.length)return n[1];return"resolve"===this.opts.width?0<(e=this.opts.element.css("width")).indexOf("%")?e:0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px":null}.call(this);null!==e&&this.container.css("width",e)}}),t=I(e,{createContainer:function(){return y(document.createElement("div")).attr({class:"select2-container"}).html(["<a href='javascript:void(0)' class='select2-choice' tabindex='-1'>","   <span class='select2-chosen'>&#160;</span><abbr class='select2-search-choice-close'></abbr>","   <span class='select2-arrow' role='presentation'><b role='presentation'></b></span>","</a>","<label for='' class='select2-offscreen'></label>","<input class='select2-focusser select2-offscreen' type='text' aria-haspopup='true' role='button' />","<div class='select2-drop select2-display-none'>","   <div class='select2-search'>","       <label for='' class='select2-offscreen'></label>","       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input' role='combobox' aria-expanded='true'","       aria-autocomplete='list' />","   </div>","   <ul class='select2-results' role='listbox'>","   </ul>","</div>"].join(""))},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.focusser.prop("disabled",!this.isInterfaceEnabled())},opening:function(){var e,t;0<=this.opts.minimumResultsForSearch&&this.showSearch(!0),this.parent.opening.apply(this,arguments),!1!==this.showSearchInput&&this.search.val(this.focusser.val()),this.opts.shouldFocusInput(this)&&(this.search.focus(),(e=this.search.get(0)).createTextRange?((t=e.createTextRange()).collapse(!1),t.select()):e.setSelectionRange&&(t=this.search.val().length,e.setSelectionRange(t,t))),this.prefillNextSearchTerm(),this.focusser.prop("disabled",!0).val(""),this.updateResults(!0),this.opts.element.trigger(y.Event("select2-open"))},close:function(){this.opened()&&(this.parent.close.apply(this,arguments),this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this))&&this.focusser.focus()},focus:function(){this.opened()?this.close():(this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus())},isFocused:function(){return this.container.hasClass("select2-container-active")},cancel:function(){this.parent.cancel.apply(this,arguments),this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus()},destroy:function(){y("label[for='"+this.focusser.attr("id")+"']").attr("for",this.opts.element.attr("id")),this.parent.destroy.apply(this,arguments),A.call(this,"selection","focusser")},initContainer:function(){var t,e=this.container,n=this.dropdown,i=b(),i=(this.opts.minimumResultsForSearch<0?this.showSearch(!1):this.showSearch(!0),this.selection=t=e.find(".select2-choice"),this.focusser=e.find(".select2-focusser"),t.find(".select2-chosen").attr("id","select2-chosen-"+i),this.focusser.attr("aria-labelledby","select2-chosen-"+i),this.results.attr("id","select2-results-"+i),this.search.attr("aria-owns","select2-results-"+i),this.focusser.attr("id","s2id_autogen"+i),e=y("label[for='"+this.opts.element.attr("id")+"']"),this.opts.element.on("focus.select2",this.bind(function(){this.focus()})),this.focusser.prev().text(e.text()).attr("for",this.focusser.attr("id")),this.opts.element.attr("title"));this.opts.element.attr("title",i||e.text()),this.focusser.attr("tabindex",this.elementTabIndex),this.search.attr("id",this.focusser.attr("id")+"_search"),this.search.prev().text(y("label[for='"+this.focusser.attr("id")+"']").text()).attr("for",this.search.attr("id")),this.search.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()&&229!=e.keyCode)if(e.which===c.PAGE_UP||e.which===c.PAGE_DOWN)k(e);else switch(e.which){case c.UP:case c.DOWN:return this.moveHighlight(e.which===c.UP?-1:1),void k(e);case c.ENTER:return this.selectHighlighted(),void k(e);case c.TAB:return void this.selectHighlighted({noFocus:!0});case c.ESC:return this.cancel(e),void k(e)}})),this.search.on("blur",this.bind(function(e){document.activeElement===this.body.get(0)&&window.setTimeout(this.bind(function(){this.opened()&&this.results&&1<this.results.length&&this.search.focus()}),0)})),this.focusser.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()&&e.which!==c.TAB&&!c.isControl(e)&&!c.isFunctionKey(e)&&e.which!==c.ESC){if(!1!==this.opts.openOnEnter||e.which!==c.ENTER)return e.which==c.DOWN||e.which==c.UP||e.which==c.ENTER&&this.opts.openOnEnter?e.altKey||e.ctrlKey||e.shiftKey||e.metaKey?void 0:(this.open(),void k(e)):void(e.which!=c.DELETE&&e.which!=c.BACKSPACE||(this.opts.allowClear&&this.clear(),k(e)));k(e)}})),m(this.focusser),this.focusser.on("keyup-change input",this.bind(function(e){0<=this.opts.minimumResultsForSearch&&(e.stopPropagation(),this.opened()||this.open())})),t.on("mousedown touchstart","abbr",this.bind(function(e){this.isInterfaceEnabled()&&(this.clear(),(e=e).preventDefault(),e.stopImmediatePropagation(),this.close(),this.selection)&&this.selection.focus()})),t.on("mousedown touchstart",this.bind(function(e){l(t),this.container.hasClass("select2-container-active")||this.opts.element.trigger(y.Event("select2-focus")),this.opened()?this.close():this.isInterfaceEnabled()&&this.open(),k(e)})),n.on("mousedown touchstart",this.bind(function(){this.opts.shouldFocusInput(this)&&this.search.focus()})),t.on("focus",this.bind(function(e){k(e)})),this.focusser.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(y.Event("select2-focus")),this.container.addClass("select2-container-active")})).on("blur",this.bind(function(){this.opened()||(this.container.removeClass("select2-container-active"),this.opts.element.trigger(y.Event("select2-blur")))})),this.search.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(y.Event("select2-focus")),this.container.addClass("select2-container-active")})),this.initContainerWidth(),this.opts.element.hide(),this.setPlaceholder()},clear:function(e){var t,n=this.selection.data("select2-data");n&&(t=y.Event("select2-clearing"),this.opts.element.trigger(t),t.isDefaultPrevented()||(t=this.getPlaceholderOption(),this.opts.element.val(t?t.val():""),this.selection.find(".select2-chosen").empty(),this.selection.removeData("select2-data"),this.setPlaceholder(),!1!==e&&(this.opts.element.trigger({type:"select2-removed",val:this.id(n),choice:n}),this.triggerChange({removed:n}))))},initSelection:function(){var t;this.isPlaceholderOptionSelected()?(this.updateSelection(null),this.close(),this.setPlaceholder()):(t=this).opts.initSelection.call(null,this.opts.element,function(e){e!==v&&null!==e&&(t.updateSelection(e),t.close(),t.setPlaceholder(),t.lastSearchTerm=t.search.val())})},isPlaceholderOptionSelected:function(){var e;return this.getPlaceholder()!==v&&((e=this.getPlaceholderOption())!==v&&e.prop("selected")||""===this.opts.element.val()||this.opts.element.val()===v||null===this.opts.element.val())},prepareOpts:function(){var s=this.parent.prepareOpts.apply(this,arguments),n=this;return"select"===s.element.get(0).tagName.toLowerCase()?s.initSelection=function(e,t){e=e.find("option").filter(function(){return this.selected&&!this.disabled});t(n.optionToData(e))}:"data"in s&&(s.initSelection=s.initSelection||function(e,t){var a=e.val(),o=null;s.query({matcher:function(e,t,n){var i=h(a,s.id(n));return i&&(o=n),i},callback:y.isFunction(t)?function(){t(o)}:y.noop})}),s},getPlaceholder:function(){return this.select&&this.getPlaceholderOption()===v?v:this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var e=this.getPlaceholder();!this.isPlaceholderOptionSelected()||e===v||this.select&&this.getPlaceholderOption()===v||(this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(e)),this.selection.addClass("select2-default"),this.container.removeClass("select2-allowclear"))},postprocessResults:function(e,t,n){var i=0,a=this;this.findHighlightableChoices().each2(function(e,t){if(h(a.id(t.data("select2-data")),a.opts.element.val()))return i=e,!1}),!1!==n&&(!0===t&&0<=i?this.highlight(i):this.highlight(0)),!0===t&&0<=(n=this.opts.minimumResultsForSearch)&&this.showSearch(function n(e){var i=0;return y.each(e,function(e,t){t.children?i+=n(t.children):i++}),i}(e.results)>=n)},showSearch:function(e){this.showSearchInput!==e&&(this.showSearchInput=e,this.dropdown.find(".select2-search").toggleClass("select2-search-hidden",!e),this.dropdown.find(".select2-search").toggleClass("select2-offscreen",!e),y(this.dropdown,this.container).toggleClass("select2-with-searchbox",e))},onSelect:function(e,t){var n,i;this.triggerSelect(e)&&(n=this.opts.element.val(),i=this.data(),this.opts.element.val(this.id(e)),this.updateSelection(e),this.opts.element.trigger({type:"select2-selected",val:this.id(e),choice:e}),this.lastSearchTerm=this.search.val(),this.close(),t&&t.noFocus||!this.opts.shouldFocusInput(this)||this.focusser.focus(),h(n,this.id(e))||this.triggerChange({added:e,removed:i}))},updateSelection:function(e){var t,n=this.selection.find(".select2-chosen");this.selection.data("select2-data",e),n.empty(),(t=null!==e?this.opts.formatSelection(e,n,this.opts.escapeMarkup):t)!==v&&n.append(t),(t=this.opts.formatSelectionCssClass(e,n))!==v&&n.addClass(t),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==v&&this.container.addClass("select2-allowclear")},val:function(){var e,t=!1,n=null,i=this,a=this.data();if(0===arguments.length)return this.opts.element.val();if(e=arguments[0],1<arguments.length&&(t=arguments[1],this.opts.debug)&&console&&console.warn&&console.warn('Select2: The second option to `select2("val")` is not supported in Select2 4.0.0. The `change` event will always be triggered in 4.0.0.'),this.select)this.opts.debug&&console&&console.warn&&console.warn('Select2: Setting the value on a <select> using `select2("val")` is no longer supported in 4.0.0. You can use the `.val(newValue).trigger("change")` method provided by jQuery instead.'),this.select.val(e).find("option").filter(function(){return this.selected}).each2(function(e,t){return n=i.optionToData(t),!1}),this.updateSelection(n),this.setPlaceholder(),t&&this.triggerChange({added:n,removed:a});else if(e||0===e){if(this.opts.initSelection===v)throw new Error("cannot call val() if initSelection() is not defined");this.opts.element.val(e),this.opts.initSelection(this.opts.element,function(e){i.opts.element.val(e?i.id(e):""),i.updateSelection(e),i.setPlaceholder(),t&&i.triggerChange({added:e,removed:a})})}else this.clear(t)},clearSearch:function(){this.search.val(""),this.focusser.val("")},data:function(e){var t,n=!1;if(0===arguments.length)return t=(t=this.selection.data("select2-data"))==v?null:t;this.opts.debug&&console&&console.warn&&console.warn('Select2: The `select2("data")` method can no longer set selected values in 4.0.0, consider using the `.val()` method instead.'),1<arguments.length&&(n=arguments[1]),e?(t=this.data(),this.opts.element.val(e?this.id(e):""),this.updateSelection(e),n&&this.triggerChange({added:e,removed:t})):this.clear(n)}}),n=I(e,{createContainer:function(){return y(document.createElement("div")).attr({class:"select2-container select2-container-multi"}).html(["<ul class='select2-choices'>","  <li class='select2-search-field'>","    <label for='' class='select2-offscreen'></label>","    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi select2-display-none'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""))},prepareOpts:function(){var l=this.parent.prepareOpts.apply(this,arguments),i=this;return"select"===l.element.get(0).tagName.toLowerCase()?l.initSelection=function(e,t){var n=[];e.find("option").filter(function(){return this.selected&&!this.disabled}).each2(function(e,t){n.push(i.optionToData(t))}),t(n)}:"data"in l&&(l.initSelection=l.initSelection||function(e,o){var s=p(e.val(),l.separator,l.transformVal),r=[];l.query({matcher:function(e,t,n){var i=y.grep(s,function(e){return h(e,l.id(n))}).length;return i&&r.push(n),i},callback:y.isFunction(o)?function(){for(var e=[],t=0;t<s.length;t++)for(var n=s[t],i=0;i<r.length;i++){var a=r[i];if(h(n,l.id(a))){e.push(a),r.splice(i,1);break}}o(e)}:y.noop})}),l},selectChoice:function(e){var t=this.container.find(".select2-search-choice-focus");t.length&&e&&e[0]==t[0]||(t.length&&this.opts.element.trigger("choice-deselected",t),t.removeClass("select2-search-choice-focus"),e&&e.length&&(this.close(),e.addClass("select2-search-choice-focus"),this.opts.element.trigger("choice-selected",e)))},destroy:function(){y("label[for='"+this.search.attr("id")+"']").attr("for",this.opts.element.attr("id")),this.parent.destroy.apply(this,arguments),A.call(this,"searchContainer","selection")},initContainer:function(){var l,e=".select2-choices",t=(this.searchContainer=this.container.find(".select2-search-field"),this.selection=l=this.container.find(e),this);this.selection.on("click",".select2-container:not(.select2-container-disabled) .select2-search-choice:not(.select2-locked)",function(e){t.search[0].focus(),t.selectChoice(y(this))}),this.search.attr("id","s2id_autogen"+b()),this.search.prev().text(y("label[for='"+this.opts.element.attr("id")+"']").text()).attr("for",this.search.attr("id")),this.opts.element.on("focus.select2",this.bind(function(){this.focus()})),this.search.on("input paste",this.bind(function(){this.search.attr("placeholder")&&0==this.search.val().length||!this.isInterfaceEnabled()||this.opened()||this.open()})),this.search.attr("tabindex",this.elementTabIndex),this.keydowns=0,this.search.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()){++this.keydowns;var t,n,i,a=l.find(".select2-search-choice-focus"),o=a.prev(".select2-search-choice:not(.select2-locked)"),s=a.next(".select2-search-choice:not(.select2-locked)"),r=(r=this.search,n=t=0,"selectionStart"in(r=y(r)[0])?(t=r.selectionStart,n=r.selectionEnd-t):"selection"in document&&(r.focus(),i=document.selection.createRange(),n=document.selection.createRange().text.length,i.moveStart("character",-r.value.length),t=i.text.length-n),{offset:t,length:n});if(!a.length||e.which!=c.LEFT&&e.which!=c.RIGHT&&e.which!=c.BACKSPACE&&e.which!=c.DELETE&&e.which!=c.ENTER)if((e.which!==c.BACKSPACE||1!=this.keydowns)&&e.which!=c.LEFT||0!=r.offset||r.length){if(this.selectChoice(null),this.opened())switch(e.which){case c.UP:case c.DOWN:return this.moveHighlight(e.which===c.UP?-1:1),void k(e);case c.ENTER:return this.selectHighlighted(),void k(e);case c.TAB:return this.selectHighlighted({noFocus:!0}),void this.close();case c.ESC:return this.cancel(e),void k(e)}if(e.which!==c.TAB&&!c.isControl(e)&&!c.isFunctionKey(e)&&e.which!==c.BACKSPACE&&e.which!==c.ESC){if(e.which===c.ENTER){if(!1===this.opts.openOnEnter)return;if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return}this.open(),e.which!==c.PAGE_UP&&e.which!==c.PAGE_DOWN||k(e),e.which===c.ENTER&&k(e)}}else this.selectChoice(l.find(".select2-search-choice:not(.select2-locked)").last()),k(e);else i=a,e.which==c.LEFT&&o.length?i=o:e.which==c.RIGHT?i=s.length?s:null:e.which===c.BACKSPACE?this.unselect(a.first())&&(this.search.width(10),i=o.length?o:s):e.which==c.DELETE?this.unselect(a.first())&&(this.search.width(10),i=s.length?s:null):e.which==c.ENTER&&(i=null),this.selectChoice(i),k(e),i&&i.length||this.open()}})),this.search.on("keyup",this.bind(function(e){this.keydowns=0,this.resizeSearch()})),this.search.on("blur",this.bind(function(e){this.container.removeClass("select2-container-active"),this.search.removeClass("select2-focused"),this.selectChoice(null),this.opened()||this.clearSearch(),e.stopImmediatePropagation(),this.opts.element.trigger(y.Event("select2-blur"))})),this.container.on("click",e,this.bind(function(e){!this.isInterfaceEnabled()||0<y(e.target).closest(".select2-search-choice").length||(this.selectChoice(null),this.clearPlaceholder(),this.container.hasClass("select2-container-active")||this.opts.element.trigger(y.Event("select2-focus")),this.open(),this.focusSearch(),e.preventDefault())})),this.container.on("focus",e,this.bind(function(){this.isInterfaceEnabled()&&(this.container.hasClass("select2-container-active")||this.opts.element.trigger(y.Event("select2-focus")),this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder())})),this.initContainerWidth(),this.opts.element.hide(),this.clearSearch()},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.search.prop("disabled",!this.isInterfaceEnabled())},initSelection:function(){var t;""===this.opts.element.val()&&""===this.opts.element.text()&&(this.updateSelection([]),this.close(),this.clearSearch()),!this.select&&""===this.opts.element.val()||(t=this).opts.initSelection.call(null,this.opts.element,function(e){e!==v&&null!==e&&(t.updateSelection(e),t.close(),t.clearSearch())})},clearSearch:function(){var e=this.getPlaceholder(),t=this.getMaxSearchWidth();e!==v&&0===this.getVal().length&&!1===this.search.hasClass("select2-focused")?(this.search.val(e).addClass("select2-default"),this.search.width(0<t?t:this.container.css("width"))):this.search.val("").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")&&this.search.val("").removeClass("select2-default")},opening:function(){this.clearPlaceholder(),this.resizeSearch(),this.parent.opening.apply(this,arguments),this.focusSearch(),this.prefillNextSearchTerm(),this.updateResults(!0),this.opts.shouldFocusInput(this)&&this.search.focus(),this.opts.element.trigger(y.Event("select2-open"))},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(e){var t={},n=[],i=this;y(e).each(function(){i.id(this)in t||(t[i.id(this)]=0,n.push(this))}),this.selection.find(".select2-search-choice").remove(),this.addSelectedChoice(n),i.postprocessResults()},tokenize:function(){var e=this.search.val();null!=(e=this.opts.tokenizer.call(this,e,this.data(),this.bind(this.onSelect),this.opts))&&e!=v&&(this.search.val(e),0<e.length)&&this.open()},onSelect:function(e,t){this.triggerSelect(e)&&""!==e.text&&(this.addSelectedChoice(e),this.opts.element.trigger({type:"selected",val:this.id(e),choice:e}),this.lastSearchTerm=this.search.val(),this.clearSearch(),this.updateResults(),!this.select&&this.opts.closeOnSelect||this.postprocessResults(e,!1,!0===this.opts.closeOnSelect),!this.opts.closeOnSelect&&0<this.countSelectableResults()?(this.search.width(10),this.resizeSearch(),0<this.getMaximumSelectionSize()&&this.val().length>=this.getMaximumSelectionSize()?this.updateResults(!0):this.prefillNextSearchTerm()&&this.updateResults(),this.positionDropdown()):(this.close(),this.search.width(10)),this.triggerChange({added:e}),t&&t.noFocus||this.focusSearch())},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(e){var t=this.getVal(),n=this;y(e).each(function(){t.push(n.createChoice(this))}),this.setVal(t)},createChoice:function(e){var t=!e.locked,n=y("<li class='select2-search-choice'>    <div></div>    <a href='#' class='select2-search-choice-close' tabindex='-1'></a></li>"),i=y("<li class='select2-search-choice select2-locked'><div></div></li>"),n=t?n:i,i=this.id(e),a=this.opts.formatSelection(e,n.find("div"),this.opts.escapeMarkup);return a!=v&&n.find("div").replaceWith(y("<div></div>").html(a)),(a=this.opts.formatSelectionCssClass(e,n.find("div")))!=v&&n.addClass(a),t&&n.find(".select2-search-choice-close").on("mousedown",k).on("click dblclick",this.bind(function(e){this.isInterfaceEnabled()&&(this.unselect(y(e.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),k(e),this.close(),this.focusSearch())})).on("focus",this.bind(function(){this.isInterfaceEnabled()&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"))})),n.data("select2-data",e),n.insertBefore(this.searchContainer),i},unselect:function(e){var t,n,i=this.getVal();if(0===(e=e.closest(".select2-search-choice")).length)throw"Invalid argument: "+e+". Must be .select2-search-choice";if(t=e.data("select2-data")){var a=y.Event("select2-removing");if(a.val=this.id(t),a.choice=t,this.opts.element.trigger(a),a.isDefaultPrevented())return!1;for(;0<=(n=u(this.id(t),i));)i.splice(n,1),this.setVal(i),this.select&&this.postprocessResults();return e.remove(),this.opts.element.trigger({type:"select2-removed",val:this.id(t),choice:t}),this.triggerChange({removed:t}),!0}},postprocessResults:function(e,t,n){var i=this.getVal(),a=this.results.find(".select2-result"),o=this.results.find(".select2-result-with-children"),s=this;a.each2(function(e,t){0<=u(s.id(t.data("select2-data")),i)&&(t.addClass("select2-selected"),t.find(".select2-result-selectable").addClass("select2-selected"))}),o.each2(function(e,t){t.is(".select2-result-selectable")||0!==t.find(".select2-result-selectable:not(.select2-selected)").length||t.addClass("select2-selected")}),-1==this.highlight()&&!1!==n&&!0===this.opts.closeOnSelect&&s.highlight(0),!this.opts.createSearchChoice&&0<!a.filter(".select2-result:not(.select2-selected)").length&&(e&&(e.more||0!==this.results.find(".select2-no-results").length)||O(s.opts.formatNoMatches,"formatNoMatches")&&this.results.append("<li class='select2-no-results'>"+$(s.opts.formatNoMatches,s.opts.element,s.search.val())+"</li>"))},getMaxSearchWidth:function(){return this.selection.width()-f(this.search)},resizeSearch:function(){var e,t,n,i=f(this.search);t=this.search,a||(n=t[0].currentStyle||window.getComputedStyle(t[0],null),(a=y(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,letterSpacing:n.letterSpacing,textTransform:n.textTransform,whiteSpace:"nowrap"})).attr("class","select2-sizer"),y(document.body).append(a)),a.text(t.val()),n=a.width()+10,t=this.search.offset().left,(t=(t=(t=(e=this.selection.width())-(t-this.selection.offset().left)-i)<n?e-i:t)<40?e-i:t)<=0&&(t=n),this.search.width(Math.floor(t))},getVal:function(){var e;return this.select?null===(e=this.select.val())?[]:e:p(e=this.opts.element.val(),this.opts.separator,this.opts.transformVal)},setVal:function(e){var t,n;this.select?this.select.val(e):(t=[],n={},y(e).each(function(){this in n||(t.push(this),n[this]=0)}),this.opts.element.val(0===t.length?"":t.join(this.opts.separator)))},buildChangeDetails:function(e,t){for(var t=t.slice(0),e=e.slice(0),n=0;n<t.length;n++)for(var i=0;i<e.length;i++)if(h(this.opts.id(t[n]),this.opts.id(e[i]))){t.splice(n,1),n--,e.splice(i,1);break}return{added:t,removed:e}},val:function(e,n){var i,a=this;if(0===arguments.length)return this.getVal();if((i=this.data()).length||(i=[]),e||0===e){if(this.setVal(e),this.select)this.opts.initSelection(this.select,this.bind(this.updateSelection)),n&&this.triggerChange(this.buildChangeDetails(i,this.data()));else{if(this.opts.initSelection===v)throw new Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(e){var t=y.map(e,a.id);a.setVal(t),a.updateSelection(e),a.clearSearch(),n&&a.triggerChange(a.buildChangeDetails(i,a.data()))})}this.clearSearch()}else this.opts.element.val(""),this.updateSelection([]),this.clearSearch(),n&&this.triggerChange({added:this.data(),removed:i})},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var e=[],t=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each(function(){e.push(t.opts.id(y(this).data("select2-data")))}),this.setVal(e),this.triggerChange()},data:function(e,t){var n,i,a=this;if(0===arguments.length)return this.selection.children(".select2-search-choice").map(function(){return y(this).data("select2-data")}).get();i=this.data(),n=y.map(e=e||[],function(e){return a.opts.id(e)}),this.setVal(n),this.updateSelection(e),this.clearSearch(),t&&this.triggerChange(this.buildChangeDetails(i,this.data()))}}),y.fn.select2=function(){var e,t,n,i,a=Array.prototype.slice.call(arguments,0),o=["val","destroy","opened","open","close","focus","isFocused","container","dropdown","onSortStart","onSortEnd","enable","disable","readonly","positionDropdown","data","search"],s=["opened","isFocused","container","dropdown"],r=["val","data"],l={search:"externalSearch"};return this.each(function(){if(0===a.length||"object"==typeof a[0])(t=0===a.length?{}:y.extend({},a[0])).element=y(this),"select"===t.element.get(0).tagName.toLowerCase()?i=t.element.prop("multiple"):(i=t.multiple||!1,"tags"in t&&(t.multiple=i=!0)),(e=new(i?window.Select2.class.multi:window.Select2.class.single)).init(t);else{if("string"!=typeof a[0])throw"Invalid arguments to select2 plugin: "+a;if(u(a[0],o)<0)throw"Unknown method: "+a[0];if(n=v,(e=y(this).data("select2"))!==v)return t=a[0],n="container"===t?e.container:"dropdown"===t?e.dropdown:e[t=l[t]?l[t]:t].apply(e,a.slice(1)),!(0<=u(a[0],s)||0<=u(a[0],r)&&1==a.length)&&void 0}}),n===v?this:n},y.fn.select2.defaults={debug:!1,width:"copy",loadMorePadding:0,closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(e,t,n,i){var a=[];return T(this.text(e),n.term,a,i),a.join("")},transformVal:function(e){return y.trim(e)},formatSelection:function(e,t,n){return e?n(this.text(e)):v},sortResults:function(e,t,n){return e},formatResultCssClass:function(e){return e.css},formatSelectionCssClass:function(e,t){return v},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(e){return e==v?null:e.id},text:function(e){return e&&this.data&&this.data.text?y.isFunction(this.data.text)?this.data.text(e):e[this.data.text]:e.text},matcher:function(e,t){return 0<=d(""+t).toUpperCase().indexOf(d(""+e).toUpperCase())},separator:",",tokenSeparators:[],tokenizer:function(e,t,n,i){var a,o,s,r,l,c=e,d=!1;if(!i.createSearchChoice||!i.tokenSeparators||i.tokenSeparators.length<1)return v;for(;;){for(o=-1,s=0,r=i.tokenSeparators.length;s<r&&(l=i.tokenSeparators[s],!(0<=(o=e.indexOf(l))));s++);if(o<0)break;if(a=e.substring(0,o),e=e.substring(o+l.length),0<a.length&&(a=i.createSearchChoice.call(this,a,t))!==v&&null!==a&&i.id(a)!==v&&null!==i.id(a)){for(d=!1,s=0,r=t.length;s<r;s++)if(h(i.id(a),i.id(t[s]))){d=!0;break}d||n(a)}}return c!==e?e:void 0},escapeMarkup:S,blurOnChange:!1,selectOnBlur:!1,adaptContainerCssClass:function(e){return e},adaptDropdownCssClass:function(e){return null},nextSearchTerm:function(e,t){return v},searchInputPlaceholder:"",createSearchChoicePosition:"top",shouldFocusInput:function(e){return!(("ontouchstart"in window||0<navigator.msMaxTouchPoints)&&e.opts.minimumResultsForSearch<0)}},y.fn.select2.locales=[],y.fn.select2.locales.en={formatMatches:function(e){return 1===e?"One result is available, press enter to select it.":e+" results are available, use up and down arrow keys to navigate."},formatNoMatches:function(){return"No matches found"},formatAjaxError:function(e,t,n){return"Loading failed"},formatInputTooShort:function(e,t){t-=e.length;return"Please enter "+t+" or more character"+(1==t?"":"s")},formatInputTooLong:function(e,t){e=e.length-t;return"Please delete "+e+" character"+(1==e?"":"s")},formatSelectionTooBig:function(e){return"You can only select "+e+" item"+(1==e?"":"s")},formatLoadMore:function(e){return"Loading more results"},formatSearching:function(){return"Searching"}},y.extend(y.fn.select2.defaults,y.fn.select2.locales.en),y.fn.select2.ajaxDefaults={transport:y.ajax,params:{type:"GET",cache:!1,dataType:"json"}},window.Select2={query:{ajax:C,local:E,tags:D},util:{debounce:w,markMatch:T,escapeMarkup:S,stripDiacritics:d},class:{abstract:e,single:t,multi:n}})}(jQuery)}.apply(e,arguments)})}(this),function(e){define("jquery.event.drag",["jquery"],function(){return function(){var h,p,i,f,t,a;(h=jQuery).fn.drag=function(e,t,n){var i="string"==typeof e?e:"",a=h.isFunction(e)?e:h.isFunction(t)?t:null;return 0!==i.indexOf("drag")&&(i="drag"+i),n=(e==a?t:n)||{},a?this.bind(i,n,a):this.trigger(i)},p=h.event,i=p.special,(f=i.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(e){var n=h.data(this,f.datakey),i=e.data||{};n.related+=1,h.each(f.defaults,function(e,t){void 0!==i[e]&&(n[e]=i[e])})},remove:function(){--h.data(this,f.datakey).related},setup:function(){var e;h.data(this,f.datakey)||(e=h.extend({related:0},f.defaults),h.data(this,f.datakey,e),p.add(this,"touchstart mousedown",f.init,e),this.attachEvent&&this.attachEvent("ondragstart",f.dontstart))},teardown:function(){(h.data(this,f.datakey)||{}).related||(h.removeData(this,f.datakey),p.remove(this,"touchstart mousedown",f.init),f.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",f.dontstart))},init:function(e){if(!f.touched){var t,n=e.data;if(!(0!=e.which&&0<n.which&&e.which!=n.which)&&!h(e.target).is(n.not)&&(!n.handle||h(e.target).closest(n.handle,e.currentTarget).length)&&(f.touched="touchstart"==e.type?this:null,n.propagates=1,n.mousedown=this,n.interactions=[f.interaction(this,n)],n.target=e.target,n.pageX=e.pageX,n.pageY=e.pageY,n.dragging=null,t=f.hijack(e,"draginit",n),n.propagates))return(t=f.flatten(t))&&t.length&&(n.interactions=[],h.each(t,function(){n.interactions.push(f.interaction(this,n))})),n.propagates=n.interactions.length,!1!==n.drop&&i.drop&&i.drop.handler(e,n),f.textselect(!1),f.touched?p.add(f.touched,"touchmove touchend",f.handler,n):p.add(document,"mousemove mouseup",f.handler,n),!(!f.touched||n.live)&&void 0}},interaction:function(e,t){t=h(e)[t.relative?"position":"offset"]()||{top:0,left:0};return{drag:e,callback:new f.callback,droppable:[],offset:t}},handler:function(e){var t=e.data;switch(e.type){case!t.dragging&&"touchmove":e.preventDefault();case!t.dragging&&"mousemove":if(Math.pow(e.pageX-t.pageX,2)+Math.pow(e.pageY-t.pageY,2)<Math.pow(t.distance,2))break;e.target=t.target,f.hijack(e,"dragstart",t),t.propagates&&(t.dragging=!0);case"touchmove":e.preventDefault();case"mousemove":if(t.dragging){if(f.hijack(e,"drag",t),t.propagates){!1!==t.drop&&i.drop&&i.drop.handler(e,t);break}e.type="mouseup"}default:f.touched?p.remove(f.touched,"touchmove touchend",f.handler):p.remove(document,"mousemove mouseup",f.handler),t.dragging&&(!1!==t.drop&&i.drop&&i.drop.handler(e,t),f.hijack(e,"dragend",t)),f.textselect(!0),!1===t.click&&t.dragging&&h.data(t.mousedown,"suppress.click",(new Date).getTime()+5),t.dragging=f.touched=!1}},hijack:function(n,i,a,e,t){if(a){var o,s,r,l={event:n.originalEvent,type:n.type},c=i.indexOf("drop")?"drag":"drop",d=e||0,u=isNaN(e)?a.interactions.length:e;n.type=i,n.originalEvent=null,a.results=[];do{if(s=a.interactions[d]){if("dragend"!==i&&s.cancelled)continue;r=f.properties(n,a,s),s.results=[],h(t||s[c]||a.droppable).each(function(e,t){if(r.target=t,!(n.isPropagationStopped=function(){return!1})===(o=t?p.dispatch.call(t,n,r):null)?("drag"==c&&(s.cancelled=!0,--a.propagates),"drop"==i&&(s[c][e]=null)):"dropinit"==i&&s.droppable.push(f.element(o)||t),"dragstart"==i&&(s.proxy=h(f.element(o)||s.drag)[0]),s.results.push(o),delete n.result,"dropinit"!==i)return o}),a.results[d]=f.flatten(s.results),"dropinit"==i&&(s.droppable=f.flatten(s.droppable)),"dragstart"!=i||s.cancelled||r.update()}}while(++d<u);return n.type=l.type,n.originalEvent=l.event,f.flatten(a.results)}},properties:function(e,t,n){var i=n.callback;return i.drag=n.drag,i.proxy=n.proxy||n.drag,i.startX=t.pageX,i.startY=t.pageY,i.deltaX=e.pageX-t.pageX,i.deltaY=e.pageY-t.pageY,i.originalX=n.offset.left,i.originalY=n.offset.top,i.offsetX=i.originalX+i.deltaX,i.offsetY=i.originalY+i.deltaY,i.drop=f.flatten((n.drop||[]).slice()),i.available=f.flatten((n.droppable||[]).slice()),i},element:function(e){if(e&&(e.jquery||1==e.nodeType))return e},flatten:function(e){return h.map(e,function(e){return e&&e.jquery?h.makeArray(e):e&&e.length?f.flatten(e):e})},textselect:function(e){h(document)[e?"unbind":"bind"]("selectstart",f.dontstart).css("MozUserSelect",e?"":"none"),document.unselectable=e?"off":"on"},dontstart:function(){return!1},callback:function(){}}).callback.prototype={update:function(){i.drop&&this.available.length&&h.each(this.available,function(e){i.drop.locate(this,e)})}},t=p.dispatch,p.dispatch=function(e){if(!(0<h.data(this,"suppress."+e.type)-(new Date).getTime()))return t.apply(this,arguments);h.removeData(this,"suppress."+e.type)},a=p.fixHooks.touchstart=p.fixHooks.touchmove=p.fixHooks.touchend=p.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(n,e){var i;return e&&(i=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0]||null)&&h.each(a.props,function(e,t){n[t]=i[t]}),n}}}.apply(e,arguments)})}(this),function(e){define("jquery.event.drop",["jquery"],function(){return function(){var h,p,f;return(h=jQuery).fn.drop=function(e,t,n){var i="string"==typeof e?e:"",a=h.isFunction(e)?e:h.isFunction(t)?t:null;return 0!==i.indexOf("drop")&&(i="drop"+i),n=(e==a?t:n)||{},a?this.bind(i,n,a):this.trigger(i)},h.drop=function(e){f.multi=!0===(e=e||{}).multi?1/0:!1===e.multi?1:(isNaN(e.multi)?f:e).multi,f.delay=e.delay||f.delay,f.tolerance=h.isFunction(e.tolerance)?e.tolerance:null===e.tolerance?null:f.tolerance,f.mode=e.mode||f.mode||"intersect"},p=h.event.special,f=h.event.special.drop={multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",noBubble:!0,add:function(e){h.data(this,f.datakey).related+=1},remove:function(){--h.data(this,f.datakey).related},setup:function(){h.data(this,f.datakey)||(h.data(this,f.datakey,{related:0,active:[],anyactive:0,winner:0,location:{}}),f.targets.push(this))},teardown:function(){var t;(h.data(this,f.datakey)||{}).related||(h.removeData(this,f.datakey),t=this,f.targets=h.grep(f.targets,function(e){return e!==t}))},handler:function(e,t){var n;if(t)switch(e.type){case"mousedown":case"touchstart":n=h(f.targets),(n="string"==typeof t.drop?n.filter(t.drop):n).each(function(){var e=h.data(this,f.datakey);e.active=[],e.anyactive=0,e.winner=0}),t.droppable=n,p.drag.hijack(e,"dropinit",t);break;case"mousemove":case"touchmove":f.event=e,f.timer||f.tolerate(t);break;case"mouseup":case"touchend":f.timer=clearTimeout(f.timer),t.propagates&&(p.drag.hijack(e,"drop",t),p.drag.hijack(e,"dropend",t))}},locate:function(e,t){var n=h.data(e,f.datakey),i=h(e),a=i.offset()||{},o=i.outerHeight(),i=i.outerWidth(),i={elem:e,width:i,height:o,top:a.top,left:a.left,right:a.left+i,bottom:a.top+o};return n&&(n.location=i,n.index=t,n.elem=e),i},contains:function(e,t){return(t[0]||t.left)>=e.left&&(t[0]||t.right)<=e.right&&(t[1]||t.top)>=e.top&&(t[1]||t.bottom)<=e.bottom},modes:{intersect:function(e,t,n){return this.contains(n,[e.pageX,e.pageY])?1e9:this.modes.overlap.apply(this,arguments)},overlap:function(e,t,n){return Math.max(0,Math.min(n.bottom,t.bottom)-Math.max(n.top,t.top))*Math.max(0,Math.min(n.right,t.right)-Math.max(n.left,t.left))},fit:function(e,t,n){return this.contains(n,t)?1:0},middle:function(e,t,n){return this.contains(n,[t.left+.5*t.width,t.top+.5*t.height])?1:0}},sort:function(e,t){return t.winner-e.winner||e.index-t.index},tolerate:function(e){var t,n,i,a,o,s,r,l=0,c=e.interactions.length,d=[f.event.pageX,f.event.pageY],u=f.tolerance||f.modes[f.mode];do{if(r=e.interactions[l]){if(!r)return;r.drop=[],a=[],o=r.droppable.length,u&&(n=f.locate(r.proxy)),t=0;do{if(s=r.droppable[t]){if(!(s=(i=h.data(s,f.datakey)).location))continue;i.winner=u?u.call(f,f.event,n,s):f.contains(s,d)?1:0,a.push(i)}}while(++t<o);for(a.sort(f.sort),t=0;(i=a[t])&&(i.winner&&r.drop.length<f.multi?(i.active[l]||i.anyactive||(!1!==p.drag.hijack(f.event,"dropstart",e,l,i.elem)[0]?(i.active[l]=1,i.anyactive+=1):i.winner=0),i.winner&&r.drop.push(i.elem)):i.active[l]&&1==i.anyactive&&(p.drag.hijack(f.event,"dropend",e,l,i.elem),i.active[l]=0,--i.anyactive)),++t<o;);}}while(++l<c);f.last&&d[0]==f.last.pageX&&d[1]==f.last.pageY?delete f.timer:f.timer=setTimeout(function(){f.tolerate(e)},f.delay),f.last=f.event}},p.dropinit=p.dropstart=p.dropend=f,$.drop}.apply(e,arguments)})}(this),define("mockup-patterns-select2",["jquery","pat-base","mockup-utils","underscore","select2","jquery.event.drag","jquery.event.drop"],function(r,e,l,c){"use strict";return e.extend({name:"select2",trigger:".pat-select2",parser:"mockup",defaults:{separator:","},initializeValues:function(){var a=this;a.options.initialValues&&(a.options.id=function(e){return e.id},a.options.initSelection=function(e,t){var n=[],e=e.val(),i=a.options.initialValues;"string"==typeof a.options.initialValues&&""!==a.options.initialValues&&("{"===a.options.initialValues[0]?i=JSON.parse(a.options.initialValues):(i={},r(a.options.initialValues.split(a.options.separator)).each(function(){var e=this.split(":"),t=r.trim(e[0]),e=r.trim(e[1]);i[t]=e}))),r(e.split(a.options.separator)).each(function(){var e=this;i[this]&&(e=i[this]),n.push({id:l.removeHTML(this),text:c.unescape(l.removeHTML(e))})}),t(n)})},initializeTags:function(){var e=this;e.options.tags&&"string"==typeof e.options.tags&&("["===e.options.tags.substr(0,1)?e.options.tags=JSON.parse(e.options.tags):e.options.tags=e.options.tags.split(e.options.separator)),e.options.tags&&!e.options.allowNewItems&&(e.options.data=r.map(e.options.tags,function(e,t){return{id:e,text:c.unescape(e)}}),e.options.multiple=!0,delete e.options.tags)},initializeOrdering:function(){var n,i=this;i.options.orderable&&(n=function(e,t){return e?e.text:void 0},i.options.formatSelection&&(n=i.options.formatSelection),i.options.formatSelection=function(e,t){return t.parents("li").drag("start",function(e,t){return r(this).addClass("select2-choice-dragging"),i.$el.select2("onSortStart"),r.drop({tolerance:function(e,t,n){var i=e.pageY>n.top+n.height/2;return r.data(n.elem,"drop+reorder",i?"insertAfter":"insertBefore"),this.contains(n,[e.pageX,e.pageY])}}),r(this).clone().addClass("dragging").css({opacity:.75,position:"absolute"}).appendTo(document.body)}).drag(function(e,t){r(t.proxy).css({top:t.offsetY,left:t.offsetX});var n=t.drop[0],i=r.data(n||{},"drop+reorder");!n||n==t.current&&i==t.method||(r(this)[i](n),t.current=n,t.method=i,t.update())}).drag("end",function(e,t){r(this).removeClass("select2-choice-dragging"),i.$el.select2("onSortEnd"),r(t.proxy).remove()}).drop("init",function(e,t){return this!=t.drag}),n(e,t)})},initializeSelect2:function(){var n=this;function t(e,t){e&&(n.options.debug&&console.debug("callback",e,t),(e="string"==typeof e?window[e]:e)(t))}n.options.formatResultCssClass=function(e){if(e.id)return"select2-option-"+e.id.toLowerCase().replace(/[ \:\)\(\[\]\{\}\_\+\=\&\*\%\#]/g,"-")},n.$el.select2(n.options),n.$el.on("select2-selected",function(e){t(n.options.onSelected,e)}),n.$el.on("select2-selecting",function(e){t(n.options.onSelecting,e)}),n.$el.on("select2-deselecting",function(e){t(n.options.onDeselecting,e)}),n.$el.on("select2-deselected",function(e){t(n.options.onDeselected,e)}),n.$select2=n.$el.parent().find(".select2-container"),n.$el.parent().off("close.plone-modal.patterns"),n.options.orderable&&n.$select2.addClass("select2-orderable")},opened:function(){return 1===r(".select2-dropdown-open",this.$el.parent()).length},init:function(){var o,e,t,n,s=this;s.options.allowNewItems=!s.options.hasOwnProperty("allowNewItems")||JSON.parse(s.options.allowNewItems),s.options.ajax||s.options.vocabularyUrl?(s.options.vocabularyUrl&&(s.options.multiple=void 0===s.options.multiple||s.options.multiple,s.options.ajax=s.options.ajax||{},s.options.ajax.url=s.options.vocabularyUrl,s.options.initSelection=function(e,t){var n=[],e=e.val();r(e.split(s.options.separator)).each(function(){var e=l.removeHTML(this);n.push({id:e,text:c.unescape(e)})}),t(n)}),o="",s.options.ajax=r.extend({quietMillis:300,data:function(e,t){return{query:o=e,page_limit:10,page:t}},results:function(e,t){var n,i,a=e.results;return s.options.vocabularyUrl&&(n=[],r.each(e.results,function(e,t){n.push(t.id)}),a=[],i=""===o||0<=r.inArray(o,n),s.options.allowNewItems&&!i&&(o=l.removeHTML(o),a.push({id:o,text:c.unescape(o)})),r.each(e.results,function(e,t){t&&t.text&&(t.text=c.unescape(t.text)),a.push(t)})),{results:a}}},s.options.ajax)):s.options.multiple&&s.$el.is("select")&&(e=s.$el.val()||[],t=r.map(s.$el.find("option"),function(e){return{text:r(e).html(),id:e.value}}),(n=r('<input type="hidden" />')).val(e.join(s.options.separator)),n.attr("class",s.$el.attr("class")),n.attr("name",s.$el.attr("name")),n.attr("id",s.$el.attr("id")),s.$orig=s.$el,s.$el.replaceWith(n),s.$el=n,s.options.data=t),s.initializeValues(),s.initializeTags(),s.initializeOrdering(),s.initializeSelect2()}})}),define("mockup-ui-url/views/base",["jquery","underscore","backbone","translate"],function(n,i,a,o){"use strict";return a.View.extend({isUIView:!0,eventPrefix:"ui",template:null,idPrefix:"base-",appendInContainer:!0,initialize:function(e){for(var t in this.options=e,this.options)this[t]=this.options[t];this.options._t=o},render:function(){return this.applyTemplate(),this.trigger("render",this),this.afterRender(),this.options.id&&this.$el.attr("id",this.idPrefix+this.options.id),this},afterRender:function(){},serializedModel:function(){return this.options},applyTemplate:function(){var e,t;null!==this.template&&(e=n.extend({_t:o},this.options,this.serializedModel()),"string"==typeof(t=this.template)&&(t=i.template(t)),this.$el.html(t(e)))},propagateEvent:function(e){if(0<e.indexOf(":")){e=e.split(":")[0];if(""!==this.eventPrefix&&(e===this.eventPrefix||e===this.eventPrefix+"."+this.id))return!0}return!1},uiEventTrigger:function(e){var t=[].slice.call(arguments,0);""!==this.eventPrefix&&(t[0]=this.eventPrefix+":"+e,a.View.prototype.trigger.apply(this,t),this.id)&&(t[0]=this.eventPrefix+"."+this.id+":"+e,a.View.prototype.trigger.apply(this,t))}})}),define("mockup-patterns-tooltip",["jquery","pat-base"],function(d,e,t){"use strict";function n(e,t){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",e,t)}return n.VERSION="3.2.0",n.DEFAULTS={animation:!0,placement:"auto",selector:!1,template:'<div class="tooltip mockup-tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!0,container:!1,viewport:{selector:"body",padding:0}},n.prototype.init=function(e,t,n){this.enabled=!0,this.type=e,this.$element=d(t),this.options=this.getOptions(n),this.$viewport=this.options.viewport&&d(this.options.viewport.selector||this.options.viewport);for(var i=this.options.trigger.split(" "),a=i.length;a--;){var o,s=i[a];"click"==s?this.$element.on("click."+this.type,this.options.selector,d.proxy(this.toggle,this)):"manual"!=s&&(o="hover"==s?"mouseleave":"focusout",this.$element.on(("hover"==s?"mouseenter":"focusin")+"."+this.type,this.options.selector,d.proxy(this.enter,this)),this.$element.on(o+"."+this.type,this.options.selector,d.proxy(this.leave,this)))}this.options.selector?this._options=d.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.getOptions=function(e){return(e=d.extend({},this.getDefaults(),this.$element.data(),e)).delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},n.prototype.getDelegateOptions=function(){var n={},i=this.getDefaults();return this._options&&d.each(this._options,function(e,t){i[e]!=t&&(n[e]=t)}),n},n.prototype.enter=function(e){var t=e instanceof this.constructor?e:d(e.currentTarget).data("bs."+this.type);if(t||(t=new this.constructor(e.currentTarget,this.getDelegateOptions()),d(e.currentTarget).data("bs."+this.type,t)),t.leaving=!1,clearTimeout(t.timeout),t.hoverState="in",!t.options.delay||!t.options.delay.show)return t.show();t.timeout=setTimeout(function(){"in"==t.hoverState&&t.show()},t.options.delay.show)},n.prototype.leave=function(e){var t=e instanceof this.constructor?e:d(e.currentTarget).data("bs."+this.type);if(t.leaving=!0,t||(t=new this.constructor(e.currentTarget,this.getDelegateOptions()),d(e.currentTarget).data("bs."+this.type,t)),clearTimeout(t.timeout),t.hoverState="out",!t.options.delay||!t.options.delay.hide)return t.hide();t.timeout=setTimeout(function(){"out"==t.hoverState&&t.hide()},t.options.delay.hide)},n.prototype.show=function(){var e,r,l,c,t=d.Event("show.bs."+this.type);this.hasContent()&&this.enabled&&(this.$element.trigger(t),e=d.contains(document.documentElement,this.$element[0]),!t.isDefaultPrevented())&&e&&(r=this.tip(),l=this.getUID(this.type),(c=this).setContent().then(function(){r.attr("id",l),c.$element.attr("aria-describedby",l),c.options.animation&&r.addClass("fade");function e(){c.$element.trigger("shown.bs."+c.type),c.hoverState=null,c.leaving&&c.leave(c)}var t="function"==typeof c.options.placement?c.options.placement.call(c,r[0],c.$element[0]):c.options.placement,n=/\s?auto?\s?/i,i=n.test(t),n=(i&&(t=t.replace(n,"")||"top"),r.detach().css({top:0,left:0,display:"block"}).addClass(t).data("bs."+c.type,c),c.options.container?r.appendTo(c.options.container):r.insertAfter(c.$element),c.getPosition()),a=r[0].offsetWidth,o=r[0].offsetHeight,s=(i&&(i=t,s=c.$element.parent(),s=c.getPosition(s),t="bottom"==t&&n.top+n.height+o-s.scroll>s.height?"top":"top"==t&&n.top-s.scroll-o<0?"bottom":"right"==t&&n.right+a>s.width?"left":"left"==t&&n.left-a<s.left?"right":t,r.removeClass(i).addClass(t)),c.getCalculatedOffset(t,n,a,o));c.applyPlacement(s,t);d.support.transition&&c.$tip.hasClass("fade")?r.one("bsTransitionEnd",e).emulateTransitionEnd(150):e()}))},n.prototype.applyPlacement=function(e,t){var n=this.tip(),i=n[0].offsetWidth,a=n[0].offsetHeight,o=parseInt(n.css("margin-top"),10),s=parseInt(n.css("margin-left"),10),o=(isNaN(o)&&(o=0),isNaN(s)&&(s=0),e.top=e.top+o,e.left=e.left+s,d.offset.setOffset(n[0],d.extend({using:function(e){n.css({top:Math.round(e.top),left:Math.round(e.left)})}},e),0),n.addClass("in"),n[0].offsetWidth),s=n[0].offsetHeight,t=("top"==t&&s!=a&&(e.top=e.top+a-s),this.getViewportAdjustedDelta(t,e,o,s)),i=(t.left?e.left+=t.left:e.top+=t.top,t.left?2*t.left-i+o:2*t.top-a+s),o=t.left?"left":"top",a=t.left?"offsetWidth":"offsetHeight";n.offset(e),this.replaceArrow(i,n[0][a],o)},n.prototype.replaceArrow=function(e,t,n){this.arrow().css(n,e?50*(1-e/t)+"%":"")},n.prototype.setContent=function(){var t=this.tip(),n=this.options.html?"html":"text",i=this.options.patTooltip?this.options.patTooltip.contentSelector:null;function a(e){"html"===n&&i&&(e=d(e).find(i).html()),t.find(".tooltip-inner")[n](e)}function e(){t.removeClass("fade in top bottom left right")}var o=this.getTitle(),s=this.getUrl();return s?(e(),d.get(s).then(function(e){a(e)})):(e(),a(o),new Promise(function(e,t){e(o)}))},n.prototype.getUrl=function(){return this.options.patTooltip?this.options.patTooltip.ajaxUrl:null},n.prototype.hide=function(){var e=this,t=this.tip(),n=d.Event("hide.bs."+this.type);function i(){"in"!=e.hoverState&&t.detach(),e.$element.trigger("hidden.bs."+e.type)}if(this.$element.removeAttr("aria-describedby"),this.$element.trigger(n),!n.isDefaultPrevented())return t.removeClass("in"),d.support.transition&&this.$tip.hasClass("fade")?t.one("bsTransitionEnd",i).emulateTransitionEnd(150):i(),this.hoverState=null,this},n.prototype.fixTitle=function(){var e=this.$element;!e.attr("title")&&"string"==typeof e.attr("data-original-title")||e.attr("data-original-title",e.attr("title")||"").attr("title","")},n.prototype.hasContent=function(){return this.getTitle()||this.getUrl()},n.prototype.getPosition=function(e){var t=(e=e||this.$element)[0],n="BODY"==t.tagName;return d.extend({},"function"==typeof t.getBoundingClientRect?t.getBoundingClientRect():null,{scroll:n?document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop(),width:n?d(window).width():e.outerWidth(),height:n?d(window).height():e.outerHeight()},n?{top:0,left:0}:e.offset())},n.prototype.getCalculatedOffset=function(e,t,n,i){return"bottom"==e?{top:t.top+t.height,left:t.left+t.width/2-n/2}:"top"==e?{top:t.top-i,left:t.left+t.width/2-n/2}:"left"==e?{top:t.top+t.height/2-i/2,left:t.left-n}:{top:t.top+t.height/2-i/2,left:t.left+t.width}},n.prototype.getViewportAdjustedDelta=function(e,t,n,i){var a,o,s={top:0,left:0};return this.$viewport&&(a=this.options.viewport&&this.options.viewport.padding||0,o=this.getPosition(this.$viewport),/right|left/.test(e)?(e=t.top-a-o.scroll,i=t.top+a-o.scroll+i,e<o.top?s.top=o.top-e:i>o.top+o.height&&(s.top=o.top+o.height-i)):(e=t.left-a,i=t.left+a+n,e<o.left?s.left=o.left-e:i>o.width&&(s.left=o.left+o.width-i))),s},n.prototype.getTitle=function(){var e=this.$element,t=this.options;return e.attr("data-original-title")||("function"==typeof t.title?t.title.call(e[0]):t.title)},n.prototype.getUID=function(e){for(;e+=~~(1e6*Math.random()),document.getElementById(e););return e},n.prototype.tip=function(){var e;return this.$tip||(e=this.$tip||d(this.options.template),this.options.patTooltip&&(this.options.patTooltip.style&&e.css(this.options.patTooltip.style),this.options.patTooltip.class&&e.addClass(this.options.patTooltip.class),this.options.patTooltip.innerStyle)&&e.find(".tooltip-inner").css(this.options.patTooltip.innerStyle),this.$tip=e)},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},n.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},n.prototype.enable=function(){this.enabled=!0},n.prototype.disable=function(){this.enabled=!1},n.prototype.toggleEnabled=function(){this.enabled=!this.enabled},n.prototype.toggle=function(e){var t=this;e&&!(t=d(e.currentTarget).data("bs."+this.type))&&(t=new this.constructor(e.currentTarget,this.getDelegateOptions()),d(e.currentTarget).data("bs."+this.type,t)),t.tip().hasClass("in")?t.leave(t):t.enter(t)},e.extend({name:"tooltip",trigger:".pat-tooltip",parser:"mockup",defaults:{html:!(n.prototype.destroy=function(){clearTimeout(this.timeout),this.hide().$element.off("."+this.type).removeData("bs."+this.type)}),placement:"top"},init:function(){"true"===this.options.html||!0===this.options.html?this.options.html=!0:this.options.html=!1,this.data=new n(this.$el[0],this.options)}})}),define("mockup-ui-url/views/button",["underscore","mockup-ui-url/views/base","mockup-patterns-tooltip"],function(n,i,a){"use strict";return i.extend({tagName:"a",className:"btn",eventPrefix:"button",context:"default",idPrefix:"btn-",attributes:{href:"#"},extraClasses:[],tooltip:null,template:'<% if (icon) { %><span class="glyphicon glyphicon-<%= icon %>"></span><% } %> <%= title %>',events:{click:"handleClick"},initialize:function(e){var t;e.id||(t=e.title||"",e.id=""!==t?t.toLowerCase().replace(" ","-"):this.cid),i.prototype.initialize.apply(this,[e]),this.on("render",function(){this.$el.attr("title",this.options.title||""),this.$el.attr("aria-label",this.options.title||this.options.tooltip||""),null!==this.context&&this.$el.addClass("btn-"+this.context),n.each(this.extraClasses,function(e){this.$el.addClass(e)}.bind(this)),null!==this.tooltip&&(this.$el.attr("title",this.tooltip),new a(this.$el),this.$el.on("hidden",function(e){"hidden"===e.type&&e.stopPropagation()}))},this)},handleClick:function(e){e.preventDefault(),this.$el.is(".disabled")||this.uiEventTrigger("click",this,e)},serializedModel:function(){return n.extend({icon:"",title:""},this.options)},disable:function(){this.$el.addClass("disabled")},enable:function(){this.$el.removeClass("disabled")}})}),define("text",["module"],function(e){"use strict";var l,a,o,s,r,i=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],n=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,c=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,d="undefined"!=typeof location&&location.href,u=d&&location.protocol&&location.protocol.replace(/\:/,""),h=d&&location.hostname,p=d&&(location.port||void 0),f={},m=e.config&&e.config()||{};function g(e,t){return void 0===e||""===e?t:e}return l={version:"2.0.15",strip:function(e){var t;return e?(t=(e=e.replace(n,"")).match(c))&&(e=t[1]):e="",e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:m.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){n=i[t];try{e=new ActiveXObject(n)}catch(e){}if(e){i=[n];break}}return e},parseName:function(e){var t,n,i=!1,a=e.lastIndexOf("."),o=0===e.indexOf("./")||0===e.indexOf("../");return-1!==a&&(!o||1<a)?(t=e.substring(0,a),n=e.substring(a+1)):t=e,-1!==(a=(o=n||t).indexOf("!"))&&(i="strip"===o.substring(a+1),o=o.substring(0,a),n?n=o:t=o),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,i){var a,o,e=l.xdRegExp.exec(e);return!e||(a=e[2],o=(e=(e=e[3]).split(":"))[1],e=e[0],(!a||a===t)&&(!e||e.toLowerCase()===n.toLowerCase())&&(!o&&!e||function(e,t,n,i){if(t===i)return!0;if(e===n){if("http"===e)return g(t,"80")===g(i,"80");if("https"===e)return g(t,"443")===g(i,"443")}return!1}(a,o,t,i)))},finishLoad:function(e,t,n,i){n=t?l.strip(n):n,m.isBuild&&(f[e]=n),i(n)},load:function(t,e,n,i){var a,o,s;i&&i.isBuild&&!i.inlineText||(m.isBuild=i&&i.isBuild,i=(a=l.parseName(t)).moduleName+(a.ext?"."+a.ext:""),o=e.toUrl(i),s=m.useXhr||l.useXhr,0===o.indexOf("empty:"))?n():!d||s(o,u,h,p)?l.get(o,function(e){l.finishLoad(t,a.strip,e,n)},function(e){n.error&&n.error(e)}):e([i],function(e){l.finishLoad(a.moduleName+"."+a.ext,a.strip,e,n)})},write:function(e,t,n,i){var a;f.hasOwnProperty(t)&&(a=l.jsEscape(f[t]),n.asModule(e+"!"+t,"define(function () { return '"+a+"';});\n"))},writeFile:function(n,e,t,i,a){var e=l.parseName(e),o=e.ext?"."+e.ext:"",s=e.moduleName+o,r=t.toUrl(e.moduleName+o)+".js";l.load(s,t,function(e){function t(e){return i(r,e)}t.asModule=function(e,t){return i.asModule(e,r,t)},l.write(n,s,t,a)},a)}},"node"===m.env||!m.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(a=require.nodeRequire("fs"),l.get=function(e,t,n){try{var i=a.readFileSync(e,"utf8");t(i="\ufeff"===i[0]?i.substring(1):i)}catch(e){n&&n(e)}}):"xhr"===m.env||!m.env&&l.createXhr()?l.get=function(n,i,a,e){var t,o=l.createXhr();if(o.open("GET",n,!0),e)for(t in e)e.hasOwnProperty(t)&&o.setRequestHeader(t.toLowerCase(),e[t]);m.onXhr&&m.onXhr(o,n),o.onreadystatechange=function(e){var t;4===o.readyState&&(399<(t=o.status||0)&&t<600?((t=new Error(n+" HTTP status: "+t)).xhr=o,a&&a(t)):i(o.responseText),m.onXhrComplete)&&m.onXhrComplete(o,n)},o.send(null)}:"rhino"===m.env||!m.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?l.get=function(e,t){var n,i,e=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),o=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(e),"utf-8")),e="";try{for(n=new java.lang.StringBuffer,null!==(i=(i=o.readLine())&&i.length()&&65279===i.charAt(0)?i.substring(1):i)&&n.append(i);null!==(i=o.readLine());)n.append(a),n.append(i);e=String(n.toString())}finally{o.close()}t(e)}:("xpconnect"===m.env||!m.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(o=Components.classes,s=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),r="@mozilla.org/windows-registry-key;1"in o,l.get=function(t,e){var n,i,a={};r&&(t=t.replace(/\//g,"\\")),t=new FileUtils.File(t);try{(n=o["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream)).init(t,1,0,!1),(i=o["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream)).init(n,"utf-8",n.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),i.readString(n.available(),a),i.close(),n.close(),e(a.value)}catch(e){throw new Error((t&&t.path||"")+": "+e)}}),l}),define("text!mockup-patterns-relateditems-url/templates/breadcrumb.xml",[],function(){return'<span class="separator">/<span>\n<a href="<%- path %>" class="crumb"><%- _.unescape(text) %></a>\n'}),define("text!mockup-patterns-relateditems-url/templates/favorite.xml",[],function(){return'<li><a href="<%- path %>" class="fav" aria-labelledby="blip"><%- _.unescape(title) %></a></li>\n'}),define("text!mockup-patterns-relateditems-url/templates/recentlyused.xml",[],function(){return'<li class="pattern-relateditems-recentlyused">\n  <a class="pattern-relateditems-recentlyused-select" data-uid="<%- UID %>">\n    <div class="pattern-relateditems-recentlyused-info">\n      <span\n        class="pattern-relateditems-recentlyused-title <%- portal_type ? \'contenttype-\' + portal_type.toLowerCase() : \'\' %> <%- review_state ? \'state-\' + review_state : \'\' %>"\n        title="<%- portal_type %>">\n        <%- _.unescape(Title) %>\n      </span>\n      <span class="pattern-relateditems-recentlyused-path"><%- path %></span>\n    </div>\n    <% if (getURL && (getIcon || portal_type === "Image")) { %>\n      <div class="pattern-relateditems-recentlyused-image">\n        <img src="<%- getURL %>/@@images/image/tile" />\n      </div>\n    <% } %>\n  </a>\n</li>\n'}),define("text!mockup-patterns-relateditems-url/templates/result.xml",[],function(){return'<div class="pattern-relateditems-result <%- oneLevelUp ? \'one-level-up\' : \'\' %>">\n  <div class="pattern-relateditems-result-browse-wrapper">\n  <% if (!oneLevelUp) { %>\n    <a\n      class="pattern-relateditems-result-select<%- selectable ? \' selectable\' : \'\' %><%- oneLevelUp ? \' one-level-up\' : \'\' %>"\n      data-path="<%- path %>">\n  <% } %>\n      <div class="pattern-relateditems-result-info">\n        <span\n          class="pattern-relateditems-result-title <%- portal_type ? \'contenttype-\' + portal_type.toLowerCase() : \'\' %> <%- review_state ? \'state-\' + review_state : \'\' %>"\n          title="<%- portal_type %>">\n          <%- _.unescape(Title) %>\n        </span>\n        <span class="pattern-relateditems-result-path"><%- oneLevelUp ? currentPath : path %></span>\n      </div>\n      <% if (is_folderish) { %>\n        <a\n          class="pattern-relateditems-result-browse"\n          data-path="<%- path %>"\n          title="<%- oneLevelUp ? one_level_up : open_folder %>">\n          <span class="<%- oneLevelUp ? \'icon-left-circle\' : \'icon-right-circle\' %>"></span>\n        </a>\n      <% } %>\n  <% if (!oneLevelUp) { %>\n    </a>\n  <% } %>\n  </div>\n  <% if (getURL && (getIcon || portal_type === "Image")) { %>\n    <% if (!oneLevelUp) { %>\n    <a\n      class="pattern-relateditems-result-select<%- selectable ? \' selectable\' : \'\' %><%- oneLevelUp ? \' one-level-up\' : \'\' %>"\n      data-path="<%- path %>">\n    <% } %>\n    <div class="pattern-relateditems-result-image">\n      <img src="<%- getURL %>/@@images/image/thumb" />\n    </div>\n    <% if (!oneLevelUp) { %>\n    </a>\n    <% } %>\n  <% } %>\n</div>\n'}),define("text!mockup-patterns-relateditems-url/templates/selection.xml",[],function(){return'<div class="pattern-relateditems-item">\n  <div class="pattern-relateditems-result-info">\n    <span\n      class="pattern-relateditems-item-title <%- portal_type ? \'contenttype-\' + portal_type.toLowerCase() : \'\' %> <%- review_state ? \'state-\' + review_state : \'\' %>"\n      title="<%- portal_type %>">\n      <%- _.unescape(Title) %>\n    </span>\n    <span class="pattern-relateditems-item-path"><%- path %></span>\n  </div>\n  <% if (getURL && (getIcon || portal_type === "Image")) { %>\n    <div class="pattern-relateditems-item-image">\n      <img src="<%- getURL %>/@@images/image/thumb" />\n    </div>\n  <% } %>\n</div>\n'}),define("text!mockup-patterns-relateditems-url/templates/toolbar.xml",[],function(){return'<% if (mode!==\'auto\') { %>\n<div class="btn-group mode-selector" role="group">\n  <button type="button" class="mode search btn <% if (mode==\'search\') { %>btn-primary<% } else {%>btn-default<% } %>"><%- searchModeText %></button>\n  <button type="button" class="mode browse btn <% if (mode==\'browse\') { %>btn-primary<% } else {%>btn-default<% } %>"><%- browseModeText %></button>\n</div>\n<% } %>\n<div class="path-wrapper">\n  <span class="pattern-relateditems-path-label"><%- searchText %></span>\n  <a class="crumb" href="/"><span class="glyphicon glyphicon-home"/></a>\n  <%= items %>\n</div>\n<div class="controls pull-right">\n\n  <% if (recentlyUsedItems) { %>\n  <div class="recentlyUsed dropdown pull-right">\n    <button type="button" class="recentlyUsed dropdown-toggle btn btn-primary" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n      <span class="glyphicon glyphicon-time"/>\n      <%- recentlyUsedText %>\n      <span class="caret"/>\n    </button>\n    <ul class="dropdown-menu">\n      <%= recentlyUsedItems %>\n    </ul>\n  </div>\n  <% } %>\n\n  <% if (favorites.length > 0) { %>\n  <div class="favorites dropdown pull-right">\n    <button type="button" class="favorites dropdown-toggle btn btn-primary" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n      <span class="glyphicon glyphicon-star"/>\n      <%- favText %>\n      <span class="caret"/>\n    </button>\n    <ul class="dropdown-menu">\n      <%= favItems %>\n    </ul>\n  </div>\n  <% } %>\n</div>\n'}),define("mockup-patterns-relateditems",["jquery","underscore","pat-base","mockup-patterns-select2","mockup-ui-url/views/button","mockup-utils","pat-registry","translate","text!mockup-patterns-relateditems-url/templates/breadcrumb.xml","text!mockup-patterns-relateditems-url/templates/favorite.xml","text!mockup-patterns-relateditems-url/templates/recentlyused.xml","text!mockup-patterns-relateditems-url/templates/result.xml","text!mockup-patterns-relateditems-url/templates/selection.xml","text!mockup-patterns-relateditems-url/templates/toolbar.xml","bootstrap-dropdown"],function(r,l,e,t,c,d,n,u,i,a,o,s,h,p){"use strict";var f=37,m=39;return e.extend({name:"relateditems",trigger:".pat-relateditems",parser:"mockup",currentPath:void 0,selectedUIDs:[],openAfterInit:void 0,defaults:{vocabularyUrl:null,attributes:["UID","Title","portal_type","path","getURL","getIcon","is_folderish","review_state"],basePath:"",pageSize:10,browsing:void 0,closeOnSelect:!0,contextPath:void 0,dropdownCssClass:"pattern-relateditems-dropdown",favorites:[],recentlyUsed:!1,recentlyUsedMaxItems:20,recentlyUsedKey:"relateditems_recentlyused",maximumSelectionSize:-1,minimumInputLength:0,mode:"auto",orderable:!0,pathOperator:"plone.app.querystring.operation.string.path",rootPath:"/",rootUrl:"",scanSelection:!1,selectableTypes:null,separator:",",sortOn:null,sortOrder:"ascending",tokenSeparators:[","," "],upload:!1,uploadAllowView:void 0,width:"100%",breadcrumbTemplate:i,breadcrumbTemplateSelector:null,favoriteTemplate:a,favoriteTemplateSelector:null,recentlyusedTemplate:o,recentlyusedTemplateSelector:null,resultTemplate:s,resultTemplateSelector:null,selectionTemplate:h,selectionTemplateSelector:null,toolbarTemplate:p,toolbarTemplateSelector:null,multiple:!0},recentlyUsed:function(e){var t=(t=d.storage.get(this.options.recentlyUsedKey)||[]).slice(t.length-1e3,t.length),e=(e&&t.filter(this.isSelectable.bind(this)),parseInt(this.options.recentlyUsedMaxItems,10));return t=e?t.slice(t.length-e,t.length):t},applyTemplate:function(e,t){var n=this,i=n.options[e+"TemplateSelector"]&&(i=r(n.options[e+"TemplateSelector"]).html())||n.options[e+"Template"],e=r.extend(!0,{},n.options,t,{browsing:n.browsing,open_folder:u("Open folder"),current_directory:u("current directory:"),one_level_up:u("Go one level up")});return e._item=t,l.template(i)(e)},setAjax:function(){var e={url:this.options.vocabularyUrl,dataType:"JSON",quietMillis:500,data:function(e,t){var n=[],e=(e&&n.push({i:"SearchableText",o:"plone.app.querystring.operation.string.contains",v:e="*"+e+"*"}),!this.browsing&&this.options.selectableTypes&&n.push({i:"portal_type",o:"plone.app.querystring.operation.selection.any",v:this.options.selectableTypes}),n.push({i:"path",o:this.options.pathOperator,v:this.options.rootPath+this.currentPath+(this.browsing?"::1":"")}),this.options.sortOn),i=e?this.options.sortOrder:null;return this.browsing&&null===e&&(e="getObjPositionInParent",i="ascending"),{query:JSON.stringify({criteria:n,sort_on:e,sort_order:i}),attributes:JSON.stringify(this.options.attributes),batch:JSON.stringify({page:t||1,size:this.options.pageSize})}}.bind(this),results:function(e,t){var n=t*this.options.pageSize<e.total,e=e.results,i=(this.selectedUIDs=(this.$el.select2("data")||[]).map(function(e){return e.UID}),e=e.filter(function(e){return!!(this.browsing&&e.is_folderish||this.isSelectable(e)&&-1===this.selectedUIDs.indexOf(e.UID))}.bind(this)),this.currentPath.split("/"));return{results:e=1===t&&this.browsing&&1<i.length&&"/"!==this.currentPath?[{oneLevelUp:!0,Title:u("One level up"),path:i.slice(0,i.length-1).join("/")||"/",currentPath:this.currentPath,is_folderish:!0,selectable:!1}].concat(e):e,more:n}}.bind(this)};this.options.ajax=e},renderToolbar:function(){var a=this,e=a.currentPath.split("/"),n="",i="",t=(l.each(e,function(e){var t;""!==e&&((t={}).path=n=n+"/"+e,t.text=e,i+=a.applyTemplate("breadcrumb",t))}),""),o=(l.each(a.options.favorites,function(e){e=l.clone(e);e.path=e.path.substr(a.options.rootPath.length)||"/",t+=a.applyTemplate("favorite",e)}),"");function s(e,t){var n="upload-"+d.generateId(),i=new c({id:n,title:u("Upload"),tooltip:u("Upload files"),icon:"upload"});t&&i.disable(),r(".controls",a.$toolbar).prepend(i.render().el),a.uploadView=new e({triggerView:i,app:a}),r("#btn-"+n,a.$toolbar).append(a.uploadView.render().el)}a.options.recentlyUsed&&(e=a.recentlyUsed(!0),l.each(e.reverse(),function(e){o+=a.applyTemplate("recentlyused",e)})),e=a.applyTemplate("toolbar",{items:i,favItems:t,favText:u("Favorites"),searchText:u("Current path:"),searchModeText:u("Search"),browseModeText:u("Browse"),recentlyUsedItems:o,recentlyUsedText:u("Recently Used")}),a.$toolbar.html(e),r(".dropdown-toggle",a.$toolbar).dropdown(),r(".pattern-relateditems-dropdown").unbind("mouseup"),r(".pattern-relateditems-dropdown").bind("mouseup",function(e){e.stopPropagation()}),r("button.mode.search",a.$toolbar).on("click",function(e){e.preventDefault(),a.browsing&&(r("button.mode.search",a.$toolbar).toggleClass("btn-primary btn-default"),r("button.mode.browse",a.$toolbar).toggleClass("btn-primary btn-default"),a.browsing=!1,0<a.$el.select2("data").length&&(a.openAfterInit=!0),a.openAfterInit)||(a.$el.select2("close"),a.$el.select2("open"))}),r("button.mode.browse",a.$toolbar).on("click",function(e){e.preventDefault(),!a.browsing&&(r("button.mode.search",a.$toolbar).toggleClass("btn-primary btn-default"),r("button.mode.browse",a.$toolbar).toggleClass("btn-primary btn-default"),a.browsing=!0,0<a.$el.select2("data").length&&(a.openAfterInit=!0),a.openAfterInit)||(a.$el.select2("close"),a.$el.select2("open"))}),r("a.crumb",a.$toolbar).on("click",function(e){e.preventDefault(),a.browseTo(r(this).attr("href"))}),r("a.fav",a.$toolbar).on("click",function(e){e.preventDefault(),a.browseTo(r(this).attr("href"))}),a.options.recentlyUsed&&r(".pattern-relateditems-recentlyused-select",a.$toolbar).on("click",function(e){e.preventDefault();var t=r(this).data("uid"),e=a.recentlyUsed().filter(function(e){return e.UID===t});0<e.length&&(e=e[0],a.selectItem(e),0<a.options.maximumSelectionSize)&&(a.$el.select2("data").length,a.options.maximumSelectionSize)}),a.options.upload&&d.featureSupport.dragAndDrop()&&d.featureSupport.fileApi()&&require(["mockup-patterns-relateditems-upload"],function(t){a.options.uploadAllowView?r.ajax({url:a.options.uploadAllowView,dataType:"JSON",data:{path:a.options.rootPath+a.currentPath},type:"GET",success:function(e){s(t,!e.allowUpload)}}):s(t)})},browseTo:function(e){var t=this;t.emit("before-browse"),t.currentPath=e,t.$el.select2("close"),t.renderToolbar(),t.$el.select2("open"),t.emit("after-browse")},selectItem:function(t){var e,n=this,i=(n.emit("selecting"),n.$el.select2("data"));i.push(t),n.$el.select2("data",i,!0),n.options.recentlyUsed&&(0<(e=(i=n.recentlyUsed()).filter(function(e){return e.UID===t.UID})).length&&i.splice(i.indexOf(e[0]),1),i.push(t),d.storage.set(n.options.recentlyUsedKey,i)),n.emit("selected")},deselectItem:function(n){this.emit("deselecting");var i=this.$el.select2("data");l.each(i,function(e,t){e.UID===n.UID&&i.splice(t,1)}),this.$el.select2("data",i,!0),this.emit("deselected")},isSelectable:function(e){return!1!==e.selectable&&(null===this.options.selectableTypes||-1!==this.options.selectableTypes.indexOf(e.portal_type))},init:function(){var a=this;a.browsing="search"!==a.options.mode,a.options.rootPath=a.options.rootPath.replace(/\/$/,""),a.currentPath=a.options.basePath.substr(a.options.rootPath.length)||"/",a.setAjax(),a.$el.wrap('<div class="pattern-relateditems-container" />'),a.$container=a.$el.parents(".pattern-relateditems-container"),a.$container.width(a.options.width),t.prototype.initializeValues.call(a),t.prototype.initializeTags.call(a),a.options.formatSelection=function(e){e=r.extend(!0,{Title:"",getIcon:"",getURL:"",path:"",portal_type:"",review_state:""},e);var t=r(a.applyTemplate("selection",e));return a.options.scanSelection&&n.scan(t),1==a.options.maximumSelectionSize&&(e=(e=e.path).split("/").slice(0,-1).join("/"),a.currentPath=e,a.renderToolbar()),t},t.prototype.initializeOrdering.call(a),a.options.formatResult=function(t){t.selectable=a.isSelectable(t),t=r.extend(!0,{Title:"",getIcon:"",getURL:"",is_folderish:!1,oneLevelUp:!1,path:"",portal_type:"",review_state:"",selectable:!1},t),-1!==a.selectedUIDs.indexOf(t.UID)&&(t.selectable=!1);var e=r(a.applyTemplate("result",t));return r(".pattern-relateditems-result-select",e).on("click",function(e){e.preventDefault(),r(this).is(".selectable")&&((e=r(this).parents(".pattern-relateditems-result")).is(".pattern-relateditems-active")?(e.removeClass("pattern-relateditems-active"),a.deselectItem(t)):(0<a.options.maximumSelectionSize&&a.$el.select2("data").length>=a.options.maximumSelectionSize&&a.$el.select2("close"),a.selectItem(t),e.addClass("pattern-relateditems-active"),a.options.closeOnSelect&&a.$el.select2("close")))}),r(".pattern-relateditems-result-browse",e).on("click",function(e){e.preventDefault(),e.stopPropagation();e=r(this).data("path");a.browseTo(e)}),r(e)},a.options.initSelection=function(e,n){var i,e=r(e).val();""!==e&&(i=e.split(a.options.separator),new d.QueryHelper(r.extend(!0,{},a.options,{pattern:a})).search("UID","plone.app.querystring.operation.list.contains",i,function(e){var t=e.results.reduce(function(e,t){return e[t.UID]=t,e},{});try{n(i.map(function(e){return t[e]}).filter(function(e){return void 0!==e}))}catch(e){}a.openAfterInit&&(a.$el.select2("open"),a.openAfterInit=void 0)},!1))},a.options.tokenizer=function(e){"auto"===this.options.mode&&(this.browsing=!e)}.bind(this),a.options.id=function(e){return e.UID},t.prototype.initializeSelect2.call(a),a.$toolbar=r('<div class="toolbar ui-offset-parent" />'),a.$container.prepend(a.$toolbar),a.$el.on("select2-selecting",function(e){a.isSelectable(e.choice)||e.preventDefault()}),a.renderToolbar(),r(document).on("keyup",a.$el,function(e){!t.prototype.opened.call(a)||e.which!==f&&e.which!==m||(e.stopPropagation(),e=e.which===f?".pattern-relateditems-result.one-level-up":".select2-highlighted",1===(e=r(".pattern-relateditems-result-browse",e)).length&&(e=e.data("path"),a.browseTo(e)))})}})}),function(e){"function"==typeof define&&define.amd?define("picker",["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):"object"==typeof window?window.Picker=e(jQuery):this.Picker=e(jQuery)}(function(f){var i=f(window),m=f(document),a=f(document.documentElement),g=null!=document.documentElement.style.transition;function y(a,t,n,e){var i,r,l,o,c,d;return a?(i=!1,r={id:a.id||"P"+Math.abs(~~(Math.random()*new Date)),handlingOpen:!1},l=n?f.extend(!0,{},n.defaults,e):e||{},o=f.extend({},y.klasses(),l.klass),c=f(a),d=(e=function(){return this.start()}).prototype={constructor:e,$node:c,start:function(){var e;return r&&r.start?d:(r.methods={},r.start=!0,r.open=!1,r.type=a.type,a.autofocus=a==k(),a.readOnly=!l.editable,a.id=a.id||r.id,"text"!=a.type&&(a.type="text"),d.component=new n(d,l),d.$root=f('<div class="'+o.picker+'" id="'+a.id+'_root" />'),w(d.$root[0],"hidden",!0),d.$holder=f(s()).appendTo(d.$root),u(),l.formatSubmit&&(!0===l.hiddenName?(e=a.name,a.name=""):e=(e=["string"==typeof l.hiddenPrefix?l.hiddenPrefix:"","string"==typeof l.hiddenSuffix?l.hiddenSuffix:"_submit"])[0]+a.name+e[1],d._hidden=f('<input type=hidden name="'+e+'"'+(c.data("value")||a.value?' value="'+d.get("select",l.formatSubmit)+'"':"")+">")[0],c.on("change."+r.id,function(){d._hidden.value=a.value?d.get("select",l.formatSubmit):""})),c.data(t,d).addClass(o.input).val(c.data("value")?d.get("select",l.format):a.value).on("focus."+r.id+" click."+r.id,function(e){e.preventDefault(),d.open()}).on("mousedown",function(){r.handlingOpen=!0;var e=function(){setTimeout(function(){f(document).off("mouseup",e),r.handlingOpen=!1},0)};f(document).on("mouseup",e)}),l.editable||c.on("keydown."+r.id,p),w(a,{haspopup:!0,expanded:!1,readonly:!1,owns:a.id+"_root"}),l.containerHidden?f(l.containerHidden).append(d._hidden):c.after(d._hidden),l.container?f(l.container).append(d.$root):c.after(d.$root),d.on({start:d.component.onStart,render:d.component.onRender,stop:d.component.onStop,open:d.component.onOpen,close:d.component.onClose,set:d.component.onSet}).on({start:l.onStart,render:l.onRender,stop:l.onStop,open:l.onOpen,close:l.onClose,set:l.onSet}),i=function(e){var t,n="position";e.currentStyle?t=e.currentStyle[n]:window.getComputedStyle&&(t=getComputedStyle(e)[n]);return"fixed"==t}(d.$holder[0]),a.autofocus&&d.open(),d.trigger("start").trigger("render"))},render:function(e){return e?(d.$holder=f(s()),u(),d.$root.html(d.$holder)):d.$root.find("."+o.box).html(d.component.nodes(r.open)),d.trigger("render")},stop:function(){return r.start&&(d.close(),d._hidden&&d._hidden.parentNode.removeChild(d._hidden),d.$root.remove(),c.removeClass(o.input).removeData(t),setTimeout(function(){c.off("."+r.id)},0),a.type=r.type,a.readOnly=!1,d.trigger("stop"),r.methods={},r.start=!1),d},open:function(e){return r.open?d:(c.addClass(o.active),w(a,"expanded",!0),setTimeout(function(){d.$root.addClass(o.opened),w(d.$root[0],"hidden",!1)},0),!1!==e&&(r.open=!0,i&&f("body").css("overflow","hidden").css("padding-right","+="+v()),i&&g?d.$holder.find("."+o.frame).one("transitionend",function(){d.$holder.eq(0).focus()}):setTimeout(function(){d.$holder.eq(0).focus()},0),m.on("click."+r.id+" focusin."+r.id,function(e){var t;r.handlingOpen||(t=b(e,a),e.isSimulated)||t==a||t==document||3==e.which||d.close(t===d.$holder[0])}).on("keydown."+r.id,function(e){var t=e.keyCode,n=d.component.key[t],i=b(e,a);27==t?d.close(!0):i!=d.$holder[0]||!n&&13!=t?f.contains(d.$root[0],i)&&13==t&&(e.preventDefault(),i.click()):(e.preventDefault(),n?y._.trigger(d.component.key.go,d,[y._.trigger(n)]):d.$root.find("."+o.highlighted).hasClass(o.disabled)||(d.set("select",d.component.item.highlight),l.closeOnSelect&&d.close(!0)))})),d.trigger("open"))},close:function(e){return e&&(l.editable?a.focus():(d.$holder.off("focus.toOpen").focus(),setTimeout(function(){d.$holder.on("focus.toOpen",h)},0))),c.removeClass(o.active),w(a,"expanded",!1),setTimeout(function(){d.$root.removeClass(o.opened+" "+o.focused),w(d.$root[0],"hidden",!0)},0),r.open?(r.open=!1,i&&f("body").css("overflow","").css("padding-right","-="+v()),m.off("."+r.id),d.trigger("close")):d},clear:function(e){return d.set("clear",null,e)},set:function(e,t,n){var i,a,o=f.isPlainObject(e),s=o?e:{};if(n=o&&f.isPlainObject(t)?t:n||{},e){for(i in o||(s[e]=t),s)a=s[i],i in d.component.item&&(void 0===a&&(a=null),d.component.set(i,a,n)),"select"!=i&&"clear"!=i||!l.updateInput||c.val("clear"==i?"":d.get(i,l.format)).trigger("change");d.render()}return n.muted?d:d.trigger("set",s)},get:function(e,t){if(null!=r[e=e||"value"])return r[e];if("valueSubmit"==e){if(d._hidden)return d._hidden.value;e="value"}var n;return"value"==e?a.value:e in d.component.item?"string"==typeof t?(n=d.component.get(e))?y._.trigger(d.component.formats.toString,d.component,[t,n]):"":d.component.get(e):void 0},on:function(e,t,n){var i,a,o=f.isPlainObject(e),s=o?e:{};if(e)for(i in o||(s[e]=t),s)a=s[i],r.methods[i=n?"_"+i:i]=r.methods[i]||[],r.methods[i].push(a);return d},off:function(){var e,t=arguments,n=0;for(namesCount=t.length;n<namesCount;n+=1)(e=t[n])in r.methods&&delete r.methods[e];return d},trigger:function(e,t){function n(e){(e=r.methods[e])&&e.map(function(e){y._.trigger(e,d,[t])})}return n("_"+e),n(e),d}},new e):y;function s(){return y._.node("div",y._.node("div",y._.node("div",y._.node("div",d.component.nodes(r.open),o.box),o.wrap),o.frame),o.holder,'tabindex="-1"')}function u(){d.$holder.on({keydown:p,"focus.toOpen":h,blur:function(){c.removeClass(o.target)},focusin:function(e){d.$root.removeClass(o.focused),e.stopPropagation()},"mousedown click":function(e){var t=b(e,a);t!=d.$holder[0]&&(e.stopPropagation(),"mousedown"!=e.type||f(t).is("input, select, textarea, button, option")||(e.preventDefault(),d.$holder.eq(0).focus()))}}).on("click","[data-pick], [data-nav], [data-clear], [data-close]",function(){var e=f(this),t=e.data(),e=e.hasClass(o.navDisabled)||e.hasClass(o.disabled),n=(n=k())&&(n.type||n.href?n:null);(e||n&&!f.contains(d.$root[0],n))&&d.$holder.eq(0).focus(),!e&&t.nav?d.set("highlight",d.component.item.highlight,{nav:t.nav}):!e&&"pick"in t?(d.set("select",t.pick),l.closeOnSelect&&d.close(!0)):t.clear?(d.clear(),l.closeOnClear&&d.close(!0)):t.close&&d.close(!0)})}function h(e){e.stopPropagation(),c.addClass(o.target),d.$root.addClass(o.focused),d.open()}function p(e){var t=e.keyCode,n=/^(8|46)$/.test(t);if(27==t)return d.close(!0),!1;(32==t||n||!r.open&&d.component.key[t])&&(e.preventDefault(),e.stopPropagation(),n?d.clear().close():d.open())}}function v(){if(a.height()<=i.height())return 0;var e=f('<div style="visibility:hidden;width:100px" />').appendTo("body"),t=e[0].offsetWidth;e.css("overflow","scroll");var n=f('<div style="width:100%" />').appendTo(e)[0].offsetWidth;return e.remove(),t-n}function b(e,t){var n=[];return e.path&&(n=e.path),(n=e.originalEvent&&e.originalEvent.path?e.originalEvent.path:n)&&0<n.length?t&&0<=n.indexOf(t)?t:n[0]:e.target}function w(e,t,n){if(f.isPlainObject(t))for(var i in t)o(e,i,t[i]);else o(e,t,n)}function o(e,t,n){e.setAttribute(("role"==t?"":"aria-")+t,n)}function k(){try{return document.activeElement}catch(e){}}return y.klasses=function(e){return{picker:e=e||"picker",opened:e+"--opened",focused:e+"--focused",input:e+"__input",active:e+"__input--active",target:e+"__input--target",holder:e+"__holder",frame:e+"__frame",wrap:e+"__wrap",box:e+"__box"}},y._={group:function(e){for(var t,n="",i=y._.trigger(e.min,e);i<=y._.trigger(e.max,e,[i]);i+=e.i)t=y._.trigger(e.item,e,[i]),n+=y._.node(e.node,t[0],t[1],t[2]);return n},node:function(e,t,n,i){return t?"<"+e+(n=n?' class="'+n+'"':"")+(i=i?" "+i:"")+">"+(t=f.isArray(t)?t.join(""):t)+"</"+e+">":""},lead:function(e){return(e<10?"0":"")+e},trigger:function(e,t,n){return"function"==typeof e?e.apply(t,n||[]):e},digits:function(e){return/\d/.test(e[1])?2:1},isDate:function(e){return-1<{}.toString.call(e).indexOf("Date")&&this.isInteger(e.getDate())},isInteger:function(e){return-1<{}.toString.call(e).indexOf("Number")&&e%1==0},ariaAttr:function(e,t){f.isPlainObject(e)||(e={attribute:t});for(var n in t="",e){var i=("role"==n?"":"aria-")+n,a=e[n];t+=null==a?"":i+'="'+e[n]+'"'}return t}},y.extend=function(i,a){f.fn[i]=function(e,t){var n=this.data(i);return"picker"==e?n:n&&"string"==typeof e?y._.trigger(n[e],n,[t]):this.each(function(){f(this).data(i)||new y(this,i,a,e)})},f.fn[i].defaults=a.defaults},y}),function(e){"function"==typeof define&&define.amd?define("picker.date",["./picker","jquery"],e):"object"==typeof exports?module.exports=e(require("./picker.js"),require("jquery")):e(Picker,jQuery)}(function(e,f){var t,g=e._;function n(t,n){function e(){return o.currentStyle?"rtl"==o.currentStyle.direction:"rtl"==getComputedStyle(t.$root[0]).direction}var i,a=this,o=t.$node[0],s=o.value,r=t.$node.data("value"),s=r||s,r=r?n.formatSubmit:n.format;a.settings=n,a.$node=t.$node,a.queue={min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"parse navigate create validate",view:"parse create validate viewset",disable:"deactivate",enable:"activate"},a.item={},a.item.clear=null,a.item.disable=(n.disable||[]).slice(0),a.item.enable=-(!0===(i=a.item.disable)[0]?i.shift():-1),a.set("min",n.min).set("max",n.max).set("now"),s?a.set("select",s,{format:r,defaultValue:!0}):a.set("select",null).set("highlight",a.item.now),a.key={40:7,38:-7,39:function(){return e()?-1:1},37:function(){return e()?1:-1},go:function(e){var t=a.item.highlight,t=new Date(t.year,t.month,t.date+e);a.set("highlight",t,{interval:e}),this.render()}},t.on("render",function(){t.$root.find("."+n.klass.selectMonth).on("change",function(){var e=this.value;e&&(t.set("highlight",[t.get("view").year,e,t.get("highlight").date]),t.$root.find("."+n.klass.selectMonth).trigger("focus"))}),t.$root.find("."+n.klass.selectYear).on("change",function(){var e=this.value;e&&(t.set("highlight",[e,t.get("view").month,t.get("highlight").date]),t.$root.find("."+n.klass.selectYear).trigger("focus"))})},1).on("open",function(){var e="";a.disabled(a.get("now"))&&(e=":not(."+n.klass.buttonToday+")"),t.$root.find("button"+e+", select").attr("disabled",!1)},1).on("close",function(){t.$root.find("button, select").attr("disabled",!0)},1)}function i(e,t,n){e=e.match(/[^\x00-\x7F]+|\w+/)[0];return n.mm||n.m||(n.m=t.indexOf(e)+1),e.length}function a(e){return e.match(/\w+/)[0].length}n.prototype.set=function(t,n,i){var a=this,e=a.item;return null===n?e[t="clear"==t?"select":t]=n:(e["enable"==t?"disable":"flip"==t?"enable":t]=a.queue[t].split(" ").map(function(e){return n=a[e](t,n,i)}).pop(),"select"==t?a.set("highlight",e.select,i):"highlight"==t?a.set("view",e.highlight,i):t.match(/^(flip|min|max|disable|enable)$/)&&(e.select&&a.disabled(e.select)&&a.set("select",e.select,i),e.highlight)&&a.disabled(e.highlight)&&a.set("highlight",e.highlight,i)),a},n.prototype.get=function(e){return this.item[e]},n.prototype.create=function(e,t,n){var i;return(t=void 0===t?e:t)==-1/0||t==1/0?i=t:t=f.isPlainObject(t)&&g.isInteger(t.pick)?t.obj:f.isArray(t)?(t=new Date(t[0],t[1],t[2]),g.isDate(t)?t:this.create().obj):g.isInteger(t)||g.isDate(t)?this.normalize(new Date(t),n):this.now(e,t,n),{year:i||t.getFullYear(),month:i||t.getMonth(),date:i||t.getDate(),day:i||t.getDay(),obj:i||t,pick:i||t.getTime()}},n.prototype.createRange=function(e,t){function n(e){return!0===e||f.isArray(e)||g.isDate(e)?i.create(e):e}var i=this;return g.isInteger(e)||(e=n(e)),g.isInteger(t)||(t=n(t)),g.isInteger(e)&&f.isPlainObject(t)?e=[t.year,t.month,t.date+e]:g.isInteger(t)&&f.isPlainObject(e)&&(t=[e.year,e.month,e.date+t]),{from:n(e),to:n(t)}},n.prototype.withinRange=function(e,t){return e=this.createRange(e.from,e.to),t.pick>=e.from.pick&&t.pick<=e.to.pick},n.prototype.overlapRanges=function(e,t){var n=this;return e=n.createRange(e.from,e.to),t=n.createRange(t.from,t.to),n.withinRange(e,t.from)||n.withinRange(e,t.to)||n.withinRange(t,e.from)||n.withinRange(t,e.to)},n.prototype.now=function(e,t,n){return t=new Date,n&&n.rel&&t.setDate(t.getDate()+n.rel),this.normalize(t,n)},n.prototype.navigate=function(e,t,n){var i,a,o,s=f.isArray(t),r=f.isPlainObject(t),l=this.item.view;if(s||r){for(o=r?(i=t.year,a=t.month,t.date):(i=+t[0],a=+t[1],+t[2]),n&&n.nav&&l&&l.month!==a&&(i=l.year,a=l.month),i=(s=new Date(i,a+(n&&n.nav?n.nav:0),1)).getFullYear(),a=s.getMonth();new Date(i,a,o).getMonth()!==a;)--o;t=[i,a,o]}return t},n.prototype.normalize=function(e){return e.setHours(0,0,0,0),e},n.prototype.measure=function(e,t){return g.isInteger(t)?t=this.now(e,t,{rel:t}):t?"string"==typeof t&&(t=this.parse(e,t)):t="min"==e?-1/0:1/0,t},n.prototype.viewset=function(e,t){return this.create([t.year,t.month,1])},n.prototype.validate=function(e,n,t){var i,a,o,s,r=this,l=n,c=t&&t.interval?t.interval:1,d=-1===r.item.enable,u=r.item.min,h=r.item.max,p=d&&r.item.disable.filter(function(e){var t;return f.isArray(e)&&((t=r.create(e).pick)<n.pick?i=!0:t>n.pick&&(a=!0)),g.isInteger(e)}).length;if((!t||!t.nav&&!t.defaultValue)&&(!d&&r.disabled(n)||d&&r.disabled(n)&&(p||i||a)||!d&&(n.pick<=u.pick||n.pick>=h.pick)))for(d&&!p&&(!a&&0<c||!i&&c<0)&&(c*=-1);r.disabled(n)&&(1<Math.abs(c)&&(n.month<l.month||n.month>l.month)&&(n=l,c=0<c?1:-1),n.pick<=u.pick?(o=!0,c=1,n=r.create([u.year,u.month,u.date+(n.pick===u.pick?0:-1)])):n.pick>=h.pick&&(s=!0,c=-1,n=r.create([h.year,h.month,h.date+(n.pick===h.pick?0:1)])),!o||!s);)n=r.create([n.year,n.month,n.date+c]);return n},n.prototype.disabled=function(t){var n=this,e=(e=n.item.disable.filter(function(e){return g.isInteger(e)?t.day===(n.settings.firstDay?e:e-1)%7:f.isArray(e)||g.isDate(e)?t.pick===n.create(e).pick:f.isPlainObject(e)?n.withinRange(e,t):void 0})).length&&!e.filter(function(e){return f.isArray(e)&&"inverted"==e[3]||f.isPlainObject(e)&&e.inverted}).length;return-1===n.item.enable?!e:e||t.pick<n.item.min.pick||t.pick>n.item.max.pick},n.prototype.parse=function(e,i,t){var a=this,o={};return i&&"string"==typeof i?(t&&t.format||((t=t||{}).format=a.settings.format),a.formats.toArray(t.format).map(function(e){var t=a.formats[e],n=t?g.trigger(t,a,[i,o]):e.replace(/^!/,"").length;t&&(o[e]=i.substr(0,n)),i=i.substr(n)}),[o.yyyy||o.yy,+(o.mm||o.m)-1,o.dd||o.d]):i},n.prototype.formats={d:function(e,t){return e?g.digits(e):t.date},dd:function(e,t){return e?2:g.lead(t.date)},ddd:function(e,t){return e?a(e):this.settings.weekdaysShort[t.day]},dddd:function(e,t){return e?a(e):this.settings.weekdaysFull[t.day]},m:function(e,t){return e?g.digits(e):t.month+1},mm:function(e,t){return e?2:g.lead(t.month+1)},mmm:function(e,t){var n=this.settings.monthsShort;return e?i(e,n,t):n[t.month]},mmmm:function(e,t){var n=this.settings.monthsFull;return e?i(e,n,t):n[t.month]},yy:function(e,t){return e?2:(""+t.year).slice(2)},yyyy:function(e,t){return e?4:t.year},toArray:function(e){return e.split(/(d{1,4}|m{1,4}|y{4}|yy|!.)/g)},toString:function(e,t){var n=this;return n.formats.toArray(e).map(function(e){return g.trigger(n.formats[e],n,[0,t])||e.replace(/^!/,"")}).join("")}},n.prototype.isDateExact=function(e,t){return g.isInteger(e)&&g.isInteger(t)||"boolean"==typeof e&&"boolean"==typeof t?e===t:(g.isDate(e)||f.isArray(e))&&(g.isDate(t)||f.isArray(t))?this.create(e).pick===this.create(t).pick:!(!f.isPlainObject(e)||!f.isPlainObject(t))&&this.isDateExact(e.from,t.from)&&this.isDateExact(e.to,t.to)},n.prototype.isDateOverlap=function(e,t){var n=this.settings.firstDay?1:0;return g.isInteger(e)&&(g.isDate(t)||f.isArray(t))?(e=e%7+n)===this.create(t).day+1:g.isInteger(t)&&(g.isDate(e)||f.isArray(e))?(t=t%7+n)===this.create(e).day+1:!(!f.isPlainObject(e)||!f.isPlainObject(t))&&this.overlapRanges(e,t)},n.prototype.flipEnable=function(e){var t=this.item;t.enable=e||(-1==t.enable?1:-1)},n.prototype.deactivate=function(e,t){var i=this,a=i.item.disable.slice(0);return"flip"==t?i.flipEnable():!1===t?(i.flipEnable(1),a=[]):!0===t?(i.flipEnable(-1),a=[]):t.map(function(e){for(var t,n=0;n<a.length;n+=1)if(i.isDateExact(e,a[n])){t=!0;break}t||(g.isInteger(e)||g.isDate(e)||f.isArray(e)||f.isPlainObject(e)&&e.from&&e.to)&&a.push(e)}),a},n.prototype.activate=function(e,t){var o=this,s=o.item.disable,r=s.length;return"flip"==t?o.flipEnable():!0===t?(o.flipEnable(1),s=[]):!1===t?(o.flipEnable(-1),s=[]):t.map(function(e){for(var t,n,i,a=0;a<r;a+=1){if(n=s[a],o.isDateExact(n,e)){i=!(t=s[a]=null);break}if(o.isDateOverlap(n,e)){f.isPlainObject(e)?(e.inverted=!0,t=e):f.isArray(e)?(t=e)[3]||t.push("inverted"):g.isDate(e)&&(t=[e.getFullYear(),e.getMonth(),e.getDate(),"inverted"]);break}}if(t)for(a=0;a<r;a+=1)if(o.isDateExact(s[a],e)){s[a]=null;break}if(i)for(a=0;a<r;a+=1)if(o.isDateOverlap(s[a],e)){s[a]=null;break}t&&s.push(t)}),s.filter(function(e){return null!=e})},n.prototype.nodes=function(s){function e(e){return g.node("div"," ",l.klass["nav"+(e?"Next":"Prev")]+(e&&h.year>=m.year&&h.month>=m.month||!e&&h.year<=f.year&&h.month<=f.month?" "+l.klass.navDisabled:""),"data-nav="+(e||-1)+" "+g.ariaAttr({role:"button",controls:r.$node[0].id+"_table"})+' title="'+(e?l.labelMonthNext:l.labelMonthPrev)+'"')}function t(){var t=l.showMonthsShort?l.monthsShort:l.monthsFull;return l.selectMonths?g.node("select",g.group({min:0,max:11,i:1,node:"option",item:function(e){return[t[e],0,"value="+e+(h.month==e?" selected":"")+(h.year==f.year&&e<f.month||h.year==m.year&&e>m.month?" disabled":"")]}}),l.klass.selectMonth,(s?"":"disabled")+" "+g.ariaAttr({controls:r.$node[0].id+"_table"})+' title="'+l.labelMonthSelect+'"'):g.node("div",t[h.month],l.klass.month)}function n(){var e,t,n,i,a=h.year,o=!0===l.selectYears?5:~~(l.selectYears/2);return o?(n=f.year,e=m.year,t=a+o,(o=a-o)<n&&(t+=n-o,o=n),e<t&&(o-=(i=t-e)<(n=o-n)?i:n,t=e),g.node("select",g.group({min:o,max:t,i:1,node:"option",item:function(e){return[e,0,"value="+e+(a==e?" selected":"")]}}),l.klass.selectYear,(s?"":"disabled")+" "+g.ariaAttr({controls:r.$node[0].id+"_table"})+' title="'+l.labelYearSelect+'"')):g.node("div",a,l.klass.year)}var i,a,r=this,l=r.settings,o=r.item,c=o.now,d=o.select,u=o.highlight,h=o.view,p=o.disable,f=o.min,m=o.max,o=(i=(l.showWeekdaysFull?l.weekdaysFull:l.weekdaysShort).slice(0),a=l.weekdaysFull.slice(0),l.firstDay&&(i.push(i.shift()),a.push(a.shift())),g.node("thead",g.node("tr",g.group({min:0,max:6,i:1,node:"th",item:function(e){return[i[e],l.klass.weekdays,'scope=col title="'+a[e]+'"']}}))));return g.node("div",(l.selectYears?n()+t():t()+n())+e()+e(1),l.klass.header)+g.node("table",o+g.node("tbody",g.group({min:0,max:5,i:1,node:"tr",item:function(e){var t=l.firstDay&&0===r.create([h.year,h.month,1]).day?-7:0;return[g.group({min:7*e-h.day+t+1,max:function(){return this.min+7-1},i:1,node:"td",item:function(e){e=r.create([h.year,h.month,e+(l.firstDay?1:0)]);var t,n=d&&d.pick==e.pick,i=u&&u.pick==e.pick,a=p&&r.disabled(e)||e.pick<f.pick||e.pick>m.pick,o=g.trigger(r.formats.toString,r,[l.format,e]);return[g.node("div",e.date,((t=[l.klass.day]).push(h.month==e.month?l.klass.infocus:l.klass.outfocus),c.pick==e.pick&&t.push(l.klass.now),n&&t.push(l.klass.selected),i&&t.push(l.klass.highlighted),a&&t.push(l.klass.disabled),t.join(" ")),"data-pick="+e.pick+" "+g.ariaAttr({role:"gridcell",label:o,selected:!(!n||r.$node.val()!==o)||null,activedescendant:!!i||null,disabled:!!a||null})),"",g.ariaAttr({role:"presentation"})]}})]}})),l.klass.table,'id="'+r.$node[0].id+'_table" '+g.ariaAttr({role:"grid",controls:r.$node[0].id,readonly:!0}))+g.node("div",g.node("button",l.today,l.klass.buttonToday,"type=button data-pick="+c.pick+(s&&!r.disabled(c)?"":" disabled")+" "+g.ariaAttr({controls:r.$node[0].id}))+g.node("button",l.clear,l.klass.buttonClear,"type=button data-clear=1"+(s?"":" disabled")+" "+g.ariaAttr({controls:r.$node[0].id}))+g.node("button",l.close,l.klass.buttonClose,"type=button data-close=true "+(s?"":" disabled")+" "+g.ariaAttr({controls:r.$node[0].id})),l.klass.footer)},n.defaults={labelMonthNext:"Next month",labelMonthPrev:"Previous month",labelMonthSelect:"Select a month",labelYearSelect:"Select a year",monthsFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdaysFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],today:"Today",clear:"Clear",close:"Close",closeOnSelect:!0,closeOnClear:!0,updateInput:!0,format:"d mmmm, yyyy",klass:{table:(t=e.klasses().picker+"__")+"table",header:t+"header",navPrev:t+"nav--prev",navNext:t+"nav--next",navDisabled:t+"nav--disabled",month:t+"month",year:t+"year",selectMonth:t+"select--month",selectYear:t+"select--year",weekdays:t+"weekday",day:t+"day",disabled:t+"day--disabled",selected:t+"day--selected",highlighted:t+"day--highlighted",now:t+"day--today",infocus:t+"day--infocus",outfocus:t+"day--outfocus",footer:t+"footer",buttonClear:t+"button--clear",buttonToday:t+"button--today",buttonClose:t+"button--close"}},e.extend("pickadate",n)}),function(e){"function"==typeof define&&define.amd?define("picker.time",["./picker","jquery"],e):"object"==typeof exports?module.exports=e(require("./picker.js"),require("jquery")):e(Picker,jQuery)}(function(e,l){var t,a=1440,p=e._;function n(a,o){var e,t=this,n=a.$node[0].value,i=a.$node.data("value"),n=i||n,i=i?o.formatSubmit:o.format;t.settings=o,t.$node=a.$node,t.queue={interval:"i",min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"parse create validate",view:"parse create validate",disable:"deactivate",enable:"activate"},t.item={},t.item.clear=null,t.item.interval=o.interval||30,t.item.disable=(o.disable||[]).slice(0),t.item.enable=-(!0===(e=t.item.disable)[0]?e.shift():-1),t.set("min",o.min).set("max",o.max).set("now"),n?t.set("select",n,{format:i}):t.set("select",null).set("highlight",t.item.now),t.key={40:1,38:-1,39:1,37:-1,go:function(e){t.set("highlight",t.item.highlight.pick+e*t.item.interval,{interval:e*t.item.interval}),this.render()}},a.on("render",function(){function e(t,n){i("transform").map(function(e){t.css(e,n)}),i("transition").map(function(e){t.css(e,n)})}var t=a.$root.children(),n=t.find("."+o.klass.viewset),i=function(t){return["webkit","moz","ms","o",""].map(function(e){return(e?"-"+e+"-":"")+t})};n.length&&(e(t,"none"),t[0].scrollTop=~~n.position().top-2*n[0].clientHeight,e(t,""))},1).on("open",function(){a.$root.find("button").attr("disabled",!1)},1).on("close",function(){a.$root.find("button").attr("disabled",!0)},1)}n.prototype.set=function(t,n,i){var a=this,e=a.item;return null===n?e[t="clear"==t?"select":t]=n:(e["enable"==t?"disable":"flip"==t?"enable":t]=a.queue[t].split(" ").map(function(e){return n=a[e](t,n,i)}).pop(),"select"==t?a.set("highlight",e.select,i):"highlight"==t?a.set("view",e.highlight,i):"interval"==t?a.set("min",e.min,i).set("max",e.max,i):t.match(/^(flip|min|max|disable|enable)$/)&&(e.select&&a.disabled(e.select)&&a.set("select",n,i),e.highlight&&a.disabled(e.highlight)&&a.set("highlight",n,i),"min"==t)&&a.set("max",e.max,i)),a},n.prototype.get=function(e){return this.item[e]},n.prototype.create=function(e,t,n){var i=this;return p.isDate(t=void 0===t?e:t)&&(t=[t.getHours(),t.getMinutes()]),l.isPlainObject(t)&&p.isInteger(t.pick)?t=t.pick:l.isArray(t)?t=60*+t[0]+ +t[1]:p.isInteger(t)||(t=i.now(e,t,n)),"max"==e&&t<i.item.min.pick&&(t+=a),"min"!=e&&"max"!=e&&(t-i.item.min.pick)%i.item.interval!=0&&(t+=i.item.interval),{hour:~~(24+(t=i.normalize(e,t,n))/60)%24,mins:(60+t%60)%60,time:(a+t)%a,pick:t%a}},n.prototype.createRange=function(e,t){function n(e){return!0===e||l.isArray(e)||p.isDate(e)?i.create(e):e}var i=this;return p.isInteger(e)||(e=n(e)),p.isInteger(t)||(t=n(t)),p.isInteger(e)&&l.isPlainObject(t)?e=[t.hour,t.mins+e*i.settings.interval]:p.isInteger(t)&&l.isPlainObject(e)&&(t=[e.hour,e.mins+t*i.settings.interval]),{from:n(e),to:n(t)}},n.prototype.withinRange=function(e,t){return e=this.createRange(e.from,e.to),t.pick>=e.from.pick&&t.pick<=e.to.pick},n.prototype.overlapRanges=function(e,t){var n=this;return e=n.createRange(e.from,e.to),t=n.createRange(t.from,t.to),n.withinRange(e,t.from)||n.withinRange(e,t.to)||n.withinRange(t,e.from)||n.withinRange(t,e.to)},n.prototype.now=function(e,t){var n,i=this.item.interval,a=new Date,a=60*a.getHours()+a.getMinutes();return a-=a%i,n=t<0&&i*t+a<=-i,a+="min"==e&&n?0:i,p.isInteger(t)&&(a+=i*(n&&"max"!=e?t+1:t)),a},n.prototype.normalize=function(e,t){var n=this.item.interval,i=this.item.min&&this.item.min.pick||0;return t-="min"==e?0:(t-i)%n},n.prototype.measure=function(e,t,n){return"string"==typeof(t=t||("min"==e?[0,0]:[23,59]))?t=this.parse(e,t):!0===t||p.isInteger(t)?t=this.now(e,t,n):l.isPlainObject(t)&&p.isInteger(t.pick)&&(t=this.normalize(e,t.pick,n)),t},n.prototype.validate=function(e,t,n){var i=this,n=(n&&n.interval?n:i.item).interval;return i.disabled(t)&&(t=i.shift(t,n)),t=i.scope(t),t=i.disabled(t)?i.shift(t,-1*n):t},n.prototype.disabled=function(t){var n=this,e=(e=n.item.disable.filter(function(e){return p.isInteger(e)?t.hour==e:l.isArray(e)||p.isDate(e)?t.pick==n.create(e).pick:l.isPlainObject(e)?n.withinRange(e,t):void 0})).length&&!e.filter(function(e){return l.isArray(e)&&"inverted"==e[2]||l.isPlainObject(e)&&e.inverted}).length;return-1===n.item.enable?!e:e||t.pick<n.item.min.pick||t.pick>n.item.max.pick},n.prototype.shift=function(e,t){var n=this,i=n.item.min.pick,a=n.item.max.pick;for(t=t||n.item.interval;n.disabled(e)&&!((e=n.create(e.pick+=t)).pick<=i||e.pick>=a););return e},n.prototype.scope=function(e){var t=this.item.min.pick,n=this.item.max.pick;return this.create(e.pick>n?n:e.pick<t?t:e)},n.prototype.parse=function(e,i,t){var n,a,o,s,r,l=this,c={};if(!i||"string"!=typeof i)return i;for(s in t&&t.format||((t=t||{}).format=l.settings.format),l.formats.toArray(t.format).map(function(e){var t=l.formats[e],n=t?p.trigger(t,l,[i,c]):e.replace(/^!/,"").length;t&&(t=i.substr(0,n),c[e]=t.match(/^\d+$/)?+t:t),i=i.substr(n)}),c)r=c[s],p.isInteger(r)?s.match(/^(h|hh)$/i)?(n=r,"h"!=s&&"hh"!=s||(n%=12)):"i"==s&&(a=r):s.match(/^a$/i)&&r.match(/^p/i)&&("h"in c||"hh"in c)&&(o=!0);return 60*(o?n+12:n)+a},n.prototype.formats={h:function(e,t){return e?p.digits(e):t.hour%12||12},hh:function(e,t){return e?2:p.lead(t.hour%12||12)},H:function(e,t){return e?p.digits(e):""+t.hour%24},HH:function(e,t){return e?p.digits(e):p.lead(t.hour%24)},i:function(e,t){return e?2:p.lead(t.mins)},a:function(e,t){return e?4:t.time%a<720?"a.m.":"p.m."},A:function(e,t){return e?2:t.time%a<720?"AM":"PM"},toArray:function(e){return e.split(/(h{1,2}|H{1,2}|i|a|A|!.)/g)},toString:function(e,t){var n=this;return n.formats.toArray(e).map(function(e){return p.trigger(n.formats[e],n,[0,t])||e.replace(/^!/,"")}).join("")}},n.prototype.isTimeExact=function(e,t){return p.isInteger(e)&&p.isInteger(t)||"boolean"==typeof e&&"boolean"==typeof t?e===t:(p.isDate(e)||l.isArray(e))&&(p.isDate(t)||l.isArray(t))?this.create(e).pick===this.create(t).pick:!(!l.isPlainObject(e)||!l.isPlainObject(t))&&this.isTimeExact(e.from,t.from)&&this.isTimeExact(e.to,t.to)},n.prototype.isTimeOverlap=function(e,t){return p.isInteger(e)&&(p.isDate(t)||l.isArray(t))?e===this.create(t).hour:p.isInteger(t)&&(p.isDate(e)||l.isArray(e))?t===this.create(e).hour:!(!l.isPlainObject(e)||!l.isPlainObject(t))&&this.overlapRanges(e,t)},n.prototype.flipEnable=function(e){var t=this.item;t.enable=e||(-1==t.enable?1:-1)},n.prototype.deactivate=function(e,t){var i=this,a=i.item.disable.slice(0);return"flip"==t?i.flipEnable():!1===t?(i.flipEnable(1),a=[]):!0===t?(i.flipEnable(-1),a=[]):t.map(function(e){for(var t,n=0;n<a.length;n+=1)if(i.isTimeExact(e,a[n])){t=!0;break}t||(p.isInteger(e)||p.isDate(e)||l.isArray(e)||l.isPlainObject(e)&&e.from&&e.to)&&a.push(e)}),a},n.prototype.activate=function(e,t){var o=this,s=o.item.disable,r=s.length;return"flip"==t?o.flipEnable():!0===t?(o.flipEnable(1),s=[]):!1===t?(o.flipEnable(-1),s=[]):t.map(function(e){for(var t,n,i,a=0;a<r;a+=1){if(n=s[a],o.isTimeExact(n,e)){i=!(t=s[a]=null);break}if(o.isTimeOverlap(n,e)){l.isPlainObject(e)?(e.inverted=!0,t=e):l.isArray(e)?(t=e)[2]||t.push("inverted"):p.isDate(e)&&(t=[e.getFullYear(),e.getMonth(),e.getDate(),"inverted"]);break}}if(t)for(a=0;a<r;a+=1)if(o.isTimeExact(s[a],e)){s[a]=null;break}if(i)for(a=0;a<r;a+=1)if(o.isTimeOverlap(s[a],e)){s[a]=null;break}t&&s.push(t)}),s.filter(function(e){return null!=e})},n.prototype.i=function(e,t){return p.isInteger(t)&&0<t?t:this.item.interval},n.prototype.nodes=function(e){var r=this,l=r.settings,c=r.item.select,d=r.item.highlight,u=r.item.view,h=r.item.disable;return p.node("ul",p.group({min:r.item.min.pick,max:r.item.max.pick,i:r.item.interval,node:"li",item:function(e){var t,n=(e=r.create(e)).pick,i=c&&c.pick==n,a=d&&d.pick==n,o=h&&r.disabled(e),s=p.trigger(r.formats.toString,r,[l.format,e]);return[p.trigger(r.formats.toString,r,[p.trigger(l.formatLabel,r,[e])||l.format,e]),(t=[l.klass.listItem],i&&t.push(l.klass.selected),a&&t.push(l.klass.highlighted),u&&u.pick==n&&t.push(l.klass.viewset),o&&t.push(l.klass.disabled),t.join(" ")),"data-pick="+e.pick+" "+p.ariaAttr({role:"option",label:s,selected:!(!i||r.$node.val()!==s)||null,activedescendant:!!a||null,disabled:!!o||null})]}})+p.node("li",p.node("button",l.clear,l.klass.buttonClear,"type=button data-clear=1"+(e?"":" disabled")+" "+p.ariaAttr({controls:r.$node[0].id})),"",p.ariaAttr({role:"presentation"})),l.klass.list,p.ariaAttr({role:"listbox",controls:r.$node[0].id}))},n.defaults={clear:"Clear",format:"h:i A",interval:30,closeOnSelect:!0,closeOnClear:!0,updateInput:!0,klass:{picker:(t=e.klasses().picker)+" "+t+"--time",holder:t+"__holder",list:t+"__list",listItem:t+"__list-item",disabled:t+"__list-item--disabled",selected:t+"__list-item--selected",highlighted:t+"__list-item--highlighted",viewset:t+"__list-item--viewset",now:t+"__list-item--now",buttonClear:t+"__button--clear"}},e.extend("pickatime",n)}),define("mockup-patterns-pickadate",["jquery","pat-base","mockup-utils","translate","picker","picker.date","picker.time","mockup-patterns-select2"],function(o,e,s,t){"use strict";return e.extend({name:"pickadate",trigger:".pat-pickadate",parser:"mockup",defaults:{separator:" ",date:{selectYears:!0,selectMonths:!0,formatSubmit:"yyyy-mm-dd",format:"yyyy-mm-dd",labelMonthNext:t("Next month"),labelMonthPrev:t("Previous month"),labelMonthSelect:t("Select a month"),labelYearSelect:t("Select a year"),clear:!1,close:!1,today:!1},time:{clear:!1},today:t("Today"),clear:t("Clear"),timezone:null,autoSetTimeOnDateChange:"+[0,0]",classWrapperName:"pattern-pickadate-wrapper",classSeparatorName:"pattern-pickadate-separator",classDateName:"pattern-pickadate-date",classDateWrapperName:"pattern-pickadate-date-wrapper",classTimeName:"pattern-pickadate-time",classTimeWrapperName:"pattern-pickadate-time-wrapper",classTimezoneName:"pattern-pickadate-timezone",classTimezoneWrapperName:"pattern-pickadate-timezone-wrapper",classClearName:"pattern-pickadate-clear",classNowName:"pattern-pickadate-now",placeholderDate:t("Enter date..."),placeholderTime:t("Enter time..."),placeholderTimezone:t("Enter timezone...")},parseTimeOffset:function(t){var e,n,i,a=void 0;0===t.indexOf("+")?t=t.split(a="+")[1]:0===t.indexOf("-")&&(t=t.split(a="-")[1]);try{t=JSON.parse(t)}catch(e){t=void 0}return!1!==t&&(!0===t||!0!==Array.isArray(t)?[0,0]:(e=parseInt(t[0],10)||0,t=parseInt(t[1],10)||0,"+"!==a&&"-"!==a||(n=(i=new Date).getHours(),i=i.getMinutes(),"+"===a?(23<(e=n+e)&&(e=23),59<(t=i+t)&&(t=59)):"-"===a&&((e=n-e)<0&&(e=0),(t=i-t)<0)&&(t=0)),[e,t]))},init:function(){var t,n=this,e=n.$el.val().split(" "),i=e[0]||"",a=e[1]||"";!1===s.bool(n.options.date)&&(n.options.date=!1),!1===s.bool(n.options.time)&&(n.options.time=!1),n.options.autoSetTimeOnDateChange=n.parseTimeOffset(n.options.autoSetTimeOnDateChange),!1===n.options.date&&(a=e[0]),n.$el.hide(),n.$wrapper=o("<div/>").addClass(n.options.classWrapperName).insertAfter(n.$el),!1!==n.options.date&&(n.$date=o('<input type="text"/>').attr("placeholder",n.options.placeholderDate).attr("data-value",i).addClass(n.options.classDateName).appendTo(o("<div/>").addClass(n.options.classDateWrapperName).appendTo(n.$wrapper)).pickadate(o.extend(!0,{},n.options.date,{onSet:function(e){void 0!==e.select&&(n.$date.attr("data-value",e.select),!1!==n.options.autoSetTimeOnDateChange&&n.$time&&!n.$time.pickatime("picker").get("select")&&n.$time.pickatime("picker").set("select",n.options.autoSetTimeOnDateChange),!1!==n.options.time&&""===n.$time.attr("data-value")||n.updateValue.call(n)),e.hasOwnProperty("clear")&&(n.$el.val(""),n.$date.attr("data-value",""))}}))),!1!==n.options.time&&(n.options.time.formatSubmit="HH:i",n.$time=o('<input type="text"/>').attr("placeholder",n.options.placeholderTime).attr("data-value",a).addClass(n.options.classTimeName).appendTo(o("<div/>").addClass(n.options.classTimeWrapperName).appendTo(n.$wrapper)).pickatime(o.extend(!0,{},n.options.time,{onSet:function(e){void 0!==e.select&&(n.$time.attr("data-value",e.select),!1!==n.options.date&&""===n.$date.attr("data-value")||n.updateValue.call(n)),e.hasOwnProperty("clear")&&(n.$el.val(""),n.$time.attr("data-value",""))}})),"string"==typeof a)&&"00"===a.substring(0,2)&&(n.$time.pickatime("picker").set("select",a.split(":")),n.$time.attr("data-value",a)),!1!==n.options.date&&!1!==n.options.time&&n.options.timezone&&(n.$separator=o("<span/>").addClass(n.options.classSeparatorName).html(" "===n.options.separator?"&nbsp;":n.options.separator).appendTo(n.$wrapper)),null!==n.options.timezone&&(n.$timezone=o('<input type="text"/>').addClass(n.options.classTimezoneName).appendTo(o("<div/>").addClass(n.options.classTimezoneWrapperName).appendTo(n.$wrapper)).patternSelect2(o.extend(!0,{placeholder:n.options.placeholderTimezone,width:"10em"},n.options.timezone,{multiple:!1})).on("change",function(e){void 0!==e.val&&(n.$timezone.attr("data-value",e.val),!1!==n.options.date&&""===n.$date.attr("data-value")||!1!==n.options.time&&""===n.$time.attr("data-value")||n.updateValue.call(n))}),(e=n.options.timezone.default)&&(n.options.timezone.data.some(function(e){return t=e.text===n.options.timezone.default}),t)&&(n.$timezone.attr("data-value",e),n.$timezone.parent().find(".select2-chosen").text(e)),1===n.options.timezone.data.length)&&(n.$timezone.attr("data-value",n.options.timezone.data[0].text),n.$timezone.parent().find(".select2-chosen").text(n.options.timezone.data[0].text),n.$timezone.select2("enable",!1)),s.bool(n.options.today)&&(n.$now=o('<button type="button" class="btn btn-xs btn-info" title="'+n.options.today+'"><span class="glyphicon glyphicon-time"></span></button>').addClass(n.options.classNowName).on("click",function(e){e.preventDefault();e=new Date;n.$date&&n.$date.data("pickadate").set("select",e),n.$time&&n.$time.data("pickatime").set("select",e),n.emit("updated")}).appendTo(n.$wrapper)),s.bool(n.options.clear)&&(n.$clear=o('<button type="button" class="btn btn-xs btn-danger" title="'+n.options.clear+'"><span class="glyphicon glyphicon-trash"></span></button>').addClass(n.options.classClearName).on("click",function(e){e.preventDefault(),n.$date&&n.$date.data("pickadate").clear(),n.$time&&n.$time.data("pickatime").clear(),n.emit("updated")}).appendTo(n.$wrapper))},updateValue:function(){var e,t,n,i=this,a="";!1!==i.options.date&&(t=i.$date.data("pickadate").component,n=i.$date.data("pickadate").get("select"),e=t.formats.toString,n)&&(a+=e.apply(t,[i.options.date.formatSubmit,n])),!1!==i.options.date&&!1!==i.options.time&&(a+=" "),!1!==i.options.time&&(e=i.$time.data("pickatime").component,t=i.$time.data("pickatime").get("select"),n=e.formats.toString,t)&&(a+=n.apply(e,["HH:i",t])),null!==i.options.timezone&&(n=" "+i.$timezone.attr("data-value"))&&(a+=n),i.$el.val(a),i.emit("updated")}})}),require(["mockup-patterns-inlinevalidation","mockup-patterns-recurrence","mockup-patterns-relateditems","mockup-patterns-pickadate","mockup-patterns-select2"],function(){}),define("/Users/alecmitchell/Development/bundles/mountaineers/src/plone.staticresources/src/plone/staticresources/static/plone-logged-in.js",function(){});
//# sourceMappingURL=plone-logged-in-compiled.min.js.map